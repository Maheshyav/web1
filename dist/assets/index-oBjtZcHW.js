import{r as p,a as zr,u as be,L,b as Hr,N as hs,c as Vr,R as Yr,d as V,B as Gr,e as Br}from"./react-vendor-Ct4H1cbi.js";import{i as $r,g as Kr,a as Qr,b as Xr,s as Jr,c as Zr,L as eo,d as x,_ as to,C as so,r as vn,e as F,j as Ss,f as se,h as no,S as io,k as ro,l as Pe,m as jt,n as lt,o as qt,p as oo,q as oi,D as Ut,t as ao,u as lo,v as wn,w as ai,x as co,y as ho,z as zt,A as ct,B as uo,E as mo,F as fo,G as po,H as go,I as xo,J as _o,K as yo,M as vo,N as wo,O as bo,P as No,Q as Co,R as jo,T as So,U as Eo,V as Io,W as ko,X as Po}from"./firebase-vendor-0NBse7UB.js";import{_ as v,U as dt,S as Le,C as xe,M as Es,L as Is,a as li,P as ci,b as ks,c as Ps,T as Ts,d as St,B as Ze,e as To,f as Ht,g as Ro,h as Ao,i as Do,X as Vt,j as Mo,F as di,k as hi,I as Lo,Y as Oo,l as Fo,A as Wo,E as qo,m as Rs,n as ui,o as mi,p as fi,H as As,q as Uo,r as zo,s as Et,t as Ho,R as Vo,u as Be,v as Yo,w as Go,x as Bo,G as $o,y as Ko,z as Qo,D as Xo,J as pi,K as gi,N as Jo,O as Zo,Q as ea,V as ta}from"./ui-vendor-DGkmV-lm.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();var xi={exports:{}},Yt={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sa=p,na=Symbol.for("react.element"),ia=Symbol.for("react.fragment"),ra=Object.prototype.hasOwnProperty,oa=sa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,aa={key:!0,ref:!0,__self:!0,__source:!0};function _i(s,e,t){var n,r={},o=null,a=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(a=e.ref);for(n in e)ra.call(e,n)&&!aa.hasOwnProperty(n)&&(r[n]=e[n]);if(s&&s.defaultProps)for(n in e=s.defaultProps,e)r[n]===void 0&&(r[n]=e[n]);return{$$typeof:na,type:s,key:o,ref:a,props:r,_owner:oa.current}}Yt.Fragment=ia;Yt.jsx=_i;Yt.jsxs=_i;xi.exports=Yt;var i=xi.exports,us={},bn=zr;us.createRoot=bn.createRoot,us.hydrateRoot=bn.hydrateRoot;const la={apiKey:"AIzaSyD5ZKKqFYCGwqHgZsG3FYqwWHq1IoQxz4E",authDomain:"luxe-ecommerce-stackblitz.firebaseapp.com",projectId:"luxe-ecommerce-stackblitz",storageBucket:"luxe-ecommerce-stackblitz.appspot.com",messagingSenderId:"275123456789",appId:"1:275123456789:web:abc123def456ghi789jkl",measurementId:"G-MEASUREMENT123"},Ds=$r(la),fe=Kr(Ds),ht=Qr(Ds);Xr(Ds);Jr(fe,Zr).catch(s=>{console.error("Error enabling auth persistence:",s)});var Nn={};const Cn="@firebase/database",jn="1.0.8";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yi="";function ca(s){yi=s}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class da{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),F(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Ss(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ha{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return se(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vi=function(s){try{if(typeof window<"u"&&typeof window[s]<"u"){const e=window[s];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new da(e)}}catch{}return new ha},ge=vi("localStorage"),ua=vi("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ie=new eo("@firebase/database"),ma=function(){let s=1;return function(){return s++}}(),wi=function(s){const e=no(s),t=new io;t.update(e);const n=t.digest();return ro.encodeByteArray(n)},ut=function(...s){let e="";for(let t=0;t<s.length;t++){const n=s[t];Array.isArray(n)||n&&typeof n=="object"&&typeof n.length=="number"?e+=ut.apply(null,n):typeof n=="object"?e+=F(n):e+=n,e+=" "}return e};let $e=null,Sn=!0;const fa=function(s,e){x(!e,"Can't turn on custom loggers persistently."),Ie.logLevel=oo.VERBOSE,$e=Ie.log.bind(Ie)},U=function(...s){if(Sn===!0&&(Sn=!1,$e===null&&ua.get("logging_enabled")===!0&&fa()),$e){const e=ut.apply(null,s);$e(e)}},mt=function(s){return function(...e){U(s,...e)}},ms=function(...s){const e="FIREBASE INTERNAL ERROR: "+ut(...s);Ie.error(e)},_e=function(...s){const e=`FIREBASE FATAL ERROR: ${ut(...s)}`;throw Ie.error(e),new Error(e)},B=function(...s){const e="FIREBASE WARNING: "+ut(...s);Ie.warn(e)},pa=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&B("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Ms=function(s){return typeof s=="number"&&(s!==s||s===Number.POSITIVE_INFINITY||s===Number.NEGATIVE_INFINITY)},ga=function(s){if(document.readyState==="complete")s();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,s())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Te="[MIN_NAME]",ye="[MAX_NAME]",Ne=function(s,e){if(s===e)return 0;if(s===Te||e===ye)return-1;if(e===Te||s===ye)return 1;{const t=En(s),n=En(e);return t!==null?n!==null?t-n===0?s.length-e.length:t-n:-1:n!==null?1:s<e?-1:1}},xa=function(s,e){return s===e?0:s<e?-1:1},ze=function(s,e){if(e&&s in e)return e[s];throw new Error("Missing required key ("+s+") in object: "+F(e))},Ls=function(s){if(typeof s!="object"||s===null)return F(s);const e=[];for(const n in s)e.push(n);e.sort();let t="{";for(let n=0;n<e.length;n++)n!==0&&(t+=","),t+=F(e[n]),t+=":",t+=Ls(s[e[n]]);return t+="}",t},bi=function(s,e){const t=s.length;if(t<=e)return[s];const n=[];for(let r=0;r<t;r+=e)r+e>t?n.push(s.substring(r,t)):n.push(s.substring(r,r+e));return n};function z(s,e){for(const t in s)s.hasOwnProperty(t)&&e(t,s[t])}const Ni=function(s){x(!Ms(s),"Invalid JSON number");const e=11,t=52,n=(1<<e-1)-1;let r,o,a,l,d;s===0?(o=0,a=0,r=1/s===-1/0?1:0):(r=s<0,s=Math.abs(s),s>=Math.pow(2,1-n)?(l=Math.min(Math.floor(Math.log(s)/Math.LN2),n),o=l+n,a=Math.round(s*Math.pow(2,t-l)-Math.pow(2,t))):(o=0,a=Math.round(s/Math.pow(2,1-n-t))));const c=[];for(d=t;d;d-=1)c.push(a%2?1:0),a=Math.floor(a/2);for(d=e;d;d-=1)c.push(o%2?1:0),o=Math.floor(o/2);c.push(r?1:0),c.reverse();const u=c.join("");let h="";for(d=0;d<64;d+=8){let m=parseInt(u.substr(d,8),2).toString(16);m.length===1&&(m="0"+m),h=h+m}return h.toLowerCase()},_a=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},ya=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function va(s,e){let t="Unknown Error";s==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":s==="permission_denied"?t="Client doesn't have permission to access the desired data.":s==="unavailable"&&(t="The service is unavailable");const n=new Error(s+" at "+e._path.toString()+": "+t);return n.code=s.toUpperCase(),n}const wa=new RegExp("^-?(0*)\\d{1,10}$"),ba=-2147483648,Na=2147483647,En=function(s){if(wa.test(s)){const e=Number(s);if(e>=ba&&e<=Na)return e}return null},Oe=function(s){try{s()}catch(e){setTimeout(()=>{const t=e.stack||"";throw B("Exception was thrown by user callback.",t),e},Math.floor(0))}},Ca=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Ke=function(s,e){const t=setTimeout(s,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ja{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(n=>this.appCheck=n)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(n=>n.addTokenListener(e))}notifyForInvalidToken(){B(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sa{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(U("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',B(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Os="5",Ci="v",ji="s",Si="r",Ei="f",Ii=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,ki="ls",Pi="p",fs="ac",Ti="websocket",Ri="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ea{constructor(e,t,n,r,o=!1,a="",l=!1,d=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=o,this.persistenceKey=a,this.includeNamespaceInQueryParams=l,this.isUsingEmulator=d,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=ge.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&ge.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Ia(s){return s.host!==s.internalHost||s.isCustomHost()||s.includeNamespaceInQueryParams}function Ai(s,e,t){x(typeof e=="string","typeof type must == string"),x(typeof t=="object","typeof params must == object");let n;if(e===Ti)n=(s.secure?"wss://":"ws://")+s.internalHost+"/.ws?";else if(e===Ri)n=(s.secure?"https://":"http://")+s.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Ia(s)&&(t.ns=s.namespace);const r=[];return z(t,(o,a)=>{r.push(o+"="+a)}),n+r.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ka{constructor(){this.counters_={}}incrementCounter(e,t=1){se(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return uo(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const is={},rs={};function Fs(s){const e=s.toString();return is[e]||(is[e]=new ka),is[e]}function Pa(s,e){const t=s.toString();return rs[t]||(rs[t]=e()),rs[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ta{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const n=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<n.length;++r)n[r]&&Oe(()=>{this.onMessage_(n[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const In="start",Ra="close",Aa="pLPCommand",Da="pRTLPCB",Di="id",Mi="pw",Li="ser",Ma="cb",La="seg",Oa="ts",Fa="d",Wa="dframe",Oi=1870,Fi=30,qa=Oi-Fi,Ua=25e3,za=3e4;class Ee{constructor(e,t,n,r,o,a,l){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=o,this.transportSessionId=a,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=mt(e),this.stats_=Fs(t),this.urlFn=d=>(this.appCheckToken&&(d[fs]=this.appCheckToken),Ai(t,Ri,d))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Ta(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(za)),ga(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Ws((...o)=>{const[a,l,d,c,u]=o;if(this.incrementIncomingBytes_(o),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,a===In)this.id=l,this.password=d;else if(a===Ra)l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+a)},(...o)=>{const[a,l]=o;this.incrementIncomingBytes_(o),this.myPacketOrderer.handleResponse(a,l)},()=>{this.onClosed_()},this.urlFn);const n={};n[In]="t",n[Li]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(n[Ma]=this.scriptTagHolder.uniqueCallbackIdentifier),n[Ci]=Os,this.transportSessionId&&(n[ji]=this.transportSessionId),this.lastSessionId&&(n[ki]=this.lastSessionId),this.applicationId&&(n[Pi]=this.applicationId),this.appCheckToken&&(n[fs]=this.appCheckToken),typeof location<"u"&&location.hostname&&Ii.test(location.hostname)&&(n[Si]=Ei);const r=this.urlFn(n);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Ee.forceAllow_=!0}static forceDisallow(){Ee.forceDisallow_=!0}static isAvailable(){return Ee.forceAllow_?!0:!Ee.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!_a()&&!ya()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=F(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=fo(t),r=bi(n,qa);for(let o=0;o<r.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[o]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={};n[Wa]="t",n[Di]=e,n[Mi]=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=F(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Ws{constructor(e,t,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=ma(),window[Aa+this.uniqueCallbackIdentifier]=e,window[Da+this.uniqueCallbackIdentifier]=t,this.myIFrame=Ws.createIFrame_();let o="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(o='<script>document.domain="'+document.domain+'";<\/script>');const a="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(l){U("frame writing exception"),l.stack&&U(l.stack),U(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||U("No IE domain setting required")}catch{const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[Di]=this.myID,e[Mi]=this.myPW,e[Li]=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Fi+n.length<=Oi;){const a=this.pendingSegs.shift();n=n+"&"+La+r+"="+a.seg+"&"+Oa+r+"="+a.ts+"&"+Fa+r+"="+a.d,r++}return t=t+n,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(Ua)),o=()=>{clearTimeout(r),n()};this.addTag(e,o)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const r=n.readyState;(!r||r==="loaded"||r==="complete")&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{U("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ha=16384,Va=45e3;let It=null;typeof MozWebSocket<"u"?It=MozWebSocket:typeof WebSocket<"u"&&(It=WebSocket);class Z{constructor(e,t,n,r,o,a,l){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=mt(this.connId),this.stats_=Fs(t),this.connURL=Z.connectionURL_(t,a,l,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,o){const a={};return a[Ci]=Os,typeof location<"u"&&location.hostname&&Ii.test(location.hostname)&&(a[Si]=Ei),t&&(a[ji]=t),n&&(a[ki]=n),r&&(a[fs]=r),o&&(a[Pi]=o),Ai(e,Ti,a)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,ge.set("previous_websocket_failure",!0);try{let n;oi(),this.mySock=new It(this.connURL,[],n)}catch(n){this.log_("Error instantiating WebSocket.");const r=n.message||n.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=n=>{this.handleIncomingFrame(n)},this.mySock.onerror=n=>{this.log_("WebSocket error.  Closing connection.");const r=n.message||n.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){Z.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&It!==null&&!Z.forceDisallow_}static previouslyFailed(){return ge.isInMemoryStorage||ge.get("previous_websocket_failure")===!0}markConnectionHealthy(){ge.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const n=Ss(t);this.onMessage(n)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(x(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const n=this.extractFrameCount_(t);n!==null&&this.appendFrame_(n)}}send(e){this.resetKeepAlive();const t=F(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=bi(t,Ha);n.length>1&&this.sendString_(String(n.length));for(let r=0;r<n.length;r++)this.sendString_(n[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Va))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Z.responsesRequiredToBeHealthy=2;Z.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class et{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Ee,Z]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=Z&&Z.isAvailable();let n=t&&!Z.previouslyFailed();if(e.webSocketOnly&&(t||B("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Z];else{const r=this.transports_=[];for(const o of et.ALL_TRANSPORTS)o&&o.isAvailable()&&r.push(o);et.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}et.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ya=6e4,Ga=5e3,Ba=10*1024,$a=100*1024,os="t",kn="d",Ka="s",Pn="r",Qa="e",Tn="o",Rn="a",An="n",Dn="p",Xa="h";class Ja{constructor(e,t,n,r,o,a,l,d,c,u){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=o,this.onMessage_=a,this.onReady_=l,this.onDisconnect_=d,this.onKill_=c,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=mt("c:"+this.id+":"),this.transportManager_=new et(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=Ke(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>$a?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Ba?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(os in e){const t=e[os];t===Rn?this.upgradeIfSecondaryHealthy_():t===Pn?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Tn&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=ze("t",e),n=ze("d",e);if(t==="c")this.onSecondaryControl_(n);else if(t==="d")this.pendingDataMessages.push(n);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Dn,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Rn,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:An,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=ze("t",e),n=ze("d",e);t==="c"?this.onControl_(n):t==="d"&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=ze(os,e);if(kn in e){const n=e[kn];if(t===Xa){const r=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(t===An){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===Ka?this.onConnectionShutdown_(n):t===Pn?this.onReset_(n):t===Qa?ms("Server Error: "+n):t===Tn?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ms("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Os!==n&&B("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),Ke(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Ya))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ke(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Ga))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Dn,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(ge.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wi{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qi{constructor(e){this.allowedEvents_=e,this.listeners_={},x(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let r=0;r<n.length;r++)n[r].callback.apply(n[r].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let o=0;o<r.length;o++)if(r[o].callback===t&&(!n||n===r[o].context)){r.splice(o,1);return}}validateEventType_(e){x(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kt extends qi{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!ai()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new kt}getInitialEvent(e){return x(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mn=32,Ln=768;class P{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let n=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function E(){return new P("")}function S(s){return s.pieceNum_>=s.pieces_.length?null:s.pieces_[s.pieceNum_]}function he(s){return s.pieces_.length-s.pieceNum_}function R(s){let e=s.pieceNum_;return e<s.pieces_.length&&e++,new P(s.pieces_,e)}function qs(s){return s.pieceNum_<s.pieces_.length?s.pieces_[s.pieces_.length-1]:null}function Za(s){let e="";for(let t=s.pieceNum_;t<s.pieces_.length;t++)s.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(s.pieces_[t])));return e||"/"}function tt(s,e=0){return s.pieces_.slice(s.pieceNum_+e)}function Ui(s){if(s.pieceNum_>=s.pieces_.length)return null;const e=[];for(let t=s.pieceNum_;t<s.pieces_.length-1;t++)e.push(s.pieces_[t]);return new P(e,0)}function D(s,e){const t=[];for(let n=s.pieceNum_;n<s.pieces_.length;n++)t.push(s.pieces_[n]);if(e instanceof P)for(let n=e.pieceNum_;n<e.pieces_.length;n++)t.push(e.pieces_[n]);else{const n=e.split("/");for(let r=0;r<n.length;r++)n[r].length>0&&t.push(n[r])}return new P(t,0)}function j(s){return s.pieceNum_>=s.pieces_.length}function Y(s,e){const t=S(s),n=S(e);if(t===null)return e;if(t===n)return Y(R(s),R(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+s+")")}function el(s,e){const t=tt(s,0),n=tt(e,0);for(let r=0;r<t.length&&r<n.length;r++){const o=Ne(t[r],n[r]);if(o!==0)return o}return t.length===n.length?0:t.length<n.length?-1:1}function zi(s,e){if(he(s)!==he(e))return!1;for(let t=s.pieceNum_,n=e.pieceNum_;t<=s.pieces_.length;t++,n++)if(s.pieces_[t]!==e.pieces_[n])return!1;return!0}function Q(s,e){let t=s.pieceNum_,n=e.pieceNum_;if(he(s)>he(e))return!1;for(;t<s.pieces_.length;){if(s.pieces_[t]!==e.pieces_[n])return!1;++t,++n}return!0}class tl{constructor(e,t){this.errorPrefix_=t,this.parts_=tt(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let n=0;n<this.parts_.length;n++)this.byteLength_+=zt(this.parts_[n]);Hi(this)}}function sl(s,e){s.parts_.length>0&&(s.byteLength_+=1),s.parts_.push(e),s.byteLength_+=zt(e),Hi(s)}function nl(s){const e=s.parts_.pop();s.byteLength_-=zt(e),s.parts_.length>0&&(s.byteLength_-=1)}function Hi(s){if(s.byteLength_>Ln)throw new Error(s.errorPrefix_+"has a key path longer than "+Ln+" bytes ("+s.byteLength_+").");if(s.parts_.length>Mn)throw new Error(s.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Mn+") or object contains a cycle "+pe(s))}function pe(s){return s.parts_.length===0?"":"in property '"+s.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Us extends qi{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const n=!document[e];n!==this.visible_&&(this.visible_=n,this.trigger("visible",n))},!1)}static getInstance(){return new Us}getInitialEvent(e){return x(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const He=1e3,il=60*5*1e3,On=30*1e3,rl=1.3,ol=3e4,al="server_kill",Fn=3;class ie extends Wi{constructor(e,t,n,r,o,a,l,d){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=d,this.id=ie.nextPersistentConnectionId_++,this.log_=mt("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=He,this.maxReconnectDelay_=il,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,d&&!oi())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Us.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&kt.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const r=++this.requestNumber_,o={r,a:e,b:t};this.log_(F(o)),x(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const t=new Ut,r={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:a=>{const l=a.d;a.s==="ok"?t.resolve(l):t.reject(l)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;const o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),t.promise}listen(e,t,n,r){this.initConnection_();const o=e._queryIdentifier,a=e._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),x(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),x(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");const l={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(a).set(o,l),this.connected_&&this.sendListen_(l)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){const t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);const o={p:n},a="q";e.tag&&(o.q=t._queryObject,o.t=e.tag),o.h=e.hashFn(),this.sendRequest(a,o,l=>{const d=l.d,c=l.s;ie.warnOnListenWarnings_(d,t),(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",l),c!=="ok"&&this.removeListen_(n,r),e.onComplete&&e.onComplete(c,d))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&se(e,"w")){const n=Pe(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const r='".indexOn": "'+t._queryParams.getIndex().toString()+'"',o=t._path.toString();B(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||ao(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=On)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=lo(e)?"auth":"gauth",n={cred:e};this.authOverride_===null?n.noauth=!0:typeof this.authOverride_=="object"&&(n.authvar=this.authOverride_),this.sendRequest(t,n,r=>{const o=r.s,a=r.d||"error";this.authToken_===e&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,n=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),x(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const o={p:e},a="n";r&&(o.q=n,o.t=r),this.sendRequest(a,o)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){const o={p:t,d:n};this.log_("onDisconnect "+e,o),this.sendRequest(e,o,a=>{r&&setTimeout(()=>{r(a.s,a.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,o){this.initConnection_();const a={p:t,d:n};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:e,request:a,onComplete:r}),this.outstandingPutCount_++;const l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,o=>{this.log_(t+" response",o),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(o.s,o.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,n=>{if(n.s!=="ok"){const o=n.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+F(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):ms("Unrecognized action received from server: "+F(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){x(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=He,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=He,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>ol&&(this.reconnectDelay_=He),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*rl)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+ie.nextConnectionId_++,o=this.lastSessionId;let a=!1,l=null;const d=function(){l?l.close():(a=!0,n())},c=function(h){x(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(h)};this.realtime_={close:d,sendRequest:c};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,m]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);a?U("getToken() completed but was canceled"):(U("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=m&&m.token,l=new Ja(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,f=>{B(f+" ("+this.repoInfo_.toString()+")"),this.interrupt(al)},o))}catch(h){this.log_("Failed to get token: "+h),a||(this.repoInfo_.nodeAdmin&&B(h),d())}}}interrupt(e){U("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){U("Resuming connection for reason: "+e),delete this.interruptReasons_[e],wn(this.interruptReasons_)&&(this.reconnectDelay_=He,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;t?n=t.map(o=>Ls(o)).join("$"):n="default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const n=new P(e).toString();let r;if(this.listens.has(n)){const o=this.listens.get(n);r=o.get(t),o.delete(t),o.size===0&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){U("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Fn&&(this.reconnectDelay_=On,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){U("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Fn&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+yi.replace(/\./g,"-")]=1,ai()?e["framework.cordova"]=1:co()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=kt.getInstance().currentlyOnline();return wn(this.interruptReasons_)&&e}}ie.nextPersistentConnectionId_=0;ie.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new C(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gt{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new C(Te,e),r=new C(Te,t);return this.compare(n,r)!==0}minPost(){return C.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yt;class Vi extends Gt{static get __EMPTY_NODE(){return yt}static set __EMPTY_NODE(e){yt=e}compare(e,t){return Ne(e.name,t.name)}isDefinedOn(e){throw lt("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return C.MIN}maxPost(){return new C(ye,yt)}makePost(e,t){return x(typeof e=="string","KeyIndex indexValue must always be a string."),new C(e,yt)}toString(){return".key"}}const ke=new Vi;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vt{constructor(e,t,n,r,o=null){this.isReverse_=r,this.resultGenerator_=o,this.nodeStack_=[];let a=1;for(;!e.isEmpty();)if(e=e,a=t?n(e.key,t):1,r&&(a*=-1),a<0)this.isReverse_?e=e.left:e=e.right;else if(a===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class q{constructor(e,t,n,r,o){this.key=e,this.value=t,this.color=n??q.RED,this.left=r??$.EMPTY_NODE,this.right=o??$.EMPTY_NODE}copy(e,t,n,r,o){return new q(e??this.key,t??this.value,n??this.color,r??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const o=n(e,r.key);return o<0?r=r.copy(null,null,null,r.left.insert(e,t,n),null):o===0?r=r.copy(null,t,null,null,null):r=r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return $.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)!n.left.isEmpty()&&!n.left.isRed_()&&!n.left.left.isRed_()&&(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),!n.right.isEmpty()&&!n.right.isRed_()&&!n.right.left.isRed_()&&(n=n.moveRedRight_()),t(e,n.key)===0){if(n.right.isEmpty())return $.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,q.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,q.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}q.RED=!0;q.BLACK=!1;class ll{copy(e,t,n,r,o){return this}insert(e,t,n){return new q(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class ${constructor(e,t=$.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new $(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,q.BLACK,null,null))}remove(e){return new $(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,q.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),t===0)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();)if(t=this.comparator_(e,n.key),t===0){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}else t<0?n=n.left:t>0&&(r=n,n=n.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new vt(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new vt(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new vt(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new vt(this.root_,null,this.comparator_,!0,e)}}$.EMPTY_NODE=new ll;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cl(s,e){return Ne(s.name,e.name)}function zs(s,e){return Ne(s,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ps;function dl(s){ps=s}const Yi=function(s){return typeof s=="number"?"number:"+Ni(s):"string:"+s},Gi=function(s){if(s.isLeafNode()){const e=s.val();x(typeof e=="string"||typeof e=="number"||typeof e=="object"&&se(e,".sv"),"Priority must be a string or number.")}else x(s===ps||s.isEmpty(),"priority of unexpected type.");x(s===ps||s.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wn;class W{constructor(e,t=W.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,x(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Gi(this.priorityNode_)}static set __childrenNodeConstructor(e){Wn=e}static get __childrenNodeConstructor(){return Wn}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new W(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:W.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return j(e)?this:S(e)===".priority"?this.priorityNode_:W.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:W.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=S(e);return n===null?t:t.isEmpty()&&n!==".priority"?this:(x(n!==".priority"||he(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(n,W.__childrenNodeConstructor.EMPTY_NODE.updateChild(R(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Yi(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=Ni(this.value_):e+=this.value_,this.lazyHash_=wi(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===W.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof W.__childrenNodeConstructor?-1:(x(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,r=W.VALUE_TYPE_ORDER.indexOf(t),o=W.VALUE_TYPE_ORDER.indexOf(n);return x(r>=0,"Unknown leaf type: "+t),x(o>=0,"Unknown leaf type: "+n),r===o?n==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}W.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bi,$i;function hl(s){Bi=s}function ul(s){$i=s}class ml extends Gt{compare(e,t){const n=e.node.getPriority(),r=t.node.getPriority(),o=n.compareTo(r);return o===0?Ne(e.name,t.name):o}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return C.MIN}maxPost(){return new C(ye,new W("[PRIORITY-POST]",$i))}makePost(e,t){const n=Bi(e);return new C(t,new W("[PRIORITY-POST]",n))}toString(){return".priority"}}const M=new ml;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fl=Math.log(2);class pl{constructor(e){const t=o=>parseInt(Math.log(o)/fl,10),n=o=>parseInt(Array(o+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const r=n(this.count);this.bits_=e+1&r}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Pt=function(s,e,t,n){s.sort(e);const r=function(d,c){const u=c-d;let h,m;if(u===0)return null;if(u===1)return h=s[d],m=t?t(h):h,new q(m,h.node,q.BLACK,null,null);{const f=parseInt(u/2,10)+d,g=r(d,f),_=r(f+1,c);return h=s[f],m=t?t(h):h,new q(m,h.node,q.BLACK,g,_)}},o=function(d){let c=null,u=null,h=s.length;const m=function(g,_){const w=h-g,b=h;h-=g;const N=r(w+1,b),A=s[w],H=t?t(A):A;f(new q(H,A.node,_,null,N))},f=function(g){c?(c.left=g,c=g):(u=g,c=g)};for(let g=0;g<d.count;++g){const _=d.nextBitIsOne(),w=Math.pow(2,d.count-(g+1));_?m(w,q.BLACK):(m(w,q.BLACK),m(w,q.RED))}return u},a=new pl(s.length),l=o(a);return new $(n||e,l)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let as;const Se={};class ne{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return x(Se&&M,"ChildrenNode.ts has not been loaded"),as=as||new ne({".priority":Se},{".priority":M}),as}get(e){const t=Pe(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof $?t:null}hasIndex(e){return se(this.indexSet_,e.toString())}addIndex(e,t){x(e!==ke,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const o=t.getIterator(C.Wrap);let a=o.getNext();for(;a;)r=r||e.isDefinedOn(a.node),n.push(a),a=o.getNext();let l;r?l=Pt(n,e.getCompare()):l=Se;const d=e.toString(),c=Object.assign({},this.indexSet_);c[d]=e;const u=Object.assign({},this.indexes_);return u[d]=l,new ne(u,c)}addToIndexes(e,t){const n=jt(this.indexes_,(r,o)=>{const a=Pe(this.indexSet_,o);if(x(a,"Missing index implementation for "+o),r===Se)if(a.isDefinedOn(e.node)){const l=[],d=t.getIterator(C.Wrap);let c=d.getNext();for(;c;)c.name!==e.name&&l.push(c),c=d.getNext();return l.push(e),Pt(l,a.getCompare())}else return Se;else{const l=t.get(e.name);let d=r;return l&&(d=d.remove(new C(e.name,l))),d.insert(e,e.node)}});return new ne(n,this.indexSet_)}removeFromIndexes(e,t){const n=jt(this.indexes_,r=>{if(r===Se)return r;{const o=t.get(e.name);return o?r.remove(new C(e.name,o)):r}});return new ne(n,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ve;class y{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Gi(this.priorityNode_),this.children_.isEmpty()&&x(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Ve||(Ve=new y(new $(zs),null,ne.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Ve}updatePriority(e){return this.children_.isEmpty()?this:new y(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?Ve:t}}getChild(e){const t=S(e);return t===null?this:this.getImmediateChild(t).getChild(R(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(x(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const n=new C(e,t);let r,o;t.isEmpty()?(r=this.children_.remove(e),o=this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(e,t),o=this.indexMap_.addToIndexes(n,this.children_));const a=r.isEmpty()?Ve:this.priorityNode_;return new y(r,a,o)}}updateChild(e,t){const n=S(e);if(n===null)return t;{x(S(e)!==".priority"||he(e)===1,".priority must be the last token in a path");const r=this.getImmediateChild(n).updateChild(R(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,r=0,o=!0;if(this.forEachChild(M,(a,l)=>{t[a]=l.val(e),n++,o&&y.INTEGER_REGEXP_.test(a)?r=Math.max(r,Number(a)):o=!1}),!e&&o&&r<2*n){const a=[];for(const l in t)a[l]=t[l];return a}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Yi(this.getPriority().val())+":"),this.forEachChild(M,(t,n)=>{const r=n.hash();r!==""&&(e+=":"+t+":"+r)}),this.lazyHash_=e===""?"":wi(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){const o=r.getPredecessorKey(new C(e,t));return o?o.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const n=t.minKey();return n&&n.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new C(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const n=t.maxKey();return n&&n.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new C(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal(r=>t(r.name,r.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,r=>r);{const r=this.children_.getIteratorFrom(e.name,C.Wrap);let o=r.peek();for(;o!=null&&t.compare(o,e)<0;)r.getNext(),o=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,r=>r);{const r=this.children_.getReverseIteratorFrom(e.name,C.Wrap);let o=r.peek();for(;o!=null&&t.compare(o,e)>0;)r.getNext(),o=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ft?-1:0}withIndex(e){if(e===ke||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new y(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===ke||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const n=this.getIterator(M),r=t.getIterator(M);let o=n.getNext(),a=r.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=n.getNext(),a=r.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(e){return e===ke?null:this.indexMap_.get(e.toString())}}y.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class gl extends y{constructor(){super(new $(zs),y.EMPTY_NODE,ne.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return y.EMPTY_NODE}isEmpty(){return!1}}const ft=new gl;Object.defineProperties(C,{MIN:{value:new C(Te,y.EMPTY_NODE)},MAX:{value:new C(ye,ft)}});Vi.__EMPTY_NODE=y.EMPTY_NODE;W.__childrenNodeConstructor=y;dl(ft);ul(ft);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xl=!0;function O(s,e=null){if(s===null)return y.EMPTY_NODE;if(typeof s=="object"&&".priority"in s&&(e=s[".priority"]),x(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof s=="object"&&".value"in s&&s[".value"]!==null&&(s=s[".value"]),typeof s!="object"||".sv"in s){const t=s;return new W(t,O(e))}if(!(s instanceof Array)&&xl){const t=[];let n=!1;if(z(s,(a,l)=>{if(a.substring(0,1)!=="."){const d=O(l);d.isEmpty()||(n=n||!d.getPriority().isEmpty(),t.push(new C(a,d)))}}),t.length===0)return y.EMPTY_NODE;const o=Pt(t,cl,a=>a.name,zs);if(n){const a=Pt(t,M.getCompare());return new y(o,O(e),new ne({".priority":a},{".priority":M}))}else return new y(o,O(e),ne.Default)}else{let t=y.EMPTY_NODE;return z(s,(n,r)=>{if(se(s,n)&&n.substring(0,1)!=="."){const o=O(r);(o.isLeafNode()||!o.isEmpty())&&(t=t.updateImmediateChild(n,o))}}),t.updatePriority(O(e))}}hl(O);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _l extends Gt{constructor(e){super(),this.indexPath_=e,x(!j(e)&&S(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),r=this.extractChild(t.node),o=n.compareTo(r);return o===0?Ne(e.name,t.name):o}makePost(e,t){const n=O(e),r=y.EMPTY_NODE.updateChild(this.indexPath_,n);return new C(t,r)}maxPost(){const e=y.EMPTY_NODE.updateChild(this.indexPath_,ft);return new C(ye,e)}toString(){return tt(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yl extends Gt{compare(e,t){const n=e.node.compareTo(t.node);return n===0?Ne(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return C.MIN}maxPost(){return C.MAX}makePost(e,t){const n=O(e);return new C(t,n)}toString(){return".value"}}const vl=new yl;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ki(s){return{type:"value",snapshotNode:s}}function Re(s,e){return{type:"child_added",snapshotNode:e,childName:s}}function st(s,e){return{type:"child_removed",snapshotNode:e,childName:s}}function nt(s,e,t){return{type:"child_changed",snapshotNode:e,childName:s,oldSnap:t}}function wl(s,e){return{type:"child_moved",snapshotNode:e,childName:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hs{constructor(e){this.index_=e}updateChild(e,t,n,r,o,a){x(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(t);return l.getChild(r).equals(n.getChild(r))&&l.isEmpty()===n.isEmpty()||(a!=null&&(n.isEmpty()?e.hasChild(t)?a.trackChildChange(st(t,l)):x(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?a.trackChildChange(Re(t,n)):a.trackChildChange(nt(t,n,l))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return n!=null&&(e.isLeafNode()||e.forEachChild(M,(r,o)=>{t.hasChild(r)||n.trackChildChange(st(r,o))}),t.isLeafNode()||t.forEachChild(M,(r,o)=>{if(e.hasChild(r)){const a=e.getImmediateChild(r);a.equals(o)||n.trackChildChange(nt(r,o,a))}else n.trackChildChange(Re(r,o))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?y.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class it{constructor(e){this.indexedFilter_=new Hs(e.getIndex()),this.index_=e.getIndex(),this.startPost_=it.getStartPost_(e),this.endPost_=it.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,r,o,a){return this.matches(new C(t,n))||(n=y.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,o,a)}updateFullNode(e,t,n){t.isLeafNode()&&(t=y.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(y.EMPTY_NODE);const o=this;return t.forEachChild(M,(a,l)=>{o.matches(new C(a,l))||(r=r.updateImmediateChild(a,y.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bl{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const n=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?n<=0:n<0},this.withinEndPost=t=>{const n=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?n<=0:n<0},this.rangedFilter_=new it(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,o,a){return this.rangedFilter_.matches(new C(t,n))||(n=y.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,o,a):this.fullLimitUpdateChild_(e,t,n,o,a)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=y.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){r=y.EMPTY_NODE.withIndex(this.index_);let o;this.reverse_?o=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):o=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let a=0;for(;o.hasNext()&&a<this.limit_;){const l=o.getNext();if(this.withinDirectionalStart(l))if(this.withinDirectionalEnd(l))r=r.updateImmediateChild(l.name,l.node),a++;else break;else continue}}else{r=t.withIndex(this.index_),r=r.updatePriority(y.EMPTY_NODE);let o;this.reverse_?o=r.getReverseIterator(this.index_):o=r.getIterator(this.index_);let a=0;for(;o.hasNext();){const l=o.getNext();a<this.limit_&&this.withinDirectionalStart(l)&&this.withinDirectionalEnd(l)?a++:r=r.updateImmediateChild(l.name,y.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,o){let a;if(this.reverse_){const h=this.index_.getCompare();a=(m,f)=>h(f,m)}else a=this.index_.getCompare();const l=e;x(l.numChildren()===this.limit_,"");const d=new C(t,n),c=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),u=this.rangedFilter_.matches(d);if(l.hasChild(t)){const h=l.getImmediateChild(t);let m=r.getChildAfterChild(this.index_,c,this.reverse_);for(;m!=null&&(m.name===t||l.hasChild(m.name));)m=r.getChildAfterChild(this.index_,m,this.reverse_);const f=m==null?1:a(m,d);if(u&&!n.isEmpty()&&f>=0)return o?.trackChildChange(nt(t,n,h)),l.updateImmediateChild(t,n);{o?.trackChildChange(st(t,h));const _=l.updateImmediateChild(t,y.EMPTY_NODE);return m!=null&&this.rangedFilter_.matches(m)?(o?.trackChildChange(Re(m.name,m.node)),_.updateImmediateChild(m.name,m.node)):_}}else return n.isEmpty()?e:u&&a(c,d)>=0?(o!=null&&(o.trackChildChange(st(c.name,c.node)),o.trackChildChange(Re(t,n))),l.updateImmediateChild(t,n).updateImmediateChild(c.name,y.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vs{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=M}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return x(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return x(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Te}hasEnd(){return this.endSet_}getIndexEndValue(){return x(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return x(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ye}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return x(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===M}copy(){const e=new Vs;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Nl(s){return s.loadsAllData()?new Hs(s.getIndex()):s.hasLimit()?new bl(s):new it(s)}function qn(s){const e={};if(s.isDefault())return e;let t;if(s.index_===M?t="$priority":s.index_===vl?t="$value":s.index_===ke?t="$key":(x(s.index_ instanceof _l,"Unrecognized index type!"),t=s.index_.toString()),e.orderBy=F(t),s.startSet_){const n=s.startAfterSet_?"startAfter":"startAt";e[n]=F(s.indexStartValue_),s.startNameSet_&&(e[n]+=","+F(s.indexStartName_))}if(s.endSet_){const n=s.endBeforeSet_?"endBefore":"endAt";e[n]=F(s.indexEndValue_),s.endNameSet_&&(e[n]+=","+F(s.indexEndName_))}return s.limitSet_&&(s.isViewFromLeft()?e.limitToFirst=s.limit_:e.limitToLast=s.limit_),e}function Un(s){const e={};if(s.startSet_&&(e.sp=s.indexStartValue_,s.startNameSet_&&(e.sn=s.indexStartName_),e.sin=!s.startAfterSet_),s.endSet_&&(e.ep=s.indexEndValue_,s.endNameSet_&&(e.en=s.indexEndName_),e.ein=!s.endBeforeSet_),s.limitSet_){e.l=s.limit_;let t=s.viewFrom_;t===""&&(s.isViewFromLeft()?t="l":t="r"),e.vf=t}return s.index_!==M&&(e.i=s.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt extends Wi{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=mt("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(x(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,r){const o=e._path.toString();this.log_("Listen called for "+o+" "+e._queryIdentifier);const a=Tt.getListenId_(e,n),l={};this.listens_[a]=l;const d=qn(e._queryParams);this.restRequest_(o+".json",d,(c,u)=>{let h=u;if(c===404&&(h=null,c=null),c===null&&this.onDataUpdate_(o,h,!1,n),Pe(this.listens_,a)===l){let m;c?c===401?m="permission_denied":m="rest_error:"+c:m="ok",r(m,null)}})}unlisten(e,t){const n=Tt.getListenId_(e,t);delete this.listens_[n]}get(e){const t=qn(e._queryParams),n=e._path.toString(),r=new Ut;return this.restRequest_(n+".json",t,(o,a)=>{let l=a;o===404&&(l=null,o=null),o===null?(this.onDataUpdate_(n,l,!1,null),r.resolve(l)):r.reject(new Error(l))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,o])=>{r&&r.accessToken&&(t.auth=r.accessToken),o&&o.token&&(t.ac=o.token);const a=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ho(t);this.log_("Sending REST request for "+a);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(n&&l.readyState===4){this.log_("REST Response for "+a+" received. status:",l.status,"response:",l.responseText);let d=null;if(l.status>=200&&l.status<300){try{d=Ss(l.responseText)}catch{B("Failed to parse JSON response for "+a+": "+l.responseText)}n(null,d)}else l.status!==401&&l.status!==404&&B("Got unsuccessful REST response for "+a+" Status: "+l.status),n(l.status);n=null}},l.open("GET",a,!0),l.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cl{constructor(){this.rootNode_=y.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rt(){return{value:null,children:new Map}}function Qi(s,e,t){if(j(e))s.value=t,s.children.clear();else if(s.value!==null)s.value=s.value.updateChild(e,t);else{const n=S(e);s.children.has(n)||s.children.set(n,Rt());const r=s.children.get(n);e=R(e),Qi(r,e,t)}}function gs(s,e,t){s.value!==null?t(e,s.value):jl(s,(n,r)=>{const o=new P(e.toString()+"/"+n);gs(r,o,t)})}function jl(s,e){s.children.forEach((t,n)=>{e(n,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sl{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&z(this.last_,(n,r)=>{t[n]=t[n]-r}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zn=10*1e3,El=30*1e3,Il=5*60*1e3;class kl{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Sl(e);const n=zn+(El-zn)*Math.random();Ke(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;z(e,(r,o)=>{o>0&&se(this.statsToReport_,r)&&(t[r]=o,n=!0)}),n&&this.server_.reportStats(t),Ke(this.reportStats_.bind(this),Math.floor(Math.random()*2*Il))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ee;(function(s){s[s.OVERWRITE=0]="OVERWRITE",s[s.MERGE=1]="MERGE",s[s.ACK_USER_WRITE=2]="ACK_USER_WRITE",s[s.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(ee||(ee={}));function Ys(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Gs(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Bs(s){return{fromUser:!1,fromServer:!0,queryId:s,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class At{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=ee.ACK_USER_WRITE,this.source=Ys()}operationForChild(e){if(j(this.path)){if(this.affectedTree.value!=null)return x(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new P(e));return new At(E(),t,this.revert)}}else return x(S(this.path)===e,"operationForChild called for unrelated child."),new At(R(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rt{constructor(e,t){this.source=e,this.path=t,this.type=ee.LISTEN_COMPLETE}operationForChild(e){return j(this.path)?new rt(this.source,E()):new rt(this.source,R(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ve{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=ee.OVERWRITE}operationForChild(e){return j(this.path)?new ve(this.source,E(),this.snap.getImmediateChild(e)):new ve(this.source,R(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ae{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=ee.MERGE}operationForChild(e){if(j(this.path)){const t=this.children.subtree(new P(e));return t.isEmpty()?null:t.value?new ve(this.source,E(),t.value):new Ae(this.source,E(),t)}else return x(S(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Ae(this.source,R(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ue{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(j(e))return this.isFullyInitialized()&&!this.filtered_;const t=S(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pl{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Tl(s,e,t,n){const r=[],o=[];return e.forEach(a=>{a.type==="child_changed"&&s.index_.indexedValueChanged(a.oldSnap,a.snapshotNode)&&o.push(wl(a.childName,a.snapshotNode))}),Ye(s,r,"child_removed",e,n,t),Ye(s,r,"child_added",e,n,t),Ye(s,r,"child_moved",o,n,t),Ye(s,r,"child_changed",e,n,t),Ye(s,r,"value",e,n,t),r}function Ye(s,e,t,n,r,o){const a=n.filter(l=>l.type===t);a.sort((l,d)=>Al(s,l,d)),a.forEach(l=>{const d=Rl(s,l,o);r.forEach(c=>{c.respondsTo(l.type)&&e.push(c.createEvent(d,s.query_))})})}function Rl(s,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,s.index_)),e}function Al(s,e,t){if(e.childName==null||t.childName==null)throw lt("Should only compare child_ events.");const n=new C(e.childName,e.snapshotNode),r=new C(t.childName,t.snapshotNode);return s.index_.compare(n,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bt(s,e){return{eventCache:s,serverCache:e}}function Qe(s,e,t,n){return Bt(new ue(e,t,n),s.serverCache)}function Xi(s,e,t,n){return Bt(s.eventCache,new ue(e,t,n))}function Dt(s){return s.eventCache.isFullyInitialized()?s.eventCache.getNode():null}function we(s){return s.serverCache.isFullyInitialized()?s.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ls;const Dl=()=>(ls||(ls=new $(xa)),ls);class T{constructor(e,t=Dl()){this.value=e,this.children=t}static fromObject(e){let t=new T(null);return z(e,(n,r)=>{t=t.set(new P(n),r)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:E(),value:this.value};if(j(e))return null;{const n=S(e),r=this.children.get(n);if(r!==null){const o=r.findRootMostMatchingPathAndValue(R(e),t);return o!=null?{path:D(new P(n),o.path),value:o.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(j(e))return this;{const t=S(e),n=this.children.get(t);return n!==null?n.subtree(R(e)):new T(null)}}set(e,t){if(j(e))return new T(t,this.children);{const n=S(e),o=(this.children.get(n)||new T(null)).set(R(e),t),a=this.children.insert(n,o);return new T(this.value,a)}}remove(e){if(j(e))return this.children.isEmpty()?new T(null):new T(null,this.children);{const t=S(e),n=this.children.get(t);if(n){const r=n.remove(R(e));let o;return r.isEmpty()?o=this.children.remove(t):o=this.children.insert(t,r),this.value===null&&o.isEmpty()?new T(null):new T(this.value,o)}else return this}}get(e){if(j(e))return this.value;{const t=S(e),n=this.children.get(t);return n?n.get(R(e)):null}}setTree(e,t){if(j(e))return t;{const n=S(e),o=(this.children.get(n)||new T(null)).setTree(R(e),t);let a;return o.isEmpty()?a=this.children.remove(n):a=this.children.insert(n,o),new T(this.value,a)}}fold(e){return this.fold_(E(),e)}fold_(e,t){const n={};return this.children.inorderTraversal((r,o)=>{n[r]=o.fold_(D(e,r),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,E(),t)}findOnPath_(e,t,n){const r=this.value?n(t,this.value):!1;if(r)return r;if(j(e))return null;{const o=S(e),a=this.children.get(o);return a?a.findOnPath_(R(e),D(t,o),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,E(),t)}foreachOnPath_(e,t,n){if(j(e))return this;{this.value&&n(t,this.value);const r=S(e),o=this.children.get(r);return o?o.foreachOnPath_(R(e),D(t,r),n):new T(null)}}foreach(e){this.foreach_(E(),e)}foreach_(e,t){this.children.inorderTraversal((n,r)=>{r.foreach_(D(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class te{constructor(e){this.writeTree_=e}static empty(){return new te(new T(null))}}function Xe(s,e,t){if(j(e))return new te(new T(t));{const n=s.writeTree_.findRootMostValueAndPath(e);if(n!=null){const r=n.path;let o=n.value;const a=Y(r,e);return o=o.updateChild(a,t),new te(s.writeTree_.set(r,o))}else{const r=new T(t),o=s.writeTree_.setTree(e,r);return new te(o)}}}function xs(s,e,t){let n=s;return z(t,(r,o)=>{n=Xe(n,D(e,r),o)}),n}function Hn(s,e){if(j(e))return te.empty();{const t=s.writeTree_.setTree(e,new T(null));return new te(t)}}function _s(s,e){return Ce(s,e)!=null}function Ce(s,e){const t=s.writeTree_.findRootMostValueAndPath(e);return t!=null?s.writeTree_.get(t.path).getChild(Y(t.path,e)):null}function Vn(s){const e=[],t=s.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(M,(n,r)=>{e.push(new C(n,r))}):s.writeTree_.children.inorderTraversal((n,r)=>{r.value!=null&&e.push(new C(n,r.value))}),e}function ce(s,e){if(j(e))return s;{const t=Ce(s,e);return t!=null?new te(new T(t)):new te(s.writeTree_.subtree(e))}}function ys(s){return s.writeTree_.isEmpty()}function De(s,e){return Ji(E(),s.writeTree_,e)}function Ji(s,e,t){if(e.value!=null)return t.updateChild(s,e.value);{let n=null;return e.children.inorderTraversal((r,o)=>{r===".priority"?(x(o.value!==null,"Priority writes must always be leaf nodes"),n=o.value):t=Ji(D(s,r),o,t)}),!t.getChild(s).isEmpty()&&n!==null&&(t=t.updateChild(D(s,".priority"),n)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $t(s,e){return sr(e,s)}function Ml(s,e,t,n,r){x(n>s.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),s.allWrites.push({path:e,snap:t,writeId:n,visible:r}),r&&(s.visibleWrites=Xe(s.visibleWrites,e,t)),s.lastWriteId=n}function Ll(s,e,t,n){x(n>s.lastWriteId,"Stacking an older merge on top of newer ones"),s.allWrites.push({path:e,children:t,writeId:n,visible:!0}),s.visibleWrites=xs(s.visibleWrites,e,t),s.lastWriteId=n}function Ol(s,e){for(let t=0;t<s.allWrites.length;t++){const n=s.allWrites[t];if(n.writeId===e)return n}return null}function Fl(s,e){const t=s.allWrites.findIndex(l=>l.writeId===e);x(t>=0,"removeWrite called with nonexistent writeId.");const n=s.allWrites[t];s.allWrites.splice(t,1);let r=n.visible,o=!1,a=s.allWrites.length-1;for(;r&&a>=0;){const l=s.allWrites[a];l.visible&&(a>=t&&Wl(l,n.path)?r=!1:Q(n.path,l.path)&&(o=!0)),a--}if(r){if(o)return ql(s),!0;if(n.snap)s.visibleWrites=Hn(s.visibleWrites,n.path);else{const l=n.children;z(l,d=>{s.visibleWrites=Hn(s.visibleWrites,D(n.path,d))})}return!0}else return!1}function Wl(s,e){if(s.snap)return Q(s.path,e);for(const t in s.children)if(s.children.hasOwnProperty(t)&&Q(D(s.path,t),e))return!0;return!1}function ql(s){s.visibleWrites=Zi(s.allWrites,Ul,E()),s.allWrites.length>0?s.lastWriteId=s.allWrites[s.allWrites.length-1].writeId:s.lastWriteId=-1}function Ul(s){return s.visible}function Zi(s,e,t){let n=te.empty();for(let r=0;r<s.length;++r){const o=s[r];if(e(o)){const a=o.path;let l;if(o.snap)Q(t,a)?(l=Y(t,a),n=Xe(n,l,o.snap)):Q(a,t)&&(l=Y(a,t),n=Xe(n,E(),o.snap.getChild(l)));else if(o.children){if(Q(t,a))l=Y(t,a),n=xs(n,l,o.children);else if(Q(a,t))if(l=Y(a,t),j(l))n=xs(n,E(),o.children);else{const d=Pe(o.children,S(l));if(d){const c=d.getChild(R(l));n=Xe(n,E(),c)}}}else throw lt("WriteRecord should have .snap or .children")}}return n}function er(s,e,t,n,r){if(!n&&!r){const o=Ce(s.visibleWrites,e);if(o!=null)return o;{const a=ce(s.visibleWrites,e);if(ys(a))return t;if(t==null&&!_s(a,E()))return null;{const l=t||y.EMPTY_NODE;return De(a,l)}}}else{const o=ce(s.visibleWrites,e);if(!r&&ys(o))return t;if(!r&&t==null&&!_s(o,E()))return null;{const a=function(c){return(c.visible||r)&&(!n||!~n.indexOf(c.writeId))&&(Q(c.path,e)||Q(e,c.path))},l=Zi(s.allWrites,a,e),d=t||y.EMPTY_NODE;return De(l,d)}}}function zl(s,e,t){let n=y.EMPTY_NODE;const r=Ce(s.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(M,(o,a)=>{n=n.updateImmediateChild(o,a)}),n;if(t){const o=ce(s.visibleWrites,e);return t.forEachChild(M,(a,l)=>{const d=De(ce(o,new P(a)),l);n=n.updateImmediateChild(a,d)}),Vn(o).forEach(a=>{n=n.updateImmediateChild(a.name,a.node)}),n}else{const o=ce(s.visibleWrites,e);return Vn(o).forEach(a=>{n=n.updateImmediateChild(a.name,a.node)}),n}}function Hl(s,e,t,n,r){x(n||r,"Either existingEventSnap or existingServerSnap must exist");const o=D(e,t);if(_s(s.visibleWrites,o))return null;{const a=ce(s.visibleWrites,o);return ys(a)?r.getChild(t):De(a,r.getChild(t))}}function Vl(s,e,t,n){const r=D(e,t),o=Ce(s.visibleWrites,r);if(o!=null)return o;if(n.isCompleteForChild(t)){const a=ce(s.visibleWrites,r);return De(a,n.getNode().getImmediateChild(t))}else return null}function Yl(s,e){return Ce(s.visibleWrites,e)}function Gl(s,e,t,n,r,o,a){let l;const d=ce(s.visibleWrites,e),c=Ce(d,E());if(c!=null)l=c;else if(t!=null)l=De(d,t);else return[];if(l=l.withIndex(a),!l.isEmpty()&&!l.isLeafNode()){const u=[],h=a.getCompare(),m=o?l.getReverseIteratorFrom(n,a):l.getIteratorFrom(n,a);let f=m.getNext();for(;f&&u.length<r;)h(f,n)!==0&&u.push(f),f=m.getNext();return u}else return[]}function Bl(){return{visibleWrites:te.empty(),allWrites:[],lastWriteId:-1}}function Mt(s,e,t,n){return er(s.writeTree,s.treePath,e,t,n)}function $s(s,e){return zl(s.writeTree,s.treePath,e)}function Yn(s,e,t,n){return Hl(s.writeTree,s.treePath,e,t,n)}function Lt(s,e){return Yl(s.writeTree,D(s.treePath,e))}function $l(s,e,t,n,r,o){return Gl(s.writeTree,s.treePath,e,t,n,r,o)}function Ks(s,e,t){return Vl(s.writeTree,s.treePath,e,t)}function tr(s,e){return sr(D(s.treePath,e),s.writeTree)}function sr(s,e){return{treePath:s,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kl{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;x(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),x(n!==".priority","Only non-priority child changes can be tracked.");const r=this.changeMap.get(n);if(r){const o=r.type;if(t==="child_added"&&o==="child_removed")this.changeMap.set(n,nt(n,e.snapshotNode,r.snapshotNode));else if(t==="child_removed"&&o==="child_added")this.changeMap.delete(n);else if(t==="child_removed"&&o==="child_changed")this.changeMap.set(n,st(n,r.oldSnap));else if(t==="child_changed"&&o==="child_added")this.changeMap.set(n,Re(n,e.snapshotNode));else if(t==="child_changed"&&o==="child_changed")this.changeMap.set(n,nt(n,e.snapshotNode,r.oldSnap));else throw lt("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ql{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}}const nr=new Ql;class Qs{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const n=this.optCompleteServerCache_!=null?new ue(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Ks(this.writes_,e,n)}}getChildAfterChild(e,t,n){const r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:we(this.viewCache_),o=$l(this.writes_,r,t,1,n,e);return o.length===0?null:o[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xl(s){return{filter:s}}function Jl(s,e){x(e.eventCache.getNode().isIndexed(s.filter.getIndex()),"Event snap not indexed"),x(e.serverCache.getNode().isIndexed(s.filter.getIndex()),"Server snap not indexed")}function Zl(s,e,t,n,r){const o=new Kl;let a,l;if(t.type===ee.OVERWRITE){const c=t;c.source.fromUser?a=vs(s,e,c.path,c.snap,n,r,o):(x(c.source.fromServer,"Unknown source."),l=c.source.tagged||e.serverCache.isFiltered()&&!j(c.path),a=Ot(s,e,c.path,c.snap,n,r,l,o))}else if(t.type===ee.MERGE){const c=t;c.source.fromUser?a=tc(s,e,c.path,c.children,n,r,o):(x(c.source.fromServer,"Unknown source."),l=c.source.tagged||e.serverCache.isFiltered(),a=ws(s,e,c.path,c.children,n,r,l,o))}else if(t.type===ee.ACK_USER_WRITE){const c=t;c.revert?a=ic(s,e,c.path,n,r,o):a=sc(s,e,c.path,c.affectedTree,n,r,o)}else if(t.type===ee.LISTEN_COMPLETE)a=nc(s,e,t.path,n,o);else throw lt("Unknown operation type: "+t.type);const d=o.getChanges();return ec(e,a,d),{viewCache:a,changes:d}}function ec(s,e,t){const n=e.eventCache;if(n.isFullyInitialized()){const r=n.getNode().isLeafNode()||n.getNode().isEmpty(),o=Dt(s);(t.length>0||!s.eventCache.isFullyInitialized()||r&&!n.getNode().equals(o)||!n.getNode().getPriority().equals(o.getPriority()))&&t.push(Ki(Dt(e)))}}function ir(s,e,t,n,r,o){const a=e.eventCache;if(Lt(n,t)!=null)return e;{let l,d;if(j(t))if(x(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const c=we(e),u=c instanceof y?c:y.EMPTY_NODE,h=$s(n,u);l=s.filter.updateFullNode(e.eventCache.getNode(),h,o)}else{const c=Mt(n,we(e));l=s.filter.updateFullNode(e.eventCache.getNode(),c,o)}else{const c=S(t);if(c===".priority"){x(he(t)===1,"Can't have a priority with additional path components");const u=a.getNode();d=e.serverCache.getNode();const h=Yn(n,t,u,d);h!=null?l=s.filter.updatePriority(u,h):l=a.getNode()}else{const u=R(t);let h;if(a.isCompleteForChild(c)){d=e.serverCache.getNode();const m=Yn(n,t,a.getNode(),d);m!=null?h=a.getNode().getImmediateChild(c).updateChild(u,m):h=a.getNode().getImmediateChild(c)}else h=Ks(n,c,e.serverCache);h!=null?l=s.filter.updateChild(a.getNode(),c,h,u,r,o):l=a.getNode()}}return Qe(e,l,a.isFullyInitialized()||j(t),s.filter.filtersNodes())}}function Ot(s,e,t,n,r,o,a,l){const d=e.serverCache;let c;const u=a?s.filter:s.filter.getIndexedFilter();if(j(t))c=u.updateFullNode(d.getNode(),n,null);else if(u.filtersNodes()&&!d.isFiltered()){const f=d.getNode().updateChild(t,n);c=u.updateFullNode(d.getNode(),f,null)}else{const f=S(t);if(!d.isCompleteForPath(t)&&he(t)>1)return e;const g=R(t),w=d.getNode().getImmediateChild(f).updateChild(g,n);f===".priority"?c=u.updatePriority(d.getNode(),w):c=u.updateChild(d.getNode(),f,w,g,nr,null)}const h=Xi(e,c,d.isFullyInitialized()||j(t),u.filtersNodes()),m=new Qs(r,h,o);return ir(s,h,t,r,m,l)}function vs(s,e,t,n,r,o,a){const l=e.eventCache;let d,c;const u=new Qs(r,e,o);if(j(t))c=s.filter.updateFullNode(e.eventCache.getNode(),n,a),d=Qe(e,c,!0,s.filter.filtersNodes());else{const h=S(t);if(h===".priority")c=s.filter.updatePriority(e.eventCache.getNode(),n),d=Qe(e,c,l.isFullyInitialized(),l.isFiltered());else{const m=R(t),f=l.getNode().getImmediateChild(h);let g;if(j(m))g=n;else{const _=u.getCompleteChild(h);_!=null?qs(m)===".priority"&&_.getChild(Ui(m)).isEmpty()?g=_:g=_.updateChild(m,n):g=y.EMPTY_NODE}if(f.equals(g))d=e;else{const _=s.filter.updateChild(l.getNode(),h,g,m,u,a);d=Qe(e,_,l.isFullyInitialized(),s.filter.filtersNodes())}}}return d}function Gn(s,e){return s.eventCache.isCompleteForChild(e)}function tc(s,e,t,n,r,o,a){let l=e;return n.foreach((d,c)=>{const u=D(t,d);Gn(e,S(u))&&(l=vs(s,l,u,c,r,o,a))}),n.foreach((d,c)=>{const u=D(t,d);Gn(e,S(u))||(l=vs(s,l,u,c,r,o,a))}),l}function Bn(s,e,t){return t.foreach((n,r)=>{e=e.updateChild(n,r)}),e}function ws(s,e,t,n,r,o,a,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let d=e,c;j(t)?c=n:c=new T(null).setTree(t,n);const u=e.serverCache.getNode();return c.children.inorderTraversal((h,m)=>{if(u.hasChild(h)){const f=e.serverCache.getNode().getImmediateChild(h),g=Bn(s,f,m);d=Ot(s,d,new P(h),g,r,o,a,l)}}),c.children.inorderTraversal((h,m)=>{const f=!e.serverCache.isCompleteForChild(h)&&m.value===null;if(!u.hasChild(h)&&!f){const g=e.serverCache.getNode().getImmediateChild(h),_=Bn(s,g,m);d=Ot(s,d,new P(h),_,r,o,a,l)}}),d}function sc(s,e,t,n,r,o,a){if(Lt(r,t)!=null)return e;const l=e.serverCache.isFiltered(),d=e.serverCache;if(n.value!=null){if(j(t)&&d.isFullyInitialized()||d.isCompleteForPath(t))return Ot(s,e,t,d.getNode().getChild(t),r,o,l,a);if(j(t)){let c=new T(null);return d.getNode().forEachChild(ke,(u,h)=>{c=c.set(new P(u),h)}),ws(s,e,t,c,r,o,l,a)}else return e}else{let c=new T(null);return n.foreach((u,h)=>{const m=D(t,u);d.isCompleteForPath(m)&&(c=c.set(u,d.getNode().getChild(m)))}),ws(s,e,t,c,r,o,l,a)}}function nc(s,e,t,n,r){const o=e.serverCache,a=Xi(e,o.getNode(),o.isFullyInitialized()||j(t),o.isFiltered());return ir(s,a,t,n,nr,r)}function ic(s,e,t,n,r,o){let a;if(Lt(n,t)!=null)return e;{const l=new Qs(n,e,r),d=e.eventCache.getNode();let c;if(j(t)||S(t)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=Mt(n,we(e));else{const h=e.serverCache.getNode();x(h instanceof y,"serverChildren would be complete if leaf node"),u=$s(n,h)}u=u,c=s.filter.updateFullNode(d,u,o)}else{const u=S(t);let h=Ks(n,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=d.getImmediateChild(u)),h!=null?c=s.filter.updateChild(d,u,h,R(t),l,o):e.eventCache.getNode().hasChild(u)?c=s.filter.updateChild(d,u,y.EMPTY_NODE,R(t),l,o):c=d,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(a=Mt(n,we(e)),a.isLeafNode()&&(c=s.filter.updateFullNode(c,a,o)))}return a=e.serverCache.isFullyInitialized()||Lt(n,E())!=null,Qe(e,c,a,s.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rc{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new Hs(n.getIndex()),o=Nl(n);this.processor_=Xl(o);const a=t.serverCache,l=t.eventCache,d=r.updateFullNode(y.EMPTY_NODE,a.getNode(),null),c=o.updateFullNode(y.EMPTY_NODE,l.getNode(),null),u=new ue(d,a.isFullyInitialized(),r.filtersNodes()),h=new ue(c,l.isFullyInitialized(),o.filtersNodes());this.viewCache_=Bt(h,u),this.eventGenerator_=new Pl(this.query_)}get query(){return this.query_}}function oc(s){return s.viewCache_.serverCache.getNode()}function ac(s){return Dt(s.viewCache_)}function lc(s,e){const t=we(s.viewCache_);return t&&(s.query._queryParams.loadsAllData()||!j(e)&&!t.getImmediateChild(S(e)).isEmpty())?t.getChild(e):null}function $n(s){return s.eventRegistrations_.length===0}function cc(s,e){s.eventRegistrations_.push(e)}function Kn(s,e,t){const n=[];if(t){x(e==null,"A cancel should cancel all event registrations.");const r=s.query._path;s.eventRegistrations_.forEach(o=>{const a=o.createCancelEvent(t,r);a&&n.push(a)})}if(e){let r=[];for(let o=0;o<s.eventRegistrations_.length;++o){const a=s.eventRegistrations_[o];if(!a.matches(e))r.push(a);else if(e.hasAnyCallback()){r=r.concat(s.eventRegistrations_.slice(o+1));break}}s.eventRegistrations_=r}else s.eventRegistrations_=[];return n}function Qn(s,e,t,n){e.type===ee.MERGE&&e.source.queryId!==null&&(x(we(s.viewCache_),"We should always have a full cache before handling merges"),x(Dt(s.viewCache_),"Missing event cache, even though we have a server cache"));const r=s.viewCache_,o=Zl(s.processor_,r,e,t,n);return Jl(s.processor_,o.viewCache),x(o.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),s.viewCache_=o.viewCache,rr(s,o.changes,o.viewCache.eventCache.getNode(),null)}function dc(s,e){const t=s.viewCache_.eventCache,n=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(M,(o,a)=>{n.push(Re(o,a))}),t.isFullyInitialized()&&n.push(Ki(t.getNode())),rr(s,n,t.getNode(),e)}function rr(s,e,t,n){const r=n?[n]:s.eventRegistrations_;return Tl(s.eventGenerator_,e,t,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ft;class or{constructor(){this.views=new Map}}function hc(s){x(!Ft,"__referenceConstructor has already been defined"),Ft=s}function uc(){return x(Ft,"Reference.ts has not been loaded"),Ft}function mc(s){return s.views.size===0}function Xs(s,e,t,n){const r=e.source.queryId;if(r!==null){const o=s.views.get(r);return x(o!=null,"SyncTree gave us an op for an invalid query."),Qn(o,e,t,n)}else{let o=[];for(const a of s.views.values())o=o.concat(Qn(a,e,t,n));return o}}function ar(s,e,t,n,r){const o=e._queryIdentifier,a=s.views.get(o);if(!a){let l=Mt(t,r?n:null),d=!1;l?d=!0:n instanceof y?(l=$s(t,n),d=!1):(l=y.EMPTY_NODE,d=!1);const c=Bt(new ue(l,d,!1),new ue(n,r,!1));return new rc(e,c)}return a}function fc(s,e,t,n,r,o){const a=ar(s,e,n,r,o);return s.views.has(e._queryIdentifier)||s.views.set(e._queryIdentifier,a),cc(a,t),dc(a,t)}function pc(s,e,t,n){const r=e._queryIdentifier,o=[];let a=[];const l=me(s);if(r==="default")for(const[d,c]of s.views.entries())a=a.concat(Kn(c,t,n)),$n(c)&&(s.views.delete(d),c.query._queryParams.loadsAllData()||o.push(c.query));else{const d=s.views.get(r);d&&(a=a.concat(Kn(d,t,n)),$n(d)&&(s.views.delete(r),d.query._queryParams.loadsAllData()||o.push(d.query)))}return l&&!me(s)&&o.push(new(uc())(e._repo,e._path)),{removed:o,events:a}}function lr(s){const e=[];for(const t of s.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function de(s,e){let t=null;for(const n of s.views.values())t=t||lc(n,e);return t}function cr(s,e){if(e._queryParams.loadsAllData())return Kt(s);{const n=e._queryIdentifier;return s.views.get(n)}}function dr(s,e){return cr(s,e)!=null}function me(s){return Kt(s)!=null}function Kt(s){for(const e of s.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Wt;function gc(s){x(!Wt,"__referenceConstructor has already been defined"),Wt=s}function xc(){return x(Wt,"Reference.ts has not been loaded"),Wt}let _c=1;class Xn{constructor(e){this.listenProvider_=e,this.syncPointTree_=new T(null),this.pendingWriteTree_=Bl(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function hr(s,e,t,n,r){return Ml(s.pendingWriteTree_,e,t,n,r),r?Fe(s,new ve(Ys(),e,t)):[]}function yc(s,e,t,n){Ll(s.pendingWriteTree_,e,t,n);const r=T.fromObject(t);return Fe(s,new Ae(Ys(),e,r))}function le(s,e,t=!1){const n=Ol(s.pendingWriteTree_,e);if(Fl(s.pendingWriteTree_,e)){let o=new T(null);return n.snap!=null?o=o.set(E(),!0):z(n.children,a=>{o=o.set(new P(a),!0)}),Fe(s,new At(n.path,o,t))}else return[]}function pt(s,e,t){return Fe(s,new ve(Gs(),e,t))}function vc(s,e,t){const n=T.fromObject(t);return Fe(s,new Ae(Gs(),e,n))}function wc(s,e){return Fe(s,new rt(Gs(),e))}function bc(s,e,t){const n=Zs(s,t);if(n){const r=en(n),o=r.path,a=r.queryId,l=Y(o,e),d=new rt(Bs(a),l);return tn(s,o,d)}else return[]}function ur(s,e,t,n,r=!1){const o=e._path,a=s.syncPointTree_.get(o);let l=[];if(a&&(e._queryIdentifier==="default"||dr(a,e))){const d=pc(a,e,t,n);mc(a)&&(s.syncPointTree_=s.syncPointTree_.remove(o));const c=d.removed;if(l=d.events,!r){const u=c.findIndex(m=>m._queryParams.loadsAllData())!==-1,h=s.syncPointTree_.findOnPath(o,(m,f)=>me(f));if(u&&!h){const m=s.syncPointTree_.subtree(o);if(!m.isEmpty()){const f=Sc(m);for(let g=0;g<f.length;++g){const _=f[g],w=_.query,b=gr(s,_);s.listenProvider_.startListening(Je(w),ot(s,w),b.hashFn,b.onComplete)}}}!h&&c.length>0&&!n&&(u?s.listenProvider_.stopListening(Je(e),null):c.forEach(m=>{const f=s.queryToTagMap.get(Qt(m));s.listenProvider_.stopListening(Je(m),f)}))}Ec(s,c)}return l}function mr(s,e,t,n){const r=Zs(s,n);if(r!=null){const o=en(r),a=o.path,l=o.queryId,d=Y(a,e),c=new ve(Bs(l),d,t);return tn(s,a,c)}else return[]}function Nc(s,e,t,n){const r=Zs(s,n);if(r){const o=en(r),a=o.path,l=o.queryId,d=Y(a,e),c=T.fromObject(t),u=new Ae(Bs(l),d,c);return tn(s,a,u)}else return[]}function Cc(s,e,t,n=!1){const r=e._path;let o=null,a=!1;s.syncPointTree_.foreachOnPath(r,(m,f)=>{const g=Y(m,r);o=o||de(f,g),a=a||me(f)});let l=s.syncPointTree_.get(r);l?(a=a||me(l),o=o||de(l,E())):(l=new or,s.syncPointTree_=s.syncPointTree_.set(r,l));let d;o!=null?d=!0:(d=!1,o=y.EMPTY_NODE,s.syncPointTree_.subtree(r).foreachChild((f,g)=>{const _=de(g,E());_&&(o=o.updateImmediateChild(f,_))}));const c=dr(l,e);if(!c&&!e._queryParams.loadsAllData()){const m=Qt(e);x(!s.queryToTagMap.has(m),"View does not exist, but we have a tag");const f=Ic();s.queryToTagMap.set(m,f),s.tagToQueryMap.set(f,m)}const u=$t(s.pendingWriteTree_,r);let h=fc(l,e,t,u,o,d);if(!c&&!a&&!n){const m=cr(l,e);h=h.concat(kc(s,e,m))}return h}function Js(s,e,t){const r=s.pendingWriteTree_,o=s.syncPointTree_.findOnPath(e,(a,l)=>{const d=Y(a,e),c=de(l,d);if(c)return c});return er(r,e,o,t,!0)}function jc(s,e){const t=e._path;let n=null;s.syncPointTree_.foreachOnPath(t,(c,u)=>{const h=Y(c,t);n=n||de(u,h)});let r=s.syncPointTree_.get(t);r?n=n||de(r,E()):(r=new or,s.syncPointTree_=s.syncPointTree_.set(t,r));const o=n!=null,a=o?new ue(n,!0,!1):null,l=$t(s.pendingWriteTree_,e._path),d=ar(r,e,l,o?a.getNode():y.EMPTY_NODE,o);return ac(d)}function Fe(s,e){return fr(e,s.syncPointTree_,null,$t(s.pendingWriteTree_,E()))}function fr(s,e,t,n){if(j(s.path))return pr(s,e,t,n);{const r=e.get(E());t==null&&r!=null&&(t=de(r,E()));let o=[];const a=S(s.path),l=s.operationForChild(a),d=e.children.get(a);if(d&&l){const c=t?t.getImmediateChild(a):null,u=tr(n,a);o=o.concat(fr(l,d,c,u))}return r&&(o=o.concat(Xs(r,s,n,t))),o}}function pr(s,e,t,n){const r=e.get(E());t==null&&r!=null&&(t=de(r,E()));let o=[];return e.children.inorderTraversal((a,l)=>{const d=t?t.getImmediateChild(a):null,c=tr(n,a),u=s.operationForChild(a);u&&(o=o.concat(pr(u,l,d,c)))}),r&&(o=o.concat(Xs(r,s,n,t))),o}function gr(s,e){const t=e.query,n=ot(s,t);return{hashFn:()=>(oc(e)||y.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return n?bc(s,t._path,n):wc(s,t._path);{const o=va(r,t);return ur(s,t,null,o)}}}}function ot(s,e){const t=Qt(e);return s.queryToTagMap.get(t)}function Qt(s){return s._path.toString()+"$"+s._queryIdentifier}function Zs(s,e){return s.tagToQueryMap.get(e)}function en(s){const e=s.indexOf("$");return x(e!==-1&&e<s.length-1,"Bad queryKey."),{queryId:s.substr(e+1),path:new P(s.substr(0,e))}}function tn(s,e,t){const n=s.syncPointTree_.get(e);x(n,"Missing sync point for query tag that we're tracking");const r=$t(s.pendingWriteTree_,e);return Xs(n,t,r,null)}function Sc(s){return s.fold((e,t,n)=>{if(t&&me(t))return[Kt(t)];{let r=[];return t&&(r=lr(t)),z(n,(o,a)=>{r=r.concat(a)}),r}})}function Je(s){return s._queryParams.loadsAllData()&&!s._queryParams.isDefault()?new(xc())(s._repo,s._path):s}function Ec(s,e){for(let t=0;t<e.length;++t){const n=e[t];if(!n._queryParams.loadsAllData()){const r=Qt(n),o=s.queryToTagMap.get(r);s.queryToTagMap.delete(r),s.tagToQueryMap.delete(o)}}}function Ic(){return _c++}function kc(s,e,t){const n=e._path,r=ot(s,e),o=gr(s,t),a=s.listenProvider_.startListening(Je(e),r,o.hashFn,o.onComplete),l=s.syncPointTree_.subtree(n);if(r)x(!me(l.value),"If we're adding a query, it shouldn't be shadowed");else{const d=l.fold((c,u,h)=>{if(!j(c)&&u&&me(u))return[Kt(u).query];{let m=[];return u&&(m=m.concat(lr(u).map(f=>f.query))),z(h,(f,g)=>{m=m.concat(g)}),m}});for(let c=0;c<d.length;++c){const u=d[c];s.listenProvider_.stopListening(Je(u),ot(s,u))}}return a}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sn{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new sn(t)}node(){return this.node_}}class nn{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=D(this.path_,e);return new nn(this.syncTree_,t)}node(){return Js(this.syncTree_,this.path_)}}const Pc=function(s){return s=s||{},s.timestamp=s.timestamp||new Date().getTime(),s},Jn=function(s,e,t){if(!s||typeof s!="object")return s;if(x(".sv"in s,"Unexpected leaf node or priority contents"),typeof s[".sv"]=="string")return Tc(s[".sv"],e,t);if(typeof s[".sv"]=="object")return Rc(s[".sv"],e);x(!1,"Unexpected server value: "+JSON.stringify(s,null,2))},Tc=function(s,e,t){switch(s){case"timestamp":return t.timestamp;default:x(!1,"Unexpected server value: "+s)}},Rc=function(s,e,t){s.hasOwnProperty("increment")||x(!1,"Unexpected server value: "+JSON.stringify(s,null,2));const n=s.increment;typeof n!="number"&&x(!1,"Unexpected increment value: "+n);const r=e.node();if(x(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return n;const a=r.getValue();return typeof a!="number"?n:a+n},xr=function(s,e,t,n){return rn(e,new nn(t,s),n)},_r=function(s,e,t){return rn(s,new sn(e),t)};function rn(s,e,t){const n=s.getPriority().val(),r=Jn(n,e.getImmediateChild(".priority"),t);let o;if(s.isLeafNode()){const a=s,l=Jn(a.getValue(),e,t);return l!==a.getValue()||r!==a.getPriority().val()?new W(l,O(r)):s}else{const a=s;return o=a,r!==a.getPriority().val()&&(o=o.updatePriority(new W(r))),a.forEachChild(M,(l,d)=>{const c=rn(d,e.getImmediateChild(l),t);c!==d&&(o=o.updateImmediateChild(l,c))}),o}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class on{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function an(s,e){let t=e instanceof P?e:new P(e),n=s,r=S(t);for(;r!==null;){const o=Pe(n.node.children,r)||{children:{},childCount:0};n=new on(r,n,o),t=R(t),r=S(t)}return n}function We(s){return s.node.value}function yr(s,e){s.node.value=e,bs(s)}function vr(s){return s.node.childCount>0}function Ac(s){return We(s)===void 0&&!vr(s)}function Xt(s,e){z(s.node.children,(t,n)=>{e(new on(t,s,n))})}function wr(s,e,t,n){t&&!n&&e(s),Xt(s,r=>{wr(r,e,!0,n)}),t&&n&&e(s)}function Dc(s,e,t){let n=s.parent;for(;n!==null;){if(e(n))return!0;n=n.parent}return!1}function gt(s){return new P(s.parent===null?s.name:gt(s.parent)+"/"+s.name)}function bs(s){s.parent!==null&&Mc(s.parent,s.name,s)}function Mc(s,e,t){const n=Ac(t),r=se(s.node.children,e);n&&r?(delete s.node.children[e],s.node.childCount--,bs(s)):!n&&!r&&(s.node.children[e]=t.node,s.node.childCount++,bs(s))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lc=/[\[\].#$\/\u0000-\u001F\u007F]/,Oc=/[\[\].#$\u0000-\u001F\u007F]/,cs=10*1024*1024,ln=function(s){return typeof s=="string"&&s.length!==0&&!Lc.test(s)},br=function(s){return typeof s=="string"&&s.length!==0&&!Oc.test(s)},Fc=function(s){return s&&(s=s.replace(/^\/*\.info(\/|$)/,"/")),br(s)},Wc=function(s){return s===null||typeof s=="string"||typeof s=="number"&&!Ms(s)||s&&typeof s=="object"&&se(s,".sv")},qc=function(s,e,t,n){Jt(qt(s,"value"),e,t)},Jt=function(s,e,t){const n=t instanceof P?new tl(t,s):t;if(e===void 0)throw new Error(s+"contains undefined "+pe(n));if(typeof e=="function")throw new Error(s+"contains a function "+pe(n)+" with contents = "+e.toString());if(Ms(e))throw new Error(s+"contains "+e.toString()+" "+pe(n));if(typeof e=="string"&&e.length>cs/3&&zt(e)>cs)throw new Error(s+"contains a string greater than "+cs+" utf8 bytes "+pe(n)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,o=!1;if(z(e,(a,l)=>{if(a===".value")r=!0;else if(a!==".priority"&&a!==".sv"&&(o=!0,!ln(a)))throw new Error(s+" contains an invalid key ("+a+") "+pe(n)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);sl(n,a),Jt(s,l,n),nl(n)}),r&&o)throw new Error(s+' contains ".value" child '+pe(n)+" in addition to actual children.")}},Uc=function(s,e){let t,n;for(t=0;t<e.length;t++){n=e[t];const o=tt(n);for(let a=0;a<o.length;a++)if(!(o[a]===".priority"&&a===o.length-1)){if(!ln(o[a]))throw new Error(s+"contains an invalid key ("+o[a]+") in path "+n.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(el);let r=null;for(t=0;t<e.length;t++){if(n=e[t],r!==null&&Q(r,n))throw new Error(s+"contains a path "+r.toString()+" that is ancestor of another path "+n.toString());r=n}},zc=function(s,e,t,n){const r=qt(s,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(r+" must be an object containing the children to replace.");const o=[];z(e,(a,l)=>{const d=new P(a);if(Jt(r,l,D(t,d)),qs(d)===".priority"&&!Wc(l))throw new Error(r+"contains an invalid value for '"+d.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");o.push(d)}),Uc(r,o)},Nr=function(s,e,t,n){if(!br(t))throw new Error(qt(s,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Hc=function(s,e,t,n){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Nr(s,e,t)},Vc=function(s,e){if(S(e)===".info")throw new Error(s+" failed = Can't modify data under /.info/")},Yc=function(s,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!ln(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!Fc(t))throw new Error(qt(s,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gc{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function cn(s,e){let t=null;for(let n=0;n<e.length;n++){const r=e[n],o=r.getPath();t!==null&&!zi(o,t.path)&&(s.eventLists_.push(t),t=null),t===null&&(t={events:[],path:o}),t.events.push(r)}t&&s.eventLists_.push(t)}function X(s,e,t){cn(s,t),Bc(s,n=>Q(n,e)||Q(e,n))}function Bc(s,e){s.recursionDepth_++;let t=!0;for(let n=0;n<s.eventLists_.length;n++){const r=s.eventLists_[n];if(r){const o=r.path;e(o)?($c(s.eventLists_[n]),s.eventLists_[n]=null):t=!1}}t&&(s.eventLists_=[]),s.recursionDepth_--}function $c(s){for(let e=0;e<s.events.length;e++){const t=s.events[e];if(t!==null){s.events[e]=null;const n=t.getEventRunner();$e&&U("event: "+t.toString()),Oe(n)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kc="repo_interrupt",Qc=25;class Xc{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Gc,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Rt(),this.transactionQueueTree_=new on,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Jc(s,e,t){if(s.stats_=Fs(s.repoInfo_),s.forceRestClient_||Ca())s.server_=new Tt(s.repoInfo_,(n,r,o,a)=>{Zn(s,n,r,o,a)},s.authTokenProvider_,s.appCheckProvider_),setTimeout(()=>ei(s,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{F(t)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}s.persistentConnection_=new ie(s.repoInfo_,e,(n,r,o,a)=>{Zn(s,n,r,o,a)},n=>{ei(s,n)},n=>{ed(s,n)},s.authTokenProvider_,s.appCheckProvider_,t),s.server_=s.persistentConnection_}s.authTokenProvider_.addTokenChangeListener(n=>{s.server_.refreshAuthToken(n)}),s.appCheckProvider_.addTokenChangeListener(n=>{s.server_.refreshAppCheckToken(n.token)}),s.statsReporter_=Pa(s.repoInfo_,()=>new kl(s.stats_,s.server_)),s.infoData_=new Cl,s.infoSyncTree_=new Xn({startListening:(n,r,o,a)=>{let l=[];const d=s.infoData_.getNode(n._path);return d.isEmpty()||(l=pt(s.infoSyncTree_,n._path,d),setTimeout(()=>{a("ok")},0)),l},stopListening:()=>{}}),dn(s,"connected",!1),s.serverSyncTree_=new Xn({startListening:(n,r,o,a)=>(s.server_.listen(n,o,r,(l,d)=>{const c=a(l,d);X(s.eventQueue_,n._path,c)}),[]),stopListening:(n,r)=>{s.server_.unlisten(n,r)}})}function Zc(s){const t=s.infoData_.getNode(new P(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Zt(s){return Pc({timestamp:Zc(s)})}function Zn(s,e,t,n,r){s.dataUpdateCount++;const o=new P(e);t=s.interceptServerDataCallback_?s.interceptServerDataCallback_(e,t):t;let a=[];if(r)if(n){const d=jt(t,c=>O(c));a=Nc(s.serverSyncTree_,o,d,r)}else{const d=O(t);a=mr(s.serverSyncTree_,o,d,r)}else if(n){const d=jt(t,c=>O(c));a=vc(s.serverSyncTree_,o,d)}else{const d=O(t);a=pt(s.serverSyncTree_,o,d)}let l=o;a.length>0&&(l=Me(s,o)),X(s.eventQueue_,l,a)}function ei(s,e){dn(s,"connected",e),e===!1&&id(s)}function ed(s,e){z(e,(t,n)=>{dn(s,t,n)})}function dn(s,e,t){const n=new P("/.info/"+e),r=O(t);s.infoData_.updateSnapshot(n,r);const o=pt(s.infoSyncTree_,n,r);X(s.eventQueue_,n,o)}function hn(s){return s.nextWriteId_++}function td(s,e,t){const n=jc(s.serverSyncTree_,e);return n!=null?Promise.resolve(n):s.server_.get(e).then(r=>{const o=O(r).withIndex(e._queryParams.getIndex());Cc(s.serverSyncTree_,e,t,!0);let a;if(e._queryParams.loadsAllData())a=pt(s.serverSyncTree_,e._path,o);else{const l=ot(s.serverSyncTree_,e);a=mr(s.serverSyncTree_,e._path,o,l)}return X(s.eventQueue_,e._path,a),ur(s.serverSyncTree_,e,t,null,!0),o},r=>(xt(s,"get for query "+F(e)+" failed: "+r),Promise.reject(new Error(r))))}function sd(s,e,t,n,r){xt(s,"set",{path:e.toString(),value:t,priority:n});const o=Zt(s),a=O(t,n),l=Js(s.serverSyncTree_,e),d=_r(a,l,o),c=hn(s),u=hr(s.serverSyncTree_,e,d,c,!0);cn(s.eventQueue_,u),s.server_.put(e.toString(),a.val(!0),(m,f)=>{const g=m==="ok";g||B("set at "+e+" failed: "+m);const _=le(s.serverSyncTree_,c,!g);X(s.eventQueue_,e,_),Ns(s,r,m,f)});const h=mn(s,e);Me(s,h),X(s.eventQueue_,h,[])}function nd(s,e,t,n){xt(s,"update",{path:e.toString(),value:t});let r=!0;const o=Zt(s),a={};if(z(t,(l,d)=>{r=!1,a[l]=xr(D(e,l),O(d),s.serverSyncTree_,o)}),r)U("update() called with empty data.  Don't do anything."),Ns(s,n,"ok",void 0);else{const l=hn(s),d=yc(s.serverSyncTree_,e,a,l);cn(s.eventQueue_,d),s.server_.merge(e.toString(),t,(c,u)=>{const h=c==="ok";h||B("update at "+e+" failed: "+c);const m=le(s.serverSyncTree_,l,!h),f=m.length>0?Me(s,e):e;X(s.eventQueue_,f,m),Ns(s,n,c,u)}),z(t,c=>{const u=mn(s,D(e,c));Me(s,u)}),X(s.eventQueue_,e,[])}}function id(s){xt(s,"onDisconnectEvents");const e=Zt(s),t=Rt();gs(s.onDisconnect_,E(),(r,o)=>{const a=xr(r,o,s.serverSyncTree_,e);Qi(t,r,a)});let n=[];gs(t,E(),(r,o)=>{n=n.concat(pt(s.serverSyncTree_,r,o));const a=mn(s,r);Me(s,a)}),s.onDisconnect_=Rt(),X(s.eventQueue_,E(),n)}function rd(s){s.persistentConnection_&&s.persistentConnection_.interrupt(Kc)}function xt(s,...e){let t="";s.persistentConnection_&&(t=s.persistentConnection_.id+":"),U(t,...e)}function Ns(s,e,t,n){e&&Oe(()=>{if(t==="ok")e(null);else{const r=(t||"error").toUpperCase();let o=r;n&&(o+=": "+n);const a=new Error(o);a.code=r,e(a)}})}function Cr(s,e,t){return Js(s.serverSyncTree_,e,t)||y.EMPTY_NODE}function un(s,e=s.transactionQueueTree_){if(e||es(s,e),We(e)){const t=Sr(s,e);x(t.length>0,"Sending zero length transaction queue"),t.every(r=>r.status===0)&&od(s,gt(e),t)}else vr(e)&&Xt(e,t=>{un(s,t)})}function od(s,e,t){const n=t.map(c=>c.currentWriteId),r=Cr(s,e,n);let o=r;const a=r.hash();for(let c=0;c<t.length;c++){const u=t[c];x(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;const h=Y(e,u.path);o=o.updateChild(h,u.currentOutputSnapshotRaw)}const l=o.val(!0),d=e;s.server_.put(d.toString(),l,c=>{xt(s,"transaction put response",{path:d.toString(),status:c});let u=[];if(c==="ok"){const h=[];for(let m=0;m<t.length;m++)t[m].status=2,u=u.concat(le(s.serverSyncTree_,t[m].currentWriteId)),t[m].onComplete&&h.push(()=>t[m].onComplete(null,!0,t[m].currentOutputSnapshotResolved)),t[m].unwatcher();es(s,an(s.transactionQueueTree_,e)),un(s,s.transactionQueueTree_),X(s.eventQueue_,e,u);for(let m=0;m<h.length;m++)Oe(h[m])}else{if(c==="datastale")for(let h=0;h<t.length;h++)t[h].status===3?t[h].status=4:t[h].status=0;else{B("transaction at "+d.toString()+" failed: "+c);for(let h=0;h<t.length;h++)t[h].status=4,t[h].abortReason=c}Me(s,e)}},a)}function Me(s,e){const t=jr(s,e),n=gt(t),r=Sr(s,t);return ad(s,r,n),n}function ad(s,e,t){if(e.length===0)return;const n=[];let r=[];const a=e.filter(l=>l.status===0).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const d=e[l],c=Y(t,d.path);let u=!1,h;if(x(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),d.status===4)u=!0,h=d.abortReason,r=r.concat(le(s.serverSyncTree_,d.currentWriteId,!0));else if(d.status===0)if(d.retryCount>=Qc)u=!0,h="maxretry",r=r.concat(le(s.serverSyncTree_,d.currentWriteId,!0));else{const m=Cr(s,d.path,a);d.currentInputSnapshot=m;const f=e[l].update(m.val());if(f!==void 0){Jt("transaction failed: Data returned ",f,d.path);let g=O(f);typeof f=="object"&&f!=null&&se(f,".priority")||(g=g.updatePriority(m.getPriority()));const w=d.currentWriteId,b=Zt(s),N=_r(g,m,b);d.currentOutputSnapshotRaw=g,d.currentOutputSnapshotResolved=N,d.currentWriteId=hn(s),a.splice(a.indexOf(w),1),r=r.concat(hr(s.serverSyncTree_,d.path,N,d.currentWriteId,d.applyLocally)),r=r.concat(le(s.serverSyncTree_,w,!0))}else u=!0,h="nodata",r=r.concat(le(s.serverSyncTree_,d.currentWriteId,!0))}X(s.eventQueue_,t,r),r=[],u&&(e[l].status=2,function(m){setTimeout(m,Math.floor(0))}(e[l].unwatcher),e[l].onComplete&&(h==="nodata"?n.push(()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot)):n.push(()=>e[l].onComplete(new Error(h),!1,null))))}es(s,s.transactionQueueTree_);for(let l=0;l<n.length;l++)Oe(n[l]);un(s,s.transactionQueueTree_)}function jr(s,e){let t,n=s.transactionQueueTree_;for(t=S(e);t!==null&&We(n)===void 0;)n=an(n,t),e=R(e),t=S(e);return n}function Sr(s,e){const t=[];return Er(s,e,t),t.sort((n,r)=>n.order-r.order),t}function Er(s,e,t){const n=We(e);if(n)for(let r=0;r<n.length;r++)t.push(n[r]);Xt(e,r=>{Er(s,r,t)})}function es(s,e){const t=We(e);if(t){let n=0;for(let r=0;r<t.length;r++)t[r].status!==2&&(t[n]=t[r],n++);t.length=n,yr(e,t.length>0?t:void 0)}Xt(e,n=>{es(s,n)})}function mn(s,e){const t=gt(jr(s,e)),n=an(s.transactionQueueTree_,e);return Dc(n,r=>{ds(s,r)}),ds(s,n),wr(n,r=>{ds(s,r)}),t}function ds(s,e){const t=We(e);if(t){const n=[];let r=[],o=-1;for(let a=0;a<t.length;a++)t[a].status===3||(t[a].status===1?(x(o===a-1,"All SENT items should be at beginning of queue."),o=a,t[a].status=3,t[a].abortReason="set"):(x(t[a].status===0,"Unexpected transaction status in abort"),t[a].unwatcher(),r=r.concat(le(s.serverSyncTree_,t[a].currentWriteId,!0)),t[a].onComplete&&n.push(t[a].onComplete.bind(null,new Error("set"),!1,null))));o===-1?yr(e,void 0):t.length=o+1,X(s.eventQueue_,gt(e),r);for(let a=0;a<n.length;a++)Oe(n[a])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ld(s){let e="";const t=s.split("/");for(let n=0;n<t.length;n++)if(t[n].length>0){let r=t[n];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function cd(s){const e={};s.charAt(0)==="?"&&(s=s.substring(1));for(const t of s.split("&")){if(t.length===0)continue;const n=t.split("=");n.length===2?e[decodeURIComponent(n[0])]=decodeURIComponent(n[1]):B(`Invalid query segment '${t}' in query '${s}'`)}return e}const ti=function(s,e){const t=dd(s),n=t.namespace;t.domain==="firebase.com"&&_e(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!n||n==="undefined")&&t.domain!=="localhost"&&_e("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||pa();const r=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Ea(t.host,t.secure,n,r,e,"",n!==t.subdomain),path:new P(t.pathString)}},dd=function(s){let e="",t="",n="",r="",o="",a=!0,l="https",d=443;if(typeof s=="string"){let c=s.indexOf("//");c>=0&&(l=s.substring(0,c-1),s=s.substring(c+2));let u=s.indexOf("/");u===-1&&(u=s.length);let h=s.indexOf("?");h===-1&&(h=s.length),e=s.substring(0,Math.min(u,h)),u<h&&(r=ld(s.substring(u,h)));const m=cd(s.substring(Math.min(s.length,h)));c=e.indexOf(":"),c>=0?(a=l==="https"||l==="wss",d=parseInt(e.substring(c+1),10)):c=e.length;const f=e.slice(0,c);if(f.toLowerCase()==="localhost")t="localhost";else if(f.split(".").length<=2)t=f;else{const g=e.indexOf(".");n=e.substring(0,g).toLowerCase(),t=e.substring(g+1),o=n}"ns"in m&&(o=m.ns)}return{host:e,port:d,domain:t,subdomain:n,secure:a,scheme:l,pathString:r,namespace:o}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hd{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+F(this.snapshot.exportVal())}}class ud{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class md{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return x(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fn{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return j(this._path)?null:qs(this._path)}get ref(){return new re(this._repo,this._path)}get _queryIdentifier(){const e=Un(this._queryParams),t=Ls(e);return t==="{}"?"default":t}get _queryObject(){return Un(this._queryParams)}isEqual(e){if(e=ct(e),!(e instanceof fn))return!1;const t=this._repo===e._repo,n=zi(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+Za(this._path)}}class re extends fn{constructor(e,t){super(e,t,new Vs,!1)}get parent(){const e=Ui(this._path);return e===null?null:new re(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class at{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new P(e),n=Cs(this.ref,e);return new at(this._node.getChild(t),n,M)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(n,r)=>e(new at(r,Cs(this.ref,n),M)))}hasChild(e){const t=new P(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function pn(s,e){return s=ct(s),s._checkNotDeleted("ref"),e!==void 0?Cs(s._root,e):s._root}function Cs(s,e){return s=ct(s),S(s._path)===null?Hc("child","path",e):Nr("child","path",e),new re(s._repo,D(s._path,e))}function Ir(s,e){s=ct(s),Vc("set",s._path),qc("set",e,s._path);const t=new Ut;return sd(s._repo,s._path,e,null,t.wrapCallback(()=>{})),t.promise}function fd(s,e){zc("update",e,s._path);const t=new Ut;return nd(s._repo,s._path,e,t.wrapCallback(()=>{})),t.promise}function pd(s){s=ct(s);const e=new md(()=>{}),t=new gn(e);return td(s._repo,s,t).then(n=>new at(n,new re(s._repo,s._path),s._queryParams.getIndex()))}class gn{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const n=t._queryParams.getIndex();return new hd("value",this,new at(e.snapshotNode,new re(t._repo,t._path),n))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new ud(this,e,t):null}matches(e){return e instanceof gn?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}hc(re);gc(re);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gd="FIREBASE_DATABASE_EMULATOR_HOST",js={};let xd=!1;function _d(s,e,t,n,r){let o=n||s.options.databaseURL;o===void 0&&(s.options.projectId||_e("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),U("Using default host for project ",s.options.projectId),o=`${s.options.projectId}-default-rtdb.firebaseio.com`);let a=ti(o,r),l=a.repoInfo,d;typeof process<"u"&&Nn&&(d=Nn[gd]),d?(o=`http://${d}?ns=${l.namespace}`,a=ti(o,r),l=a.repoInfo):a.repoInfo.secure;const c=new Sa(s.name,s.options,e);Yc("Invalid Firebase Database URL",a),j(a.path)||_e("Database URL must point to the root of a Firebase Database (not including a child path).");const u=vd(l,s,c,new ja(s.name,t));return new wd(u,s)}function yd(s,e){const t=js[e];(!t||t[s.key]!==s)&&_e(`Database ${e}(${s.repoInfo_}) has already been deleted.`),rd(s),delete t[s.key]}function vd(s,e,t,n){let r=js[e.name];r||(r={},js[e.name]=r);let o=r[s.toURLString()];return o&&_e("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),o=new Xc(s,xd,t,n),r[s.toURLString()]=o,o}class wd{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Jc(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new re(this._repo,E())),this._rootInternal}_delete(){return this._rootInternal!==null&&(yd(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&_e("Cannot call "+e+" on a deleted database.")}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bd(s){ca(mo),to(new so("database",(e,{instanceIdentifier:t})=>{const n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),o=e.getProvider("app-check-internal");return _d(n,r,o,t)},"PUBLIC").setMultipleInstances(!0)),vn(Cn,jn,s),vn(Cn,jn,"esm2017")}ie.prototype.simpleListen=function(s,e){this.sendRequest("q",{p:s},e)};ie.prototype.echo=function(s,e){this.sendRequest("echo",{d:s},e)};bd();async function Ge(s){try{const e=pn(ht,`users/${s}`),t=await pd(e);if(!t.exists()){const n={email:"",phone:"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};return await Ir(e,n),{id:s,...n}}return{id:s,...t.val()}}catch(e){return console.error("Error fetching user profile:",e),v.error("Unable to load profile"),null}}async function Nd(s,e){try{const t=pn(ht,`users/${s}`),n={...e,updatedAt:new Date().toISOString()};await fd(t,n)}catch(t){throw console.error("Error updating user profile:",t),t}}async function si(s,e){try{const t=pn(ht,`users/${s}`);await Ir(t,{...e,phone:e.phone||"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()})}catch(t){throw console.error("Error creating user profile:",t),t}}const kr=p.createContext(void 0);function Cd({children:s}){const[e,t]=p.useState(null),[n,r]=p.useState(null),[o,a]=p.useState(!0),[l,d]=p.useState(!navigator.onLine);p.useEffect(()=>{const b=()=>d(!1),N=()=>d(!0);window.addEventListener("online",b),window.addEventListener("offline",N);const A=po(fe,async H=>{if(t(H),H)try{const J=await Ge(H.uid);r(J)}catch(J){console.error("Error fetching user profile:",J),l||v.error("Unable to load profile")}else r(null);a(!1)});return()=>{window.removeEventListener("online",b),window.removeEventListener("offline",N),A()}},[l]);const w={currentUser:e,userProfile:n,login:async(b,N)=>{try{const A=await go(fe,b,N),H=await Ge(A.user.uid);r(H),v.success("Successfully logged in!")}catch(A){throw console.error("Login error:",A),v.error("Failed to login"),A}},register:async(b,N,A)=>{try{const{user:H}=await xo(fe,b,N);await si(H.uid,{name:A,email:b,phone:"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});const J=await Ge(H.uid);r(J),v.success("Successfully registered!")}catch(H){throw console.error("Registration error:",H),v.error("Failed to register"),H}},logout:async()=>{try{await _o(fe),r(null),v.success("Successfully logged out!")}catch(b){throw console.error("Logout error:",b),v.error("Failed to logout"),b}},googleSignIn:async()=>{try{const b=new yo,{user:N}=await vo(fe,b);await si(N.uid,{name:N.displayName||"",email:N.email||"",phone:"",photoURL:N.photoURL||void 0,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()});const A=await Ge(N.uid);r(A),v.success("Successfully signed in with Google!")}catch(b){throw console.error("Google sign-in error:",b),v.error("Failed to sign in with Google"),b}},resetPassword:async b=>{try{await wo(fe,b),v.success("Password reset email sent!")}catch(N){throw console.error("Password reset error:",N),v.error("Failed to send reset email"),N}},updateProfile:async b=>{if(!e)throw new Error("No user logged in");try{await Nd(e.uid,b);const N=await Ge(e.uid);r(N),v.success("Profile updated successfully!")}catch(N){throw console.error("Profile update error:",N),v.error("Failed to update profile"),N}},updatePassword:async(b,N)=>{if(!e?.email)throw new Error("No user logged in");try{const A=bo.credential(e.email,b);await No(e,A),await Co(e,N),v.success("Password updated successfully")}catch(A){throw console.error("Password update error:",A),v.error("Failed to update password"),A}},loading:o,isOffline:l};return i.jsx(kr.Provider,{value:w,children:!o&&s})}function oe(){const s=p.useContext(kr);if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");return s}const xn=(s,e="INR")=>{const t=typeof s=="string"?parseFloat(s.replace(/[^0-9.-]+/g,"")):s;return Number.isFinite(t)?new Intl.NumberFormat("en-IN",{style:"currency",currency:e,minimumFractionDigits:2,maximumFractionDigits:2}).format(t):"₹0.00"},jd=s=>{const e=s.replace(/\D/g,"");return/^(?:(?:\+|91)?[6-9]\d{9})$/.test(e)},Sd=s=>{const e=s.replace(/\D/g,"");return e.length===10?`+91${e}`:e.length===12&&e.startsWith("91")?`+${e}`:s};function ni(){const{currentUser:s,userProfile:e,updateProfile:t}=oe(),[n,r]=p.useState(!1),[o,a]=p.useState(!1),[l,d]=p.useState({name:e?.name||s?.displayName||"",phone:e?.phone||"",email:s?.email||""});p.useEffect(()=>{e&&d({name:e.name||s?.displayName||"",phone:e.phone||"",email:s?.email||""})},[e,s]);const c=m=>{let f=m.target.value;if(f=f.replace(/[^\d+]/g,""),!f.startsWith("+91")&&f.length>0&&(f="+91"+f),f.startsWith("+91")){const g=f.slice(3);g.length>10&&(f="+91"+g.slice(0,10))}d(g=>({...g,phone:f}))},u=async m=>{m.preventDefault(),a(!0);try{if(l.phone&&!jd(l.phone)){v.error("Please enter a valid Indian mobile number");return}const f=l.phone?Sd(l.phone):"";await t({name:l.name.trim(),phone:f,email:l.email.trim()}),r(!1),v.success("Profile updated successfully")}catch(f){console.error("Failed to update profile:",f),v.error("Failed to update profile")}finally{a(!1)}},h=()=>{d({name:e?.name||s?.displayName||"",phone:e?.phone||"",email:s?.email||""}),r(!1)};return i.jsxs("div",{className:"text-white",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Account Overview"}),i.jsxs("div",{className:"bg-white/10 rounded-xl p-6",children:[i.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[s?.photoURL?i.jsx("img",{src:s.photoURL,alt:"Profile",className:"w-20 h-20 rounded-full object-cover"}):i.jsx("div",{className:"w-20 h-20 rounded-full bg-accent-600 flex items-center justify-center",children:i.jsx(dt,{className:"w-10 h-10 text-white"})}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-xl font-semibold",children:e?.name||s?.displayName||"User"}),i.jsx("p",{className:"text-white/70",children:s?.email})]})]}),n?i.jsxs("form",{onSubmit:u,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Full Name"}),i.jsx("input",{type:"text",value:l.name,onChange:m=>d({...l,name:m.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20 text-white",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Email"}),i.jsx("input",{type:"email",value:l.email,onChange:m=>d({...l,email:m.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20 text-white",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Phone Number"}),i.jsx("input",{type:"tel",value:l.phone,onChange:c,className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20 text-white",placeholder:"+91"}),i.jsx("p",{className:"text-sm text-white/50 mt-1",children:"Format: +91 followed by 10 digits"})]}),i.jsxs("div",{className:"flex space-x-4",children:[i.jsx("button",{type:"submit",disabled:o,className:"px-6 py-2 bg-accent-600 text-white rounded-lg hover:bg-accent-700 disabled:opacity-50",children:o?"Saving...":"Save Changes"}),i.jsx("button",{type:"button",onClick:h,disabled:o,className:"px-6 py-2 border border-white/20 rounded-lg hover:bg-white/10",children:"Cancel"})]})]}):i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("p",{className:"text-sm text-white/70",children:"Phone Number"}),i.jsx("p",{className:"font-medium",children:e?.phone||"Not set"})]}),i.jsx("button",{onClick:()=>r(!0),className:"px-6 py-2 border border-white/20 rounded-lg hover:bg-white/10",children:"Edit Profile"})]})]})]})}const Ed=async s=>{const e=jo(ht,"products",s),t=await So(e);return t.exists()?{id:t.id,...t.data()}:null},Id=async s=>{const e=Eo(ko(ht,"orders"),Io("userId","==",s));return(await Po(e)).docs.map(n=>({id:n.id,...n.data()}))};function kd(){const[s,e]=p.useState([]),[t,n]=p.useState(!0),{currentUser:r}=oe();return p.useEffect(()=>{(async()=>{try{if(r){const a=await Id(r.uid);e(a)}}catch(a){console.error("Failed to fetch orders:",a)}finally{n(!1)}})()},[r]),t?i.jsx("div",{className:"flex justify-center items-center h-64",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-white"})}):s.length===0?i.jsxs("div",{className:"text-center text-white py-12",children:[i.jsx(Le,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),i.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No Orders Yet"}),i.jsx("p",{className:"text-white/70",children:"Start shopping to see your orders here"})]}):i.jsxs("div",{className:"text-white",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Your Orders"}),i.jsx("div",{className:"space-y-4",children:s.map(o=>i.jsxs("div",{className:"bg-white/10 rounded-xl p-6",children:[i.jsxs("div",{className:"flex justify-between items-start mb-4",children:[i.jsxs("div",{children:[i.jsxs("p",{className:"text-sm text-white/70",children:["Order #",o.id]}),i.jsxs("p",{className:"text-sm text-white/70",children:["Placed on ",new Date(o.createdAt).toLocaleDateString()]})]}),i.jsx("span",{className:`px-3 py-1 rounded-full text-sm ${o.status==="delivered"?"bg-green-500/20 text-green-300":o.status==="processing"?"bg-blue-500/20 text-blue-300":"bg-yellow-500/20 text-yellow-300"}`,children:o.status.charAt(0).toUpperCase()+o.status.slice(1)})]}),i.jsx("div",{className:"space-y-4",children:o.items.map(a=>i.jsxs("div",{className:"flex items-center space-x-4",children:[i.jsx("img",{src:a.image,alt:a.name,className:"w-16 h-16 object-cover rounded-lg"}),i.jsxs("div",{className:"flex-1",children:[i.jsx("h4",{className:"font-medium",children:a.name}),i.jsxs("p",{className:"text-sm text-white/70",children:["Quantity: ",a.quantity]})]}),i.jsxs("p",{className:"font-medium",children:["$",a.price.toFixed(2)]})]},a.id))}),i.jsxs("div",{className:"mt-6 flex justify-between items-center pt-4 border-t border-white/10",children:[i.jsx("div",{children:i.jsxs("p",{className:"font-medium",children:["Total: $",o.totalAmount.toFixed(2)]})}),i.jsxs("button",{className:"flex items-center space-x-2 text-accent-400 hover:text-accent-300",children:[i.jsx("span",{children:"View Details"}),i.jsx(xe,{className:"w-4 h-4"})]})]})]},o.id))})]})}function Pd(){const{currentUser:s,updateEmail:e,updatePassword:t}=oe(),[n,r]=p.useState(!1),[o,a]=p.useState(!1),[l,d]=p.useState(!1),[c,u]=p.useState({currentPassword:"",newPassword:"",confirmPassword:"",newEmail:""}),h=async f=>{if(f.preventDefault(),c.newPassword!==c.confirmPassword){v.error("New passwords do not match");return}if(c.newPassword.length<6){v.error("Password must be at least 6 characters long");return}d(!0);try{await t(c.currentPassword,c.newPassword),r(!1),u({...c,currentPassword:"",newPassword:"",confirmPassword:""}),v.success("Password updated successfully")}catch(g){console.error("Failed to update password:",g),v.error("Failed to update password. Please check your current password.")}finally{d(!1)}},m=async f=>{f.preventDefault(),d(!0);try{await e(c.newEmail),a(!1),u({...c,newEmail:""}),v.success("Email updated successfully")}catch(g){console.error("Failed to update email:",g),v.error("Failed to update email. Please try again.")}finally{d(!1)}};return i.jsxs("div",{className:"text-white",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Login & Security"}),i.jsxs("div",{className:"space-y-6",children:[i.jsxs("div",{className:"bg-white/10 rounded-xl p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(Es,{className:"w-5 h-5 text-accent-400"}),i.jsx("h3",{className:"text-lg font-semibold",children:"Email Address"})]}),i.jsx("button",{onClick:()=>a(!o),className:"text-accent-400 hover:text-accent-300",children:"Change"})]}),o?i.jsxs("form",{onSubmit:m,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"New Email"}),i.jsx("input",{type:"email",value:c.newEmail,onChange:f=>u({...c,newEmail:f.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]}),i.jsxs("div",{className:"flex space-x-4",children:[i.jsx("button",{type:"submit",disabled:l,className:"px-6 py-2 bg-accent-600 rounded-lg hover:bg-accent-700 disabled:opacity-50",children:l?"Updating...":"Update Email"}),i.jsx("button",{type:"button",onClick:()=>a(!1),disabled:l,className:"px-6 py-2 border border-white/20 rounded-lg hover:bg-white/10",children:"Cancel"})]})]}):i.jsx("p",{className:"text-white/70",children:s?.email})]}),i.jsxs("div",{className:"bg-white/10 rounded-xl p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(Is,{className:"w-5 h-5 text-accent-400"}),i.jsx("h3",{className:"text-lg font-semibold",children:"Password"})]}),i.jsx("button",{onClick:()=>r(!n),className:"text-accent-400 hover:text-accent-300",children:"Change"})]}),n&&i.jsxs("form",{onSubmit:h,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Current Password"}),i.jsx("input",{type:"password",value:c.currentPassword,onChange:f=>u({...c,currentPassword:f.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"New Password"}),i.jsx("input",{type:"password",value:c.newPassword,onChange:f=>u({...c,newPassword:f.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0,minLength:6})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Confirm New Password"}),i.jsx("input",{type:"password",value:c.confirmPassword,onChange:f=>u({...c,confirmPassword:f.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]}),i.jsxs("div",{className:"flex space-x-4",children:[i.jsx("button",{type:"submit",disabled:l,className:"px-6 py-2 bg-accent-600 rounded-lg hover:bg-accent-700 disabled:opacity-50",children:l?"Updating...":"Update Password"}),i.jsx("button",{type:"button",onClick:()=>{r(!1),u({...c,currentPassword:"",newPassword:"",confirmPassword:""})},disabled:l,className:"px-6 py-2 border border-white/20 rounded-lg hover:bg-white/10",children:"Cancel"})]})]})]}),i.jsx("div",{className:"bg-white/10 rounded-xl p-6",children:i.jsxs("div",{className:"flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center space-x-3",children:[i.jsx(li,{className:"w-5 h-5 text-accent-400"}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-lg font-semibold",children:"Two-Factor Authentication"}),i.jsx("p",{className:"text-sm text-white/70",children:"Add an extra layer of security to your account"})]})]}),i.jsx("button",{className:"px-6 py-2 border border-white/20 rounded-lg hover:bg-white/10",children:"Set Up"})]})})]})]})}function Td(){const[s,e]=p.useState([]),[t,n]=p.useState(!1),[r,o]=p.useState(null),[a,l]=p.useState({name:"",street:"",city:"",state:"",zipCode:"",country:"",isDefault:!1}),d=h=>{if(h.preventDefault(),r)e(s.map(m=>m.id===r.id?{...a,id:r.id}:m));else{const m={...a,id:Date.now().toString()};e([...s,m])}n(!1),o(null),l({name:"",street:"",city:"",state:"",zipCode:"",country:"",isDefault:!1})},c=h=>{o(h),l(h),n(!0)},u=h=>{e(s.filter(m=>m.id!==h))};return i.jsxs("div",{className:"text-white",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsx("h2",{className:"text-2xl font-bold",children:"Your Addresses"}),i.jsxs("button",{onClick:()=>n(!0),className:"flex items-center space-x-2 px-4 py-2 bg-accent-600 rounded-lg hover:bg-accent-700",children:[i.jsx(ci,{className:"w-4 h-4"}),i.jsx("span",{children:"Add Address"})]})]}),t&&i.jsxs("div",{className:"bg-white/10 rounded-xl p-6 mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold mb-4",children:r?"Edit Address":"Add New Address"}),i.jsxs("form",{onSubmit:d,className:"space-y-4",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Full Name"}),i.jsx("input",{type:"text",value:a.name,onChange:h=>l({...a,name:h.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Street Address"}),i.jsx("input",{type:"text",value:a.street,onChange:h=>l({...a,street:h.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"City"}),i.jsx("input",{type:"text",value:a.city,onChange:h=>l({...a,city:h.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"State"}),i.jsx("input",{type:"text",value:a.state,onChange:h=>l({...a,state:h.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"ZIP Code"}),i.jsx("input",{type:"text",value:a.zipCode,onChange:h=>l({...a,zipCode:h.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Country"}),i.jsx("input",{type:"text",value:a.country,onChange:h=>l({...a,country:h.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]})]}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("input",{type:"checkbox",id:"isDefault",checked:a.isDefault,onChange:h=>l({...a,isDefault:h.target.checked}),className:"rounded border-white/20 bg-white/10 text-accent-600 focus:ring-accent-500"}),i.jsx("label",{htmlFor:"isDefault",className:"text-sm",children:"Set as default address"})]}),i.jsxs("div",{className:"flex space-x-4",children:[i.jsx("button",{type:"submit",className:"px-6 py-2 bg-accent-600 rounded-lg hover:bg-accent-700",children:r?"Update Address":"Add Address"}),i.jsx("button",{type:"button",onClick:()=>{n(!1),o(null)},className:"px-6 py-2 border border-white/20 rounded-lg hover:bg-white/10",children:"Cancel"})]})]})]}),i.jsx("div",{className:"space-y-4",children:s.length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(ks,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),i.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No Addresses Yet"}),i.jsx("p",{className:"text-white/70",children:"Add your first address to get started"})]}):s.map(h=>i.jsx("div",{className:"bg-white/10 rounded-xl p-6",children:i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"font-semibold",children:h.name}),i.jsx("p",{className:"text-white/70",children:h.street}),i.jsxs("p",{className:"text-white/70",children:[h.city,", ",h.state," ",h.zipCode]}),i.jsx("p",{className:"text-white/70",children:h.country}),h.isDefault&&i.jsx("span",{className:"inline-block mt-2 px-2 py-1 bg-accent-600/20 text-accent-400 text-sm rounded",children:"Default Address"})]}),i.jsxs("div",{className:"flex space-x-2",children:[i.jsx("button",{onClick:()=>c(h),className:"p-2 hover:bg-white/10 rounded-lg",children:i.jsx(Ps,{className:"w-4 h-4"})}),i.jsx("button",{onClick:()=>u(h.id),className:"p-2 hover:bg-white/10 rounded-lg text-red-400",children:i.jsx(Ts,{className:"w-4 h-4"})})]})]})},h.id))})]})}function Rd(){const[s,e]=p.useState([]),[t,n]=p.useState(!1),[r,o]=p.useState({cardNumber:"",expiryDate:"",cardHolder:"",isDefault:!1}),a=c=>{c.preventDefault();const u={...r,id:Date.now().toString(),cardNumber:r.cardNumber.replace(/\s/g,"").slice(-4)};e([...s,u]),n(!1),o({cardNumber:"",expiryDate:"",cardHolder:"",isDefault:!1})},l=c=>{e(u=>u.filter(h=>h.id!==c))},d=c=>{const h=c.replace(/\s+/g,"").replace(/[^0-9]/gi,"").match(/\d{4,16}/g),m=h&&h[0]||"",f=[];for(let g=0,_=m.length;g<_;g+=4)f.push(m.substring(g,g+4));return f.length?f.join(" "):c};return i.jsxs("div",{className:"text-white",children:[i.jsxs("div",{className:"flex justify-between items-center mb-6",children:[i.jsx("h2",{className:"text-2xl font-bold",children:"Payment Methods"}),i.jsxs("button",{onClick:()=>n(!0),className:"flex items-center space-x-2 px-4 py-2 bg-accent-600 rounded-lg hover:bg-accent-700",children:[i.jsx(ci,{className:"w-4 h-4"}),i.jsx("span",{children:"Add Payment Method"})]})]}),t&&i.jsxs("div",{className:"bg-white/10 rounded-xl p-6 mb-6",children:[i.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Add New Payment Method"}),i.jsxs("form",{onSubmit:a,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Card Number"}),i.jsx("input",{type:"text",value:r.cardNumber,onChange:c=>o({...r,cardNumber:d(c.target.value)}),maxLength:19,className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Expiry Date"}),i.jsx("input",{type:"text",value:r.expiryDate,onChange:c=>{const u=c.target.value.replace(/\D/g,"");if(u.length<=4){const h=u.slice(0,2),m=u.slice(2);o({...r,expiryDate:u.length>2?`${h}/${m}`:h})}},placeholder:"MM/YY",maxLength:5,className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Card Holder"}),i.jsx("input",{type:"text",value:r.cardHolder,onChange:c=>o({...r,cardHolder:c.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20",required:!0})]})]}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx("input",{type:"checkbox",id:"isDefault",checked:r.isDefault,onChange:c=>o({...r,isDefault:c.target.checked}),className:"rounded border-white/20 bg-white/10 text-accent-600 focus:ring-accent-500"}),i.jsx("label",{htmlFor:"isDefault",className:"text-sm",children:"Set as default payment method"})]}),i.jsxs("div",{className:"flex space-x-4",children:[i.jsx("button",{type:"submit",className:"px-6 py-2 bg-accent-600 rounded-lg hover:bg-accent-700",children:"Add Card"}),i.jsx("button",{type:"button",onClick:()=>n(!1),className:"px-6 py-2 border border-white/20 rounded-lg hover:bg-white/10",children:"Cancel"})]})]})]}),i.jsx("div",{className:"space-y-4",children:s.length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx(St,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),i.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No Payment Methods"}),i.jsx("p",{className:"text-white/70",children:"Add your first payment method to get started"})]}):s.map(c=>i.jsx("div",{className:"bg-white/10 rounded-xl p-6",children:i.jsxs("div",{className:"flex justify-between items-start",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(St,{className:"w-5 h-5"}),i.jsxs("h3",{className:"font-semibold",children:["•••• ",c.cardNumber]})]}),i.jsxs("p",{className:"text-white/70 mt-1",children:["Expires ",c.expiryDate]}),i.jsx("p",{className:"text-white/70",children:c.cardHolder}),c.isDefault&&i.jsx("span",{className:"inline-block mt-2 px-2 py-1 bg-accent-600/20 text-accent-400 text-sm rounded",children:"Default Payment Method"})]}),i.jsx("button",{onClick:()=>l(c.id),className:"p-2 hover:bg-white/10 rounded-lg text-red-400",children:i.jsx(Ts,{className:"w-4 h-4"})})]})},c.id))})]})}const Ad=[{id:"orders",title:"Order Updates",description:"Get notified about your order status and delivery updates",email:!0,sms:!0,push:!0},{id:"promotions",title:"Promotions & Deals",description:"Receive updates about sales, discounts, and special offers",email:!0,sms:!1,push:!0},{id:"security",title:"Security Alerts",description:"Important updates about your account security",email:!0,sms:!0,push:!0},{id:"newsletter",title:"Newsletter",description:"Weekly updates about new products and trends",email:!0,sms:!1,push:!1}];function Dd(){const[s,e]=p.useState(Ad),t=(n,r)=>{e(o=>o.map(a=>a.id===n?{...a,[r]:!a[r]}:a))};return i.jsxs("div",{className:"text-white",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Notification Settings"}),i.jsxs("div",{className:"bg-white/10 rounded-xl p-6 mb-6",children:[i.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[i.jsx("div",{className:"w-12 h-12 bg-accent-600 rounded-full flex items-center justify-center",children:i.jsx(Ze,{className:"w-6 h-6"})}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-xl font-semibold",children:"Manage Notifications"}),i.jsx("p",{className:"text-white/70",children:"Choose how you want to be notified"})]})]}),i.jsx("div",{className:"space-y-6",children:s.map(n=>i.jsxs("div",{className:"pb-6 border-b border-white/10 last:border-0",children:[i.jsxs("div",{className:"mb-4",children:[i.jsx("h4",{className:"font-medium",children:n.title}),i.jsx("p",{className:"text-sm text-white/70",children:n.description})]}),i.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[i.jsx("div",{children:i.jsxs("label",{className:"flex items-center space-x-3",children:[i.jsx("input",{type:"checkbox",checked:n.email,onChange:()=>t(n.id,"email"),className:"rounded border-white/20 bg-white/10 text-accent-600 focus:ring-accent-500"}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(Es,{className:"w-4 h-4"}),i.jsx("span",{className:"text-sm",children:"Email"})]})]})}),i.jsx("div",{children:i.jsxs("label",{className:"flex items-center space-x-3",children:[i.jsx("input",{type:"checkbox",checked:n.sms,onChange:()=>t(n.id,"sms"),className:"rounded border-white/20 bg-white/10 text-accent-600 focus:ring-accent-500"}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(li,{className:"w-4 h-4"}),i.jsx("span",{className:"text-sm",children:"SMS"})]})]})}),i.jsx("div",{children:i.jsxs("label",{className:"flex items-center space-x-3",children:[i.jsx("input",{type:"checkbox",checked:n.push,onChange:()=>t(n.id,"push"),className:"rounded border-white/20 bg-white/10 text-accent-600 focus:ring-accent-500"}),i.jsxs("div",{className:"flex items-center space-x-2",children:[i.jsx(To,{className:"w-4 h-4"}),i.jsx("span",{className:"text-sm",children:"Push"})]})]})})]})]},n.id))})]}),i.jsxs("div",{className:"bg-white/10 rounded-xl p-6",children:[i.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Quiet Hours"}),i.jsx("p",{className:"text-white/70 mb-4",children:"During these hours, you won't receive any notifications except for critical security alerts"}),i.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"Start Time"}),i.jsx("input",{type:"time",defaultValue:"22:00",className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium mb-1",children:"End Time"}),i.jsx("input",{type:"time",defaultValue:"07:00",className:"w-full px-4 py-2 rounded-lg bg-white/10 border border-white/20"})]})]})]})]})}const Md=[{id:"personalization",title:"Personalized Recommendations",description:"Allow us to use your browsing history to show relevant products",enabled:!0},{id:"analytics",title:"Analytics & Improvements",description:"Help us improve our services by sharing usage data",enabled:!0},{id:"marketing",title:"Marketing Communications",description:"Receive personalized marketing communications",enabled:!1},{id:"thirdParty",title:"Third-Party Sharing",description:"Share data with trusted partners for better services",enabled:!1}];function Ld(){const[s,e]=p.useState(Md),t=n=>{e(r=>r.map(o=>o.id===n?{...o,enabled:!o.enabled}:o))};return i.jsxs("div",{className:"text-white",children:[i.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Privacy Settings"}),i.jsxs("div",{className:"bg-white/10 rounded-xl p-6",children:[i.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[i.jsx("div",{className:"w-12 h-12 bg-accent-600 rounded-full flex items-center justify-center",children:i.jsx(Ht,{className:"w-6 h-6"})}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-xl font-semibold",children:"Data Privacy"}),i.jsx("p",{className:"text-white/70",children:"Manage how your data is used and shared"})]})]}),i.jsx("div",{className:"space-y-6",children:s.map(n=>i.jsxs("div",{className:"flex items-center justify-between pb-6 border-b border-white/10 last:border-0",children:[i.jsxs("div",{children:[i.jsx("h4",{className:"font-medium",children:n.title}),i.jsx("p",{className:"text-sm text-white/70",children:n.description})]}),i.jsx("button",{onClick:()=>t(n.id),className:"text-accent-400",children:n.enabled?i.jsx(Ro,{className:"w-10 h-10"}):i.jsx(Ao,{className:"w-10 h-10 text-white/50"})})]},n.id))})]})]})}const Od=[{id:"overview",label:"Account Overview",icon:dt},{id:"orders",label:"Your Orders",icon:Le},{id:"security",label:"Login & Security",icon:Is},{id:"addresses",label:"Your Addresses",icon:ks},{id:"payments",label:"Payment Methods",icon:St},{id:"notifications",label:"Notifications",icon:Ze},{id:"privacy",label:"Privacy Settings",icon:Ht}];function Fd({isOpen:s,onClose:e}){const[t,n]=p.useState("overview"),[r,o]=p.useState({x:0,y:0}),{currentUser:a,logout:l}=oe();if(p.useEffect(()=>{const u=()=>{o({x:window.scrollX*.1,y:window.scrollY*.1})};return s&&(window.addEventListener("scroll",u),document.body.style.overflow="hidden"),()=>{window.removeEventListener("scroll",u),document.body.style.overflow=""}},[s]),!s||!a)return null;const d=async()=>{try{await l(),e()}catch(u){console.error("Logout failed:",u)}},c=()=>{switch(t){case"overview":return i.jsx(ni,{});case"orders":return i.jsx(kd,{});case"security":return i.jsx(Pd,{});case"addresses":return i.jsx(Td,{});case"payments":return i.jsx(Rd,{});case"notifications":return i.jsx(Dd,{});case"privacy":return i.jsx(Ld,{});default:return i.jsx(ni,{})}};return i.jsxs("div",{className:"fixed inset-0 z-50 overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:e}),i.jsx("div",{className:"absolute inset-0 bg-cover bg-center",style:{backgroundImage:'url("https://images.unsplash.com/photo-1620641788421-7a1c342ea42e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1974&q=80")',transform:`translate(${r.x}px, ${r.y}px)`,transition:"transform 0.1s ease-out"},children:i.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm"})}),i.jsx("div",{className:"relative min-h-screen flex items-center justify-center p-4",children:i.jsx("div",{className:"bg-white/10 backdrop-blur-md w-full max-w-6xl rounded-2xl shadow-2xl overflow-hidden border border-white/20",children:i.jsxs("div",{className:"flex h-[80vh]",children:[i.jsxs("div",{className:"w-64 bg-black/20 p-6 space-y-6",children:[i.jsxs("div",{className:"flex items-center space-x-3 mb-8",children:[a.photoURL?i.jsx("img",{src:a.photoURL,alt:"Profile",className:"w-10 h-10 rounded-full"}):i.jsx("div",{className:"w-10 h-10 rounded-full bg-accent-600 flex items-center justify-center",children:i.jsx(dt,{className:"w-6 h-6 text-white"})}),i.jsxs("div",{className:"text-white",children:[i.jsx("p",{className:"font-medium",children:a.displayName||"User"}),i.jsx("p",{className:"text-sm text-white/70",children:a.email})]})]}),i.jsx("nav",{className:"space-y-2",children:Od.map(u=>i.jsxs("button",{onClick:()=>n(u.id),className:`w-full flex items-center space-x-3 px-4 py-2 rounded-lg transition-colors ${t===u.id?"bg-white/20 text-white":"text-white/70 hover:bg-white/10 hover:text-white"}`,children:[i.jsx(u.icon,{className:"w-5 h-5"}),i.jsx("span",{children:u.label})]},u.id))}),i.jsxs("button",{onClick:d,className:"w-full flex items-center space-x-3 px-4 py-2 rounded-lg text-white/70 hover:bg-white/10 hover:text-white transition-colors mt-auto",children:[i.jsx(Do,{className:"w-5 h-5"}),i.jsx("span",{children:"Log Out"})]})]}),i.jsxs("div",{className:"flex-1 p-8 overflow-y-auto",children:[i.jsx("button",{onClick:e,className:"absolute top-4 right-4 text-white/70 hover:text-white",children:i.jsx(Vt,{className:"w-6 h-6"})}),i.jsx("div",{className:"max-w-3xl mx-auto",children:c()})]})]})})})]})}function Wd(){const[s,e]=p.useState(!1),[t,n]=p.useState(!1),{currentUser:r}=oe(),o=be();return i.jsxs(i.Fragment,{children:[i.jsxs("nav",{className:"bg-white shadow-md fixed w-full z-50",children:[i.jsx("div",{className:"max-w-7xl mx-auto px-4",children:i.jsxs("div",{className:"flex justify-between items-center h-16",children:[i.jsx(L,{to:"/",className:"text-2xl font-bold text-accent-600 tracking-tight",children:"MSPL Store"}),i.jsxs("div",{className:"hidden md:flex space-x-8",children:[i.jsx(L,{to:"/electronics",className:"text-primary-700 hover:text-accent-600 transition-colors",children:"Electronics"}),i.jsx(L,{to:"/men",className:"text-primary-700 hover:text-accent-600 transition-colors",children:"Men"}),i.jsx(L,{to:"/women",className:"text-primary-700 hover:text-accent-600 transition-colors",children:"Women"}),i.jsx(L,{to:"/watches",className:"text-primary-700 hover:text-accent-600 transition-colors",children:"Watches"})]}),i.jsxs("div",{className:"flex items-center space-x-6",children:[i.jsx("button",{onClick:()=>r?n(!0):o("/login"),className:"text-primary-700 hover:text-accent-600 transition-colors",children:i.jsx(dt,{className:"h-6 w-6"})}),i.jsx(L,{to:"/cart",className:"text-primary-700 hover:text-accent-600 transition-colors",children:i.jsx(Le,{className:"h-6 w-6"})}),i.jsx("button",{onClick:()=>e(!s),className:"md:hidden text-primary-700",children:s?i.jsx(Vt,{className:"h-6 w-6"}):i.jsx(Mo,{className:"h-6 w-6"})})]})]})}),s&&i.jsx("div",{className:"md:hidden border-t border-gray-200 py-4",children:i.jsxs("div",{className:"flex flex-col space-y-4",children:[i.jsx(L,{to:"/electronics",className:"text-primary-700 hover:text-accent-600 px-4",onClick:()=>e(!1),children:"Electronics"}),i.jsx(L,{to:"/men",className:"text-primary-700 hover:text-accent-600 px-4",onClick:()=>e(!1),children:"Men"}),i.jsx(L,{to:"/women",className:"text-primary-700 hover:text-accent-600 px-4",onClick:()=>e(!1),children:"Women"}),i.jsx(L,{to:"/watches",className:"text-primary-700 hover:text-accent-600 px-4",onClick:()=>e(!1),children:"Watches"})]})})]}),i.jsx(Fd,{isOpen:t,onClose:()=>n(!1)})]})}function qd(){const[s,e]=p.useState(""),t=r=>{r.preventDefault(),e("")},n=()=>{window.scrollTo({top:0,behavior:"smooth"})};return i.jsxs("footer",{className:"relative bg-gradient-to-b from-gray-900 to-black text-white",children:[i.jsx("div",{className:"absolute inset-0 opacity-5",children:i.jsx("div",{className:"absolute inset-0",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`,backgroundSize:"30px 30px"}})}),i.jsxs("div",{className:"relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-16 pb-8",children:[i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12",children:[i.jsxs("div",{className:"space-y-4",children:[i.jsx("h3",{className:"text-2xl font-bold tracking-tight",children:"MSPL Store"}),i.jsx("p",{className:"text-gray-400 text-sm",children:"Your premium destination for fashion and lifestyle. Discover curated collections that define modern luxury."}),i.jsxs("div",{className:"flex space-x-4",children:[i.jsx("a",{href:"#",className:"text-gray-400 hover:text-accent-500 transition-colors",children:i.jsx(di,{className:"w-5 h-5"})}),i.jsx("a",{href:"#",className:"text-gray-400 hover:text-accent-500 transition-colors",children:i.jsx(hi,{className:"w-5 h-5"})}),i.jsx("a",{href:"#",className:"text-gray-400 hover:text-accent-500 transition-colors",children:i.jsx(Lo,{className:"w-5 h-5"})}),i.jsx("a",{href:"#",className:"text-gray-400 hover:text-accent-500 transition-colors",children:i.jsx(Oo,{className:"w-5 h-5"})})]})]}),i.jsxs("div",{children:[i.jsx("h4",{className:"text-lg font-semibold mb-4",children:"Quick Links"}),i.jsx("ul",{className:"space-y-2",children:["About Us","FAQs","Privacy Policy"].map(r=>i.jsx("li",{children:i.jsxs(L,{to:`/${r.toLowerCase().replace(/\s+/g,"-")}`,className:"text-gray-400 hover:text-white transition-colors inline-flex items-center group",children:[i.jsx(xe,{className:"w-4 h-4 mr-1 transform group-hover:translate-x-1 transition-transform"}),r]})},r))})]}),i.jsxs("div",{children:[i.jsx("h4",{className:"text-lg font-semibold mb-4",children:"Contact Us"}),i.jsxs("ul",{className:"space-y-4",children:[i.jsxs("li",{className:"flex items-start space-x-3 text-gray-400",children:[i.jsx(ks,{className:"w-5 h-5 mt-0.5 text-accent-500"}),i.jsx("span",{children:"123 Fashion Street, Style City, ST 12345"})]}),i.jsxs("li",{className:"flex items-center space-x-3 text-gray-400",children:[i.jsx(Fo,{className:"w-5 h-5 text-accent-500"}),i.jsx("span",{children:"+1 (555) 123-4567"})]}),i.jsxs("li",{className:"flex items-center space-x-3 text-gray-400",children:[i.jsx(Es,{className:"w-5 h-5 text-accent-500"}),i.jsx("span",{children:"support@msplstore.com"})]})]})]}),i.jsxs("div",{children:[i.jsx("h4",{className:"text-lg font-semibold mb-4",children:"Newsletter"}),i.jsx("p",{className:"text-gray-400 text-sm mb-4",children:"Subscribe to receive updates, access to exclusive deals, and more."}),i.jsx("form",{onSubmit:t,className:"space-y-2",children:i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:"email",value:s,onChange:r=>e(r.target.value),placeholder:"Enter your email",className:"w-full px-4 py-2 bg-white/10 border border-white/20 rounded-lg focus:outline-none focus:border-accent-500 text-white placeholder-gray-400",required:!0}),i.jsx("button",{type:"submit",className:"absolute right-2 top-1/2 -translate-y-1/2 text-accent-500 hover:text-accent-400",children:i.jsx(xe,{className:"w-5 h-5"})})]})})]})]}),i.jsxs("div",{className:"mt-12 pt-8 border-t border-white/10 flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0",children:[i.jsxs("p",{className:"text-gray-400 text-sm",children:["© ",new Date().getFullYear()," MSPL Store. All rights reserved."]}),i.jsxs("div",{className:"flex space-x-6 text-sm text-gray-400",children:[i.jsx(L,{to:"/terms",className:"hover:text-white transition-colors",children:"Terms"}),i.jsx(L,{to:"/privacy",className:"hover:text-white transition-colors",children:"Privacy"}),i.jsx(L,{to:"/cookies",className:"hover:text-white transition-colors",children:"Cookies"})]})]})]}),i.jsx("button",{onClick:n,className:"fixed bottom-8 right-8 bg-accent-600 text-white p-3 rounded-full shadow-lg hover:bg-accent-700 transition-colors focus:outline-none focus:ring-2 focus:ring-accent-500 focus:ring-offset-2","aria-label":"Back to top",children:i.jsx(Wo,{className:"w-5 h-5"})})]})}function wt({children:s,requireAuth:e=!0}){const{currentUser:t,loading:n}=oe(),r=Hr();return n?i.jsx("div",{className:"min-h-screen flex items-center justify-center",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-accent-600"})}):e&&!t?i.jsx(hs,{to:"/login",state:{from:r},replace:!0}):!e&&t?i.jsx(hs,{to:"/",replace:!0}):i.jsx(i.Fragment,{children:s})}function Ud(){const[s,e]=p.useState(""),[t,n]=p.useState(""),[r,o]=p.useState(!1),[a,l]=p.useState(!1),d=be(),{login:c}=oe(),u=async h=>{h.preventDefault(),l(!0);try{await c(s,t),d("/")}catch(m){console.error("Login error:",m)}finally{l(!1)}};return i.jsxs("div",{className:"min-h-screen flex items-center justify-center relative",children:[i.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat",style:{backgroundImage:'url("https://images.unsplash.com/photo-1620641788421-7a1c342ea42e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1974&q=80")'},children:i.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm"})}),i.jsx("div",{className:"relative w-full max-w-md p-6",children:i.jsxs("div",{className:"bg-white/10 backdrop-blur-md p-8 rounded-2xl shadow-2xl border border-white/20",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Welcome Back"}),i.jsx("p",{className:"text-gray-200",children:"Please sign in to your account"})]}),i.jsxs("form",{onSubmit:u,className:"space-y-6",children:[i.jsx("div",{children:i.jsx("input",{type:"email",placeholder:"Email",value:s,onChange:h=>e(h.target.value),className:"w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:border-white/40 transition duration-200",required:!0})}),i.jsxs("div",{className:"relative",children:[i.jsx("input",{type:r?"text":"password",placeholder:"Password",value:t,onChange:h=>n(h.target.value),className:"w-full px-4 py-3 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:border-white/40 transition duration-200",required:!0}),i.jsx("button",{type:"button",onClick:()=>o(!r),className:"absolute right-3 top-1/2 -translate-y-1/2 text-white/60 hover:text-white",children:r?i.jsx(qo,{className:"w-5 h-5"}):i.jsx(Rs,{className:"w-5 h-5"})})]}),i.jsxs("div",{className:"flex items-center justify-between text-sm",children:[i.jsxs("label",{className:"flex items-center text-white",children:[i.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded border-white/20 bg-white/10 checked:bg-blue-500 checked:border-blue-500 focus:ring-0 focus:ring-offset-0"}),i.jsx("span",{className:"ml-2",children:"Remember me"})]}),i.jsx(L,{to:"/forgot-password",className:"text-white hover:text-blue-400",children:"Forgot Password?"})]}),i.jsx("button",{type:"submit",disabled:a,className:"w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-200 disabled:opacity-50",children:a?"Signing in...":"Sign In"})]}),i.jsx("div",{className:"mt-8 text-center",children:i.jsxs("p",{className:"text-white",children:["Don't have an account?"," ",i.jsx(L,{to:"/register",className:"text-blue-400 hover:text-blue-300",children:"Sign up"})]})}),i.jsxs("div",{className:"mt-8",children:[i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"absolute inset-0 flex items-center",children:i.jsx("div",{className:"w-full border-t border-white/20"})}),i.jsx("div",{className:"relative flex justify-center text-sm",children:i.jsx("span",{className:"px-2 bg-transparent text-white",children:"Or continue with"})})]}),i.jsx("div",{className:"mt-6",children:i.jsxs("button",{type:"button",className:"w-full flex items-center justify-center gap-2 bg-white/10 hover:bg-white/20 text-white font-semibold py-3 px-4 rounded-lg transition duration-200 border border-white/20",children:[i.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[i.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),i.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),i.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),i.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})})]})]})})]})}function zd(){const[s,e]=p.useState(""),[t,n]=p.useState(""),[r,o]=p.useState(""),[a,l]=p.useState(""),[d,c]=p.useState(!1),u=be(),{register:h}=oe(),m=async f=>{if(f.preventDefault(),r!==a){toast.error("Passwords do not match");return}c(!0);try{await h(t,r,s),u("/")}catch{}finally{c(!1)}};return i.jsxs("div",{className:"max-w-md mx-auto mt-8 p-6 bg-white rounded-lg shadow-md",children:[i.jsx("h2",{className:"text-2xl font-bold text-center mb-6",children:"Register"}),i.jsxs("form",{onSubmit:m,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Full Name"}),i.jsx("input",{type:"text",id:"name",value:s,onChange:f=>e(f.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-accent-500 focus:ring-accent-500",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),i.jsx("input",{type:"email",id:"email",value:t,onChange:f=>n(f.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-accent-500 focus:ring-accent-500",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700",children:"Password"}),i.jsx("input",{type:"password",id:"password",value:r,onChange:f=>o(f.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-accent-500 focus:ring-accent-500",required:!0})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700",children:"Confirm Password"}),i.jsx("input",{type:"password",id:"confirmPassword",value:a,onChange:f=>l(f.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-accent-500 focus:ring-accent-500",required:!0})]}),i.jsx("button",{type:"submit",disabled:d,className:"w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-accent-600 hover:bg-accent-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-accent-500 disabled:opacity-50",children:d?"Creating account...":"Register"})]}),i.jsx("div",{className:"mt-4 text-center text-sm",children:i.jsxs("p",{className:"text-gray-600",children:["Already have an account?"," ",i.jsx(L,{to:"/login",className:"text-accent-600 hover:text-accent-700",children:"Login here"})]})})]})}function G({children:s,backgroundImage:e,speed:t=.5,blur:n=!1,className:r=""}){const o=p.useRef(null),a=p.useRef(null);return p.useEffect(()=>{const l=o.current,d=a.current;if(!l||!d)return;let c;const u=()=>{c=requestAnimationFrame(()=>{const h=l.getBoundingClientRect(),m=window.scrollY,f=h.top+m,g=(m-f)*t;h.top<=window.innerHeight&&h.bottom>=0&&(d.style.transform=`translate3d(0, ${g}px, 0)`)})};return window.addEventListener("scroll",u,{passive:!0}),u(),()=>{window.removeEventListener("scroll",u),cancelAnimationFrame(c)}},[t]),i.jsxs("div",{ref:o,className:`relative overflow-hidden ${r}`,children:[i.jsx("div",{ref:a,className:"absolute inset-0 bg-cover bg-center -z-10 will-change-transform",style:{backgroundImage:`url(${e})`,transform:"translate3d(0, 0, 0)"}}),n&&i.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-[1px] -z-10","aria-hidden":"true"}),s]})}const Hd=[{id:1,title:"Luxury Electronics",description:"Premium Tech & Gadgets",image:"https://images.unsplash.com/photo-1505740420928-5e560c06d30e?auto=format&fit=crop&q=80&w=3440",category:"electronics",path:"/electronics",accent:"from-blue-500/20 to-purple-500/20"},{id:2,title:"Men's Essentials",description:"Timeless Style for Modern Men",image:"https://images.unsplash.com/photo-1617127365659-c47fa864d8bc?auto=format&fit=crop&w=3440&q=80",category:"men",path:"/men",accent:"from-amber-500/20 to-red-500/20"},{id:3,title:"Women's Collection",description:"Elegance Redefined",image:"https://images.unsplash.com/photo-1490481651871-ab68de25d43d?auto=format&fit=crop&w=3440&q=80",category:"women",path:"/women",accent:"from-pink-500/20 to-rose-500/20"},{id:4,title:"Luxury Timepieces",description:"Where Time Meets Style",image:"https://images.unsplash.com/photo-1523170335258-f5ed11844a49?auto=format&fit=crop&w=3440&q=80",category:"watches",path:"/watches",accent:"from-emerald-500/20 to-teal-500/20"}];function Vd(){return i.jsx("section",{className:"py-16",children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[i.jsxs("div",{className:"text-center mb-12",children:[i.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[i.jsx(ui,{className:"w-6 h-6 text-accent-600"}),i.jsx("h2",{className:"text-3xl font-bold text-white",children:"Featured Collections"})]}),i.jsx("p",{className:"text-white/70 max-w-2xl mx-auto",children:"Explore our curated selection of premium collections, each telling a unique story of style and sophistication"})]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:Hd.map((s,e)=>i.jsxs(L,{to:s.path,className:`group relative overflow-hidden rounded-2xl bg-gradient-to-br ${s.accent} backdrop-blur-sm border border-white/10 ${e===0?"md:col-span-2 aspect-[2.4/1]":"aspect-[1.5/1]"}`,children:[i.jsx("div",{className:"absolute inset-0 bg-cover bg-center transition-transform duration-700 group-hover:scale-110",style:{backgroundImage:`url(${s.image})`}}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-black/60 via-black/40 to-transparent backdrop-blur-[1px] transition-opacity duration-300 group-hover:opacity-75"}),i.jsx("div",{className:"relative h-full flex flex-col justify-end p-8",children:i.jsxs("div",{className:"transform transition-transform duration-300 group-hover:translate-y-0 translate-y-8",children:[i.jsx("h3",{className:"text-3xl font-bold text-white mb-3",children:s.title}),i.jsx("p",{className:"text-white/80 mb-6 transform opacity-0 transition-all duration-300 group-hover:opacity-100",children:s.description}),i.jsxs("div",{className:"inline-flex items-center gap-2 text-white font-medium opacity-0 transform translate-y-4 transition-all duration-300 group-hover:opacity-100 group-hover:translate-y-0",children:[i.jsx("span",{children:"Explore Collection"}),i.jsx(mi,{className:"w-5 h-5 transition-transform duration-300 group-hover:translate-x-2"})]})]})}),i.jsx("div",{className:"absolute top-6 right-6",children:i.jsx("div",{className:"w-12 h-12 rounded-full border border-white/20 flex items-center justify-center",children:i.jsx("div",{className:"w-8 h-8 rounded-full bg-white/10 backdrop-blur-sm"})})}),i.jsx("div",{className:"absolute bottom-0 left-0 w-1/3 h-1/3 bg-gradient-to-tr from-white/5 to-transparent rounded-tr-full opacity-0 transition-opacity duration-300 group-hover:opacity-100"})]},s.id))}),i.jsx("div",{className:"absolute -top-24 -right-24 w-96 h-96 bg-accent-600/10 rounded-full blur-3xl"}),i.jsx("div",{className:"absolute -bottom-24 -left-24 w-96 h-96 bg-accent-600/10 rounded-full blur-3xl"})]})})}const Yd=[{id:1,name:"Classic White Tee",price:29.99,image:"https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?auto=format&fit=crop&q=80&w=800",category:"Men",description:"Essential cotton crew neck t-shirt in pristine white.",sizes:["S","M","L","XL"],inStock:!0},{id:2,name:"Vintage Denim Jacket",price:89.99,image:"https://images.unsplash.com/photo-1495105787522-5334e3ffa0ef?auto=format&fit=crop&q=80&w=800",category:"Men",description:"Classic denim jacket with a lived-in wash and comfortable fit.",sizes:["S","M","L","XL"],inStock:!0},{id:3,name:"Premium Chinos",price:79.99,image:"https://images.unsplash.com/photo-1473966968600-fa801b869a1a?auto=format&fit=crop&q=80&w=800",category:"Men",description:"Versatile chinos perfect for any occasion.",sizes:["30","32","34","36"],inStock:!0},{id:4,name:"Merino Wool Sweater",price:129.99,image:"https://images.unsplash.com/photo-1620799140408-edc6dcb6d633?auto=format&fit=crop&q=80&w=800",category:"Men",description:"Luxurious merino wool sweater for ultimate comfort.",sizes:["S","M","L","XL"],inStock:!0},{id:5,name:"Leather Chelsea Boots",price:199.99,image:"https://images.unsplash.com/photo-1638247025967-b4e38f787b76?auto=format&fit=crop&q=80&w=800",category:"Men",description:"Handcrafted leather Chelsea boots with premium finish.",sizes:["40","41","42","43","44"],inStock:!0},{id:6,name:"Tailored Blazer",price:249.99,image:"https://images.unsplash.com/photo-1507679799987-c73779587ccf?auto=format&fit=crop&q=80&w=800",category:"Men",description:"Sophisticated blazer for a sharp, professional look.",sizes:["S","M","L","XL"],inStock:!0},{id:7,name:"Premium Leather Belt",price:59.99,image:"https://images.unsplash.com/photo-1624222247344-550fb60583dc?auto=format&fit=crop&q=80&w=800",category:"Men",description:"Full-grain leather belt with classic buckle.",sizes:["32","34","36","38"],inStock:!0},{id:8,name:"Aviator Sunglasses",price:159.99,image:"https://images.unsplash.com/photo-1511499767150-a48a237f0083?auto=format&fit=crop&q=80&w=800",category:"Men",description:"Classic aviator sunglasses with premium lenses.",sizes:["One Size"],inStock:!0}],Gd=[{id:9,name:"Silk Blouse",price:149.99,image:"https://images.unsplash.com/photo-1485968579580-b6d095142e6e?auto=format&fit=crop&w=800&q=80",category:"Women",description:"Elegant silk blouse with refined details.",sizes:["XS","S","M","L"],inStock:!0},{id:10,name:"Designer Handbag",price:299.99,image:"https://images.unsplash.com/photo-1584917865442-de89df76afd3?auto=format&fit=crop&w=800&q=80",category:"Women",description:"Luxury designer handbag in genuine leather.",sizes:["One Size"],inStock:!0},{id:11,name:"High-Waisted Jeans",price:89.99,image:"https://images.unsplash.com/photo-1541099649105-f69ad21f3246?auto=format&fit=crop&w=800&q=80",category:"Women",description:"Perfect-fit high-waisted jeans with stretch.",sizes:["24","25","26","27","28","29","30"],inStock:!0},{id:12,name:"Evening Dress",price:279.99,image:"https://images.unsplash.com/photo-1572804013309-59a88b7e92f1?auto=format&fit=crop&w=800&q=80",category:"Women",description:"Stunning evening dress for special occasions.",sizes:["XS","S","M","L"],inStock:!0},{id:13,name:"Leather Ankle Boots",price:189.99,image:"https://images.unsplash.com/photo-1543163521-1bf539c55dd2?auto=format&fit=crop&q=80&w=800",category:"Women",description:"Stylish leather ankle boots with block heel.",sizes:["36","37","38","39","40"],inStock:!0},{id:14,name:"Cashmere Scarf",price:129.99,image:"https://images.unsplash.com/photo-1601924994987-69e26d50dc26?auto=format&fit=crop&q=80&w=800",category:"Women",description:"Luxuriously soft cashmere scarf.",sizes:["One Size"],inStock:!0},{id:15,name:"Statement Earrings",price:79.99,image:"https://images.unsplash.com/photo-1535632066927-ab7c9ab60908?auto=format&fit=crop&q=80&w=800",category:"Women",description:"Eye-catching statement earrings in gold finish.",sizes:["One Size"],inStock:!0},{id:16,name:"Midi Skirt",price:119.99,image:"https://images.unsplash.com/photo-1583496661160-fb5886a0aaaa?auto=format&fit=crop&q=80&w=800",category:"Women",description:"Elegant pleated midi skirt in seasonal colors.",sizes:["XS","S","M","L"],inStock:!0}],Bd=[{id:17,name:"Colorful T-Shirt Set",price:39.99,image:"https://images.unsplash.com/photo-1519238263530-99bdd11df2ea?auto=format&fit=crop&w=800&q=80",category:"Kids",description:"Fun and comfortable t-shirt set for active kids.",sizes:["3-4Y","4-5Y","5-6Y","6-7Y","7-8Y"],inStock:!0},{id:18,name:"Kids Denim Collection",price:49.99,image:"https://images.unsplash.com/photo-1519238360324-0fc58c85f8de?auto=format&fit=crop&w=800&q=80",category:"Kids",description:"Durable denim pieces for everyday adventures.",sizes:["3-4Y","4-5Y","5-6Y","6-7Y","7-8Y"],inStock:!0},{id:19,name:"Party Dress",price:59.99,image:"https://images.unsplash.com/photo-1518831959646-742c3a14ebf7?auto=format&fit=crop&w=800&q=80",category:"Kids",description:"Elegant party dress for special occasions.",sizes:["3-4Y","4-5Y","5-6Y","6-7Y"],inStock:!0},{id:20,name:"Sports Set",price:45.99,image:"https://images.unsplash.com/photo-1519241047957-be31d7379a5d?auto=format&fit=crop&w=800&q=80",category:"Kids",description:"Comfortable sports set for active kids.",sizes:["4-5Y","5-6Y","6-7Y","7-8Y"],inStock:!0},{id:21,name:"Winter Jacket",price:79.99,image:"https://images.unsplash.com/photo-1545291730-faff8ca1d4b0?auto=format&fit=crop&q=80&w=800",category:"Kids",description:"Warm and cozy winter jacket with fun details.",sizes:["3-4Y","4-5Y","5-6Y","6-7Y","7-8Y"],inStock:!0},{id:22,name:"Cartoon Pajama Set",price:34.99,image:"https://images.unsplash.com/photo-1595034313282-a31ff30de d9?auto=format&fit=crop&q=80&w=800",category:"Kids",description:"Soft and cute pajama set with cartoon prints.",sizes:["3-4Y","4-5Y","5-6Y","6-7Y"],inStock:!0},{id:23,name:"School Backpack",price:39.99,image:"https://images.unsplash.com/photo-1546938576-6e6a64f317cc?auto=format&fit=crop&q=80&w=800",category:"Kids",description:"Durable and spacious backpack for school.",sizes:["One Size"],inStock:!0},{id:24,name:"Kids Sneakers",price:49.99,image:"https://images.unsplash.com/photo-1514989940723-e8e51635b782?auto=format&fit=crop&q=80&w=800",category:"Kids",description:"Comfortable and stylish sneakers for active kids.",sizes:["28","29","30","31","32","33","34"],inStock:!0}],$d=[{id:25,name:"Luxury Chronograph",price:599.99,image:"https://images.unsplash.com/photo-1524592094714-0f0654e20314?auto=format&fit=crop&w=800&q=80",category:"Watches",description:"Premium chronograph watch with Swiss movement.",sizes:["One Size"],inStock:!0},{id:26,name:"Smart Watch Pro",price:399.99,image:"https://images.unsplash.com/photo-1579586337278-3befd40fd17a?auto=format&fit=crop&w=800&q=80",category:"Watches",description:"Advanced smartwatch with health monitoring features.",sizes:["One Size"],inStock:!0},{id:27,name:"Classic Gold Watch",price:799.99,image:"https://images.unsplash.com/photo-1522312346375-d1a52e2b99b3?auto=format&fit=crop&w=800&q=80",category:"Watches",description:"Timeless gold-plated watch with leather strap.",sizes:["One Size"],inStock:!0},{id:28,name:"Minimalist Watch",price:299.99,image:"https://images.unsplash.com/photo-1508685096489-7aacd43bd3b1?auto=format&fit=crop&w=800&q=80",category:"Watches",description:"Clean, minimalist design with premium materials.",sizes:["One Size"],inStock:!0}],bt=s=>s.map(e=>({...e,price:typeof e.price=="string"?parseFloat(e.price.replace(/[^0-9.-]+/g,""))*75:e.price*75})),ii=[...bt(Yd),...bt(Gd),...bt(Bd),...bt($d)],Pr=p.createContext(void 0);function Kd({children:s}){const[e,t]=p.useState(()=>{const g=localStorage.getItem("products");return g?JSON.parse(g):ii}),[n,r]=p.useState(!1),[o,a]=p.useState(null),l=g=>{localStorage.setItem("products",JSON.stringify(g))},d=p.useCallback(g=>{const _={...g,id:String(Date.now()),inStock:!0,sizes:g.sizes||["S","M","L","XL"]},w=[...e,_];t(w),l(w)},[e]),c=p.useCallback(g=>{const _=e.map(w=>w.id===g.id?g:w);t(_),l(_)},[e]),u=p.useCallback(g=>{const _=e.filter(w=>w.id!==g);t(_),l(_)},[e]),h=p.useCallback(g=>e.filter(_=>g==="All"?!0:_.category===g),[e]),m=p.useCallback(async()=>{try{r(!0),a(null);const g=localStorage.getItem("products");t(g?JSON.parse(g):ii)}catch(g){a("Failed to refresh products"),console.error("Error refreshing products:",g)}finally{r(!1)}},[]),f={products:e,loading:n,error:o,addProduct:d,updateProduct:c,deleteProduct:u,getProductsByCategory:h,refreshProducts:m};return i.jsx(Pr.Provider,{value:f,children:s})}function qe(){const s=p.useContext(Pr);if(s===void 0)throw new Error("useProducts must be used within a ProductProvider");return s}const Tr=({product:s,isAdmin:e,onUpdate:t,onDelete:n,onQuickView:r})=>{const[o,a]=p.useState(!1),[l,d]=p.useState(s),[c,u]=p.useState(!1),h=s.media?.[0]?.url||s.image||"https://via.placeholder.com/400",m=async()=>{if(t)try{await t(l),a(!1),v.success("Product updated successfully")}catch{v.error("Failed to update product")}},f=async()=>{if(!(!n||!window.confirm("Are you sure you want to delete this product?")))try{await n(s.id),v.success("Product deleted successfully")}catch{v.error("Failed to delete product")}};return o?i.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg",children:[i.jsxs("div",{className:"flex justify-between mb-4",children:[i.jsx("h3",{className:"font-medium",children:"Edit Product"}),i.jsxs("div",{className:"flex space-x-2",children:[i.jsx("button",{onClick:m,className:"p-2 rounded-full bg-accent-600 text-white hover:bg-accent-700 transition-colors",title:"Save changes",children:i.jsx(fi,{className:"h-4 w-4"})}),i.jsx("button",{onClick:()=>{d(s),a(!1)},className:"p-2 rounded-full bg-gray-200 hover:bg-gray-300 transition-colors",title:"Cancel editing",children:i.jsx(Vt,{className:"h-4 w-4"})})]})]}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),i.jsx("input",{type:"text",value:l.name,onChange:g=>d({...l,name:g.target.value}),className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-accent-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Price (₹)"}),i.jsx("input",{type:"number",value:l.price,onChange:g=>d({...l,price:parseFloat(g.target.value)||0}),className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-accent-500",step:"0.01",min:"0"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),i.jsx("textarea",{value:l.description,onChange:g=>d({...l,description:g.target.value}),rows:3,className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-accent-500"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),i.jsxs("select",{value:l.category,onChange:g=>d({...l,category:g.target.value}),className:"w-full px-3 py-2 border rounded-md focus:ring-2 focus:ring-accent-500",children:[i.jsx("option",{value:"Electronics",children:"Electronics"}),i.jsx("option",{value:"Men",children:"Men"}),i.jsx("option",{value:"Women",children:"Women"}),i.jsx("option",{value:"Watches",children:"Watches"}),i.jsx("option",{value:"Accessories",children:"Accessories"}),i.jsx("option",{value:"Footwear",children:"Footwear"})]})]})]})]}):i.jsxs("div",{className:"group relative bg-white rounded-xl overflow-hidden shadow-lg transition-all duration-300",onMouseEnter:()=>!e&&u(!0),onMouseLeave:()=>!e&&u(!1),children:[i.jsxs("div",{className:"relative overflow-hidden aspect-square",children:[i.jsx("img",{src:h,alt:s.name,className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"}),e&&i.jsxs("div",{className:"absolute top-4 right-4 z-20 flex space-x-2",children:[i.jsx("button",{onClick:()=>a(!0),className:"p-2 bg-accent-600 text-white rounded-full hover:bg-accent-700 transition-colors",children:i.jsx(Ps,{className:"h-4 w-4"})}),i.jsx("button",{onClick:f,className:"p-2 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors",children:i.jsx(Ts,{className:"h-4 w-4"})})]}),!e&&i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"absolute top-4 right-4 z-10",children:i.jsx("button",{className:`rounded-full p-2 transition-colors ${c?"bg-white text-accent-600":"bg-white/90 text-gray-600"}`,children:i.jsx(As,{className:"h-4 w-4"})})}),i.jsx("div",{className:`absolute inset-0 bg-black/40 backdrop-blur-[1px] flex items-center justify-center transition-opacity duration-300 ${c?"opacity-100":"opacity-0"}`,children:i.jsxs("div",{className:"space-y-3",children:[i.jsxs("button",{onClick:()=>r?.(s),className:"flex items-center justify-center space-x-2 bg-white text-black px-6 py-2 rounded-full hover:bg-gray-100 transition-colors",children:[i.jsx(Rs,{className:"h-4 w-4"}),i.jsx("span",{children:"Quick View"})]}),i.jsxs("button",{className:"flex items-center justify-center space-x-2 bg-accent-600 text-white px-6 py-2 rounded-full hover:bg-accent-700 transition-colors w-full",children:[i.jsx(Le,{className:"h-4 w-4"}),i.jsx("span",{children:"Add to Cart"})]})]})})]})]}),i.jsxs("div",{className:"p-6",children:[i.jsxs("div",{className:"flex justify-between items-start mb-2",children:[i.jsx("h3",{className:"font-semibold text-lg text-gray-900 group-hover:text-accent-600 transition-colors",children:s.name}),i.jsx("span",{className:"text-sm font-medium text-accent-600 bg-accent-50 px-2 py-1 rounded-full",children:s.category})]}),i.jsx("p",{className:"text-gray-600 text-sm mb-3",children:s.description}),i.jsx("p",{className:"text-xl font-bold text-gray-900",children:xn(s.price,"INR")})]})]})};function _n({show:s,message:e,onClose:t,duration:n=3e3}){return p.useEffect(()=>{if(s&&n){const r=setTimeout(t,n);return()=>clearTimeout(r)}},[s,n,t]),s?i.jsx("div",{className:"fixed bottom-4 right-4 z-50",children:i.jsxs("div",{className:"bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg flex items-center justify-between",children:[i.jsx("span",{children:e}),i.jsx("button",{onClick:t,className:"ml-4 text-white hover:text-gray-300 focus:outline-none",children:"×"})]})}):null}function Qd({sizes:s,selectedSize:e,onSelect:t}){return i.jsxs("div",{className:"mb-6",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Size"}),i.jsx("div",{className:"grid grid-cols-5 gap-2",children:s.map(n=>i.jsx("button",{onClick:()=>t(n),className:`py-2 text-sm font-medium rounded-md ${e===n?"bg-black text-white":"border border-gray-300 text-gray-700 hover:bg-gray-50"} transition-colors`,children:n},n))})]})}function Rr({product:s,onClose:e,onPrevious:t,onNext:n,showNavigation:r=!1,onAddToCart:o,onAddToWaitlist:a,isAdmin:l,onUpdate:d}){const[c,u]=p.useState(""),[h,m]=p.useState(""),[f,g]=p.useState(!1),[_,w]=p.useState(""),[b,N]=p.useState(!1),[A,H]=p.useState(!1),[J,yn]=p.useState(!1),[K,je]=p.useState(s),[Ue,_t]=p.useState(0);if(!s)return null;const ae=s.media?.length?s.media.map(k=>k.url):s.image?[s.image]:["https://via.placeholder.com/400"],Mr=k=>{k.target===k.currentTarget&&e()},Lr=()=>{if(!c){w("Please select a size"),g(!0);return}o(s,c),w("Added to cart successfully!"),g(!0)},Or=k=>{if(k.preventDefault(),!c){w("Please select a size"),g(!0);return}if(!h){w("Please enter your email"),g(!0);return}a(s,h,c),w("Added to waitlist successfully!"),g(!0),N(!1),m("")},ns=async k=>{const I=window.location.href,Ur=`Check out ${s.name} - ${s.description}`;switch(k){case"facebook":window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(I)}`,"_blank");break;case"twitter":window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(Ur)}&url=${encodeURIComponent(I)}`,"_blank");break;case"copy":try{await navigator.clipboard.writeText(I),w("Link copied to clipboard!"),g(!0)}catch{w("Failed to copy link"),g(!0)}break}H(!1)},Fr=()=>{K&&d&&(d(K),w("Product updated successfully"),g(!0),yn(!1))},Wr=()=>{_t(k=>(k+1)%ae.length)},qr=()=>{_t(k=>(k-1+ae.length)%ae.length)};return i.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto bg-black/75 backdrop-blur-sm",onClick:Mr,"aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",children:[i.jsx("div",{className:"flex min-h-screen items-center justify-center p-4",children:i.jsxs("div",{className:"relative w-full max-w-4xl rounded-2xl bg-white shadow-2xl",children:[i.jsxs("div",{className:"absolute right-4 top-4 z-10 flex space-x-2",children:[l&&!J&&i.jsx("button",{onClick:()=>yn(!0),className:"rounded-full bg-black text-white p-2 hover:bg-gray-800 transition-colors",children:i.jsx(Ps,{className:"h-5 w-5"})}),l&&J&&i.jsx("button",{onClick:Fr,className:"rounded-full bg-black text-white p-2 hover:bg-gray-800 transition-colors",children:i.jsx(fi,{className:"h-5 w-5"})}),i.jsxs("div",{className:"relative",children:[i.jsx("button",{onClick:()=>H(!A),className:"rounded-full bg-white/90 p-2 hover:bg-white transition-colors","aria-label":"Share",children:i.jsx(Uo,{className:"h-5 w-5"})}),A&&i.jsx("div",{className:"absolute right-0 mt-2 w-48 rounded-lg bg-white shadow-lg ring-1 ring-black ring-opacity-5",children:i.jsxs("div",{className:"py-1",children:[i.jsxs("button",{onClick:()=>ns("facebook"),className:"flex w-full items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[i.jsx(di,{className:"mr-3 h-4 w-4"}),"Share on Facebook"]}),i.jsxs("button",{onClick:()=>ns("twitter"),className:"flex w-full items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[i.jsx(hi,{className:"mr-3 h-4 w-4"}),"Share on Twitter"]}),i.jsxs("button",{onClick:()=>ns("copy"),className:"flex w-full items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100",children:[i.jsx(zo,{className:"mr-3 h-4 w-4"}),"Copy Link"]})]})})]}),i.jsx("button",{onClick:e,className:"rounded-full bg-white/90 p-2 hover:bg-white transition-colors",children:i.jsx(Vt,{className:"h-5 w-5"})})]}),r&&i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:t,className:"absolute left-4 top-1/2 -translate-y-1/2 rounded-full bg-white/90 p-3 hover:bg-white transition-colors shadow-lg",children:i.jsx(Et,{className:"h-6 w-6"})}),i.jsx("button",{onClick:n,className:"absolute right-4 top-1/2 -translate-y-1/2 rounded-full bg-white/90 p-3 hover:bg-white transition-colors shadow-lg",children:i.jsx(xe,{className:"h-6 w-6"})})]}),i.jsxs("div",{className:"flex flex-col lg:flex-row",children:[i.jsxs("div",{className:"lg:w-1/2",children:[i.jsx("div",{className:"relative aspect-square",children:J?i.jsxs("div",{className:"p-4",children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Image URL"}),i.jsx("input",{type:"text",value:K?.media?.[Ue]?.url||"",onChange:k=>{if(K){const I=[...K.media||[]];I[Ue]={url:k.target.value,type:"image"},je({...K,media:I})}},className:"w-full px-3 py-2 border rounded-md"})]}):i.jsxs("div",{className:"relative",children:[i.jsx("img",{src:ae[Ue],alt:s.name,className:"h-full w-full object-cover rounded-t-2xl lg:rounded-l-2xl lg:rounded-tr-none"}),ae.length>1&&i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:qr,className:"absolute left-4 top-1/2 -translate-y-1/2 bg-white/80 p-2 rounded-full hover:bg-white transition-colors",children:i.jsx(Et,{className:"h-5 w-5"})}),i.jsx("button",{onClick:Wr,className:"absolute right-4 top-1/2 -translate-y-1/2 bg-white/80 p-2 rounded-full hover:bg-white transition-colors",children:i.jsx(xe,{className:"h-5 w-5"})}),i.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2",children:ae.map((k,I)=>i.jsx("button",{onClick:()=>_t(I),className:`w-2 h-2 rounded-full transition-colors ${I===Ue?"bg-white":"bg-white/50"}`},I))})]})]})}),!J&&ae.length>1&&i.jsx("div",{className:"p-4 grid grid-cols-4 gap-2",children:ae.map((k,I)=>i.jsx("button",{onClick:()=>_t(I),className:`aspect-square rounded-lg overflow-hidden border-2 transition-colors ${I===Ue?"border-accent-600":"border-transparent hover:border-accent-300"}`,children:i.jsx("img",{src:k,alt:`${s.name} view ${I+1}`,className:"w-full h-full object-cover"})},I))})]}),i.jsx("div",{className:"p-8 lg:w-1/2",children:J?i.jsxs("div",{className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Name"}),i.jsx("input",{type:"text",value:K?.name||"",onChange:k=>je(I=>I?{...I,name:k.target.value}:null),className:"w-full px-3 py-2 border rounded-md"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Price"}),i.jsx("input",{type:"number",value:typeof K?.price=="string"?parseFloat(K.price.replace(/[^0-9.-]+/g,""))||"":K?.price||"",onChange:k=>je(I=>I?{...I,price:parseFloat(k.target.value)||0}:null),className:"w-full px-3 py-2 border rounded-md",step:"0.01",min:"0"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),i.jsx("textarea",{value:K?.description||"",onChange:k=>je(I=>I?{...I,description:k.target.value}:null),rows:3,className:"w-full px-3 py-2 border rounded-md"})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),i.jsxs("select",{value:K?.category||"",onChange:k=>je(I=>I?{...I,category:k.target.value}:null),className:"w-full px-3 py-2 border rounded-md",children:[i.jsx("option",{value:"Electronics",children:"Electronics"}),i.jsx("option",{value:"Men",children:"Men"}),i.jsx("option",{value:"Women",children:"Women"}),i.jsx("option",{value:"Watches",children:"Watches"})]})]}),i.jsxs("div",{children:[i.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Stock Status"}),i.jsxs("select",{value:K?.inStock?"true":"false",onChange:k=>je(I=>I?{...I,inStock:k.target.value==="true"}:null),className:"w-full px-3 py-2 border rounded-md",children:[i.jsx("option",{value:"true",children:"In Stock"}),i.jsx("option",{value:"false",children:"Out of Stock"})]})]})]}):i.jsxs(i.Fragment,{children:[i.jsxs("div",{className:"mb-8",children:[i.jsx("p",{className:"text-sm text-gray-500 mb-2 uppercase tracking-wider",children:s.category}),i.jsxs("div",{className:"flex flex-col mb-4",children:[i.jsx("h2",{className:"text-2xl font-bold mb-2",children:s.name}),i.jsx("p",{className:"text-xl font-semibold text-gray-900",children:xn(s.price)})]}),i.jsx("p",{className:"text-gray-600 mb-4",children:s.description}),i.jsx("div",{className:"bg-gray-50 p-4 rounded-lg mb-6",children:i.jsxs("p",{className:"text-sm text-gray-600",children:[i.jsx("span",{className:"font-medium",children:"Return Policy:"})," Only replacements are available for this item. No returns accepted."]})}),i.jsx(Qd,{sizes:s.sizes||["XS","S","M","L","XL"],selectedSize:c,onSelect:u})]}),b?i.jsxs("form",{onSubmit:Or,className:"space-y-4",children:[i.jsxs("div",{children:[i.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),i.jsx("input",{type:"email",id:"email",required:!0,value:h,onChange:k=>m(k.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-black focus:border-transparent",placeholder:"Enter your email"})]}),i.jsx("button",{type:"submit",className:"w-full bg-black text-white px-6 py-3 rounded-full hover:bg-gray-800 transition-colors",children:"Join Waitlist"}),i.jsx("button",{type:"button",onClick:()=>N(!1),className:"w-full border border-gray-300 px-6 py-3 rounded-full hover:bg-gray-50 transition-colors",children:"Cancel"})]}):i.jsxs("div",{className:"space-y-4",children:[i.jsx("div",{className:"grid grid-cols-2 gap-4",children:s.inStock!==!1?i.jsxs(i.Fragment,{children:[i.jsxs("button",{onClick:Lr,className:"flex items-center justify-center space-x-2 bg-black text-white px-6 py-3 rounded-full hover:bg-gray-800 transition-colors",children:[i.jsx(Le,{className:"h-5 w-5"}),i.jsx("span",{children:"Add to Cart"})]}),i.jsxs("button",{onClick:()=>N(!0),className:"flex items-center justify-center space-x-2 border border-black text-black px-6 py-3 rounded-full hover:bg-gray-100 transition-colors",children:[i.jsx(Ze,{className:"h-5 w-5"}),i.jsx("span",{children:"Notify Me"})]})]}):i.jsxs("button",{onClick:()=>N(!0),className:"col-span-2 flex items-center justify-center space-x-2 bg-gray-800 text-white px-6 py-3 rounded-full hover:bg-gray-700 transition-colors",children:[i.jsx(Ze,{className:"h-5 w-5"}),i.jsx("span",{children:"Join Waitlist"})]})}),i.jsxs("button",{className:"w-full flex items-center justify-center space-x-2 border border-gray-300 px-6 py-3 rounded-full hover:bg-gray-50 transition-colors",children:[i.jsx(As,{className:"h-5 w-5"}),i.jsx("span",{children:"Add to Wishlist"})]})]})]})})]})]})}),i.jsx(_n,{show:f,message:_,onClose:()=>g(!1)})]})}const Xd=p.memo(function(){const{products:e,loading:t,error:n}=qe(),[r,o]=p.useState(null),[a,l]=p.useState(0),d=[...e,{id:"new-watch-1",name:"Limited Edition Watch",price:899.99,image:"https://images.unsplash.com/photo-1524592094714-0f0654e20314?auto=format&fit=crop&w=800&q=80",category:"Watches",description:"Exclusive limited edition timepiece",inStock:!0},{id:"new-sunglasses-1",name:"Designer Sunglasses",price:299.99,image:"https://images.unsplash.com/photo-1511499767150-a48a237f0083?auto=format&fit=crop&w=800&q=80",category:"Accessories",description:"Premium designer sunglasses",inStock:!0},{id:"new-bag-1",name:"Leather Crossbody Bag",price:459.99,image:"https://images.unsplash.com/photo-1584917865442-de89df76afd3?auto=format&fit=crop&w=800&q=80",category:"Accessories",description:"Handcrafted leather crossbody bag",inStock:!0},{id:"new-sneakers-1",name:"Premium Sneakers",price:189.99,image:"https://images.unsplash.com/photo-1552346154-21d32810aba3?auto=format&fit=crop&w=800&q=80",category:"Footwear",description:"Premium comfort sneakers",inStock:!0}].slice(0,12);if(t)return i.jsx("div",{className:"flex justify-center items-center h-64",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-accent-600"})});if(n)return i.jsx("div",{className:"text-center py-12 text-red-500",children:n});const c=(h,m)=>{o(h),l(m)},u=h=>typeof h=="string"&&h.startsWith("new-");return i.jsxs("section",{className:"py-16",children:[i.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[i.jsxs("div",{className:"text-center mb-12",children:[i.jsxs("div",{className:"flex items-center justify-center gap-2 mb-4",children:[i.jsx(ui,{className:"w-6 h-6 text-accent-600"}),i.jsx("h2",{className:"text-3xl font-bold",children:"Trending Products"})]}),i.jsx("p",{className:"text-gray-600 max-w-2xl mx-auto",children:"Discover our most popular items, handpicked for their exceptional style and quality"})]}),i.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8",children:d.map((h,m)=>i.jsxs("div",{className:"transform transition-all duration-300 hover:scale-105 relative",children:[i.jsx(Tr,{product:h,onQuickView:()=>c(h,m)}),u(h.id)&&i.jsx("div",{className:"absolute top-4 left-4 bg-accent-600 text-white px-3 py-1 rounded-full text-sm font-semibold shadow-lg z-10",children:"New"})]},h.id))})]}),r&&i.jsx(Rr,{product:r,onClose:()=>o(null),onAddToCart:()=>{},onAddToWaitlist:()=>{}})]})}),Jd=[{icon:Ht,title:"Secure Payments",description:"Shop with confidence knowing that your transactions are safeguarded."},{icon:Ho,title:"Free Shipping",description:"Shopping with no extra charges – savor the liberty of complimentary shipping on every order."},{icon:Vo,title:"Easy Returns",description:"With our hassle-free Easy Returns, changing your mind has never been more convenient."},{icon:Be,title:"Order Tracking",description:"Stay in the loop with our Order Tracking feature – from checkout to your doorstep."}];function Zd(){return i.jsx("section",{className:"py-16 bg-gray-50",children:i.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:Jd.map(s=>i.jsxs("div",{className:"flex flex-col items-center text-center p-6 bg-white rounded-xl shadow-sm hover:shadow-md transition-shadow",children:[i.jsx("div",{className:"w-16 h-16 flex items-center justify-center bg-black text-white rounded-full mb-4",children:i.jsx(s.icon,{className:"h-8 w-8"})}),i.jsx("h3",{className:"text-lg font-semibold mb-2",children:s.title}),i.jsx("p",{className:"text-gray-600 text-sm",children:s.description})]},s.title))})})})}const Nt=[{id:1,title:"Men's Collection",subtitle:"Spring/Summer 2024",description:"Discover our latest collection of premium menswear",image:"https://images.unsplash.com/photo-1617127365659-c47fa864d8bc?auto=format&fit=crop&w=3440&q=80"},{id:2,title:"Women's Fashion",subtitle:"New Arrivals",description:"Elegant styles for the modern woman",image:"https://images.unsplash.com/photo-1490481651871-ab68de25d43d?auto=format&fit=crop&w=3440&q=80"},{id:3,title:"Luxury Watches",subtitle:"Timeless Elegance",description:"Premium timepieces for every occasion",image:"https://images.unsplash.com/photo-1523170335258-f5ed11844a49?auto=format&fit=crop&w=3440&q=80"}];function eh(){const[s,e]=p.useState(0),[t,n]=p.useState(!1);p.useEffect(()=>{const a=setInterval(()=>{r()},5e3);return()=>clearInterval(a)},[s]);const r=()=>{t||(n(!0),e(a=>(a+1)%Nt.length),setTimeout(()=>n(!1),500))},o=()=>{t||(n(!0),e(a=>a===0?Nt.length-1:a-1),setTimeout(()=>n(!1),500))};return i.jsxs("div",{className:"relative h-[800px] overflow-hidden",children:[Nt.map((a,l)=>i.jsxs("div",{className:`absolute inset-0 transition-opacity duration-1000 ${l===s?"opacity-100":"opacity-0"}`,children:[i.jsx("div",{className:"absolute inset-0 bg-cover bg-center transform scale-105 transition-transform duration-[2000ms]",style:{backgroundImage:`url(${a.image})`,transform:l===s?"scale(1)":"scale(1.05)"}}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/60 via-black/40 to-black/60",children:i.jsx("div",{className:"flex items-center justify-center h-full",children:i.jsxs("div",{className:"text-center text-white px-4 max-w-4xl mx-auto",children:[i.jsx("p",{className:"text-sm uppercase tracking-wider mb-2 opacity-0 animate-[slideDown_1s_ease-out_0.5s_forwards]",children:a.subtitle}),i.jsx("h2",{className:"text-6xl sm:text-7xl font-bold mb-4 opacity-0 animate-[slideDown_1s_ease-out_0.7s_forwards]",children:a.title}),i.jsx("p",{className:"text-xl mb-8 opacity-0 animate-[slideDown_1s_ease-out_0.9s_forwards]",children:a.description})]})})})]},a.id)),i.jsx("button",{onClick:o,className:"absolute left-4 top-1/2 -translate-y-1/2 bg-white/80 p-2 rounded-full hover:bg-white transition-colors z-10",children:i.jsx(Et,{className:"h-6 w-6"})}),i.jsx("button",{onClick:r,className:"absolute right-4 top-1/2 -translate-y-1/2 bg-white/80 p-2 rounded-full hover:bg-white transition-colors z-10",children:i.jsx(xe,{className:"h-6 w-6"})}),i.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2 z-10",children:Nt.map((a,l)=>i.jsx("button",{onClick:()=>e(l),className:`w-2 h-2 rounded-full transition-colors ${l===s?"bg-white":"bg-white/50"}`},l))})]})}const Ct=[{id:1,name:"Premium Wireless Headphones",price:"$299",image:"https://images.unsplash.com/photo-1505740420928-5e560c06d30e?auto=format&fit=crop&w=3440&q=80",category:"Electronics",path:"/electronics"},{id:2,name:"Designer Summer Collection",price:"$129",image:"https://images.unsplash.com/photo-1515372039744-b8f02a3ae446?auto=format&fit=crop&w=3440&q=80",category:"Women",path:"/women"},{id:3,name:"Smart Watch Collection",price:"$399",image:"https://images.unsplash.com/photo-1546868871-7041f2a55e12?auto=format&fit=crop&w=3440&q=80",category:"Watches",path:"/watches"},{id:4,name:"Kids Fashion Collection",price:"$79",image:"https://images.unsplash.com/photo-1514090458221-65bb69cf63e6?auto=format&fit=crop&w=3440&q=80",category:"Kids",path:"/kids"}];function th(){const[s,e]=p.useState(0),[t,n]=p.useState(!1);p.useEffect(()=>{const a=setInterval(()=>{r()},5e3);return()=>clearInterval(a)},[s]);const r=()=>{t||(n(!0),e(a=>(a+1)%Ct.length),setTimeout(()=>n(!1),500))},o=()=>{t||(n(!0),e(a=>a===0?Ct.length-1:a-1),setTimeout(()=>n(!1),500))};return i.jsxs("section",{className:"py-24 bg-gradient-to-b from-gray-900 to-black relative overflow-hidden",children:[i.jsx("div",{className:"absolute inset-0 opacity-5",children:i.jsx("div",{className:"absolute inset-0",style:{backgroundImage:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`,backgroundSize:"30px 30px"}})}),i.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:i.jsxs("div",{className:"relative",children:[i.jsx("div",{className:"overflow-hidden",children:i.jsx("div",{className:"flex transition-transform duration-500 ease-out",style:{transform:`translateX(-${s*100}%)`},children:Ct.map(a=>i.jsx("div",{className:"w-full flex-shrink-0 px-4",children:i.jsx(L,{to:a.path,className:"block relative group",children:i.jsxs("div",{className:"relative aspect-[21/9] overflow-hidden rounded-2xl",children:[i.jsx("img",{src:a.image,alt:a.name,className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-110"}),i.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-black/40 to-transparent",children:i.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-8",children:i.jsxs("div",{className:"max-w-xl",children:[i.jsx("p",{className:"text-accent-400 text-sm font-medium mb-2",children:a.category}),i.jsx("h3",{className:"text-3xl font-bold text-white mb-4",children:a.name}),i.jsxs("p",{className:"text-xl text-white/80 mb-6",children:["Starting from ",a.price]}),i.jsxs("div",{className:"inline-flex items-center text-white font-medium group-hover:text-accent-400 transition-colors",children:[i.jsx("span",{children:"Explore Collection"}),i.jsx(mi,{className:"w-5 h-5 ml-2 transform group-hover:translate-x-2 transition-transform"})]})]})})})]})})},a.id))})}),i.jsx("button",{onClick:o,className:"absolute left-8 top-1/2 -translate-y-1/2 bg-white/10 backdrop-blur-sm text-white p-3 rounded-full hover:bg-white/20 transition-colors",children:i.jsx(Et,{className:"w-6 h-6"})}),i.jsx("button",{onClick:r,className:"absolute right-8 top-1/2 -translate-y-1/2 bg-white/10 backdrop-blur-sm text-white p-3 rounded-full hover:bg-white/20 transition-colors",children:i.jsx(xe,{className:"w-6 h-6"})}),i.jsx("div",{className:"absolute -bottom-12 left-1/2 -translate-x-1/2 flex space-x-2",children:Ct.map((a,l)=>i.jsx("button",{onClick:()=>e(l),className:`w-2 h-2 rounded-full transition-colors ${l===s?"bg-white":"bg-white/50"}`},l))})]})})]})}function sh(){return p.useEffect(()=>{["https://images.unsplash.com/photo-1445205170230-053b83016050","https://images.unsplash.com/photo-1581338834647-b0fb40704e21","https://images.unsplash.com/photo-1604014237800-1c9102c219da"].forEach(e=>{const t=new Image;t.src=`${e}?auto=format&fit=crop&q=80&w=3440`})},[]),i.jsxs("div",{className:"relative",children:[i.jsx(eh,{}),i.jsx(G,{backgroundImage:"https://images.unsplash.com/photo-1445205170230-053b83016050?auto=format&fit=crop&q=80&w=3440",className:"py-16",speed:.3,blur:!0,children:i.jsx("div",{className:"relative",children:i.jsx(Vd,{})})}),i.jsx(G,{backgroundImage:"https://images.unsplash.com/photo-1581338834647-b0fb40704e21?auto=format&fit=crop&q=80&w=3440",className:"py-16",speed:.4,blur:!0,children:i.jsx("div",{className:"relative",children:i.jsx(Xd,{})})}),i.jsx(th,{}),i.jsx(G,{backgroundImage:"https://images.unsplash.com/photo-1604014237800-1c9102c219da?auto=format&fit=crop&q=80&w=3440",className:"py-16",speed:.3,blur:!0,children:i.jsx("div",{className:"relative",children:i.jsx(Zd,{})})})]})}function ts({title:s,description:e,products:t,isAdmin:n,onUpdateProduct:r,onDeleteProduct:o}){const[a,l]=p.useState(null),d=c=>{l(c)};return i.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[i.jsxs("div",{className:"text-center mb-12",children:[i.jsx("h1",{className:"text-4xl font-bold text-white mb-4",children:s}),i.jsx("p",{className:"text-xl text-white/80",children:e})]}),i.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8",children:t.map(c=>i.jsx(Tr,{product:c,isAdmin:n,onUpdate:r,onDelete:o,onQuickView:d},c.id))}),t.length===0&&i.jsx("div",{className:"text-center py-12",children:i.jsx("p",{className:"text-white/70",children:"No products found in this category."})}),a&&i.jsx(Rr,{product:a,onClose:()=>l(null),onAddToCart:()=>{},onAddToWaitlist:()=>{}})]})}function nh(){const{products:s}=qe(),e=s.filter(t=>t.category==="Electronics");return i.jsx(G,{backgroundImage:"https://images.unsplash.com/photo-1505740420928-5e560c06d30e?auto=format&fit=crop&w=3440&q=80",className:"min-h-screen pt-16",speed:.3,children:i.jsx(ts,{title:"Electronics",description:"Latest Tech & Gadgets",products:e})})}function ih(){const{products:s}=qe(),e=s.filter(t=>t.category==="Men");return i.jsx(G,{backgroundImage:"https://images.unsplash.com/photo-1617127365659-c47fa864d8bc?auto=format&fit=crop&w=3440&q=80",className:"min-h-screen pt-16",speed:.3,children:i.jsx(ts,{title:"Men's Collection",description:"Premium Fashion for Men",products:e})})}function rh(){const{products:s}=qe(),e=s.filter(t=>t.category==="Women");return i.jsx(G,{backgroundImage:"https://images.unsplash.com/photo-1490481651871-ab68de25d43d?auto=format&fit=crop&w=3440&q=80",className:"min-h-screen pt-16",speed:.3,children:i.jsx(ts,{title:"Women's Collection",description:"Elegant Styles for Women",products:e})})}function oh(){const{products:s}=qe(),e=s.filter(t=>t.category==="Watches");return i.jsx(G,{backgroundImage:"https://images.unsplash.com/photo-1523170335258-f5ed11844a49?auto=format&fit=crop&w=3440&q=80",className:"min-h-screen pt-16",speed:.3,children:i.jsx(ts,{title:"Luxury Timepieces",description:"Discover Our Collection of Premium Watches",products:e})})}const Ar=p.createContext(void 0);function ah({children:s}){const[e,t]=p.useState(()=>{const d=localStorage.getItem("cart");return d?JSON.parse(d):[]});p.useEffect(()=>{localStorage.setItem("cart",JSON.stringify(e))},[e]);const n=(d,c=1)=>{t(u=>u.find(m=>m.id===d.id)?u.map(m=>m.id===d.id?{...m,quantity:m.quantity+c}:m):[...u,{...d,quantity:c}])},r=d=>{t(c=>c.filter(u=>u.id!==d))},o=(d,c)=>{t(u=>u.map(h=>h.id===d?{...h,quantity:c}:h))},a=()=>{t([])},l=e.reduce((d,c)=>d+c.price*c.quantity,0);return i.jsx(Ar.Provider,{value:{items:e,addItem:n,removeItem:r,updateQuantity:o,clearCart:a,total:l},children:s})}function lh(){const s=p.useContext(Ar);if(s===void 0)throw new Error("useCart must be used within a CartProvider");return s}function ch(){const{id:s}=Vr(),[e,t]=p.useState(null),[n,r]=p.useState(!0),[o,a]=p.useState(null),{addItem:l}=lh();p.useEffect(()=>{(async()=>{try{if(!s)throw new Error("Product ID is required");const u=await Ed(s);t(u)}catch(u){a("Failed to load product"),console.error(u)}finally{r(!1)}})()},[s]);const d=()=>{e&&(l(e),v.success("Added to cart!"))};return n?i.jsx("div",{className:"flex justify-center pt-20",children:"Loading..."}):o?i.jsx("div",{className:"text-red-500 pt-20",children:o}):e?i.jsx("div",{className:"pt-20",children:i.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:i.jsxs("div",{className:"grid md:grid-cols-2 gap-12",children:[i.jsx("div",{className:"aspect-square overflow-hidden rounded-lg bg-gray-100",children:i.jsx("img",{src:e.image,alt:e.name,className:"w-full h-full object-contain p-8"})}),i.jsxs("div",{className:"space-y-8",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-3xl font-bold mb-4",children:e.name}),i.jsx("p",{className:"text-2xl font-semibold",children:xn(e.price)})]}),i.jsx("div",{className:"prose max-w-none",children:i.jsx("p",{className:"text-gray-600",children:e.description})}),i.jsxs("div",{className:"space-y-4",children:[i.jsxs("button",{onClick:d,className:"w-full flex items-center justify-center space-x-2 bg-accent-600 text-white px-8 py-4 rounded-full hover:bg-accent-700 transition-colors",children:[i.jsx(Le,{className:"h-5 w-5"}),i.jsx("span",{children:"Add to Cart"})]}),i.jsxs("button",{className:"w-full flex items-center justify-center space-x-2 border border-accent-600 text-accent-600 px-8 py-4 rounded-full hover:bg-accent-50 transition-colors",children:[i.jsx(As,{className:"h-5 w-5"}),i.jsx("span",{children:"Add to Wishlist"})]})]})]})]})})}):i.jsx("div",{className:"pt-20",children:"Product not found"})}function dh(){const[s,e]=p.useState([]),t=(o,a)=>{e(l=>l.map(d=>d.id===o?{...d,quantity:Math.max(0,a)}:d))},n=o=>{e(a=>a.filter(l=>l.id!==o))},r=s.reduce((o,a)=>o+a.price*a.quantity,0);return s.length===0?i.jsxs("div",{className:"text-center py-12",children:[i.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Your Cart is Empty"}),i.jsx("p",{className:"text-gray-600",children:"Add some products to your cart to see them here."})]}):i.jsxs("div",{className:"max-w-4xl mx-auto",children:[i.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Shopping Cart"}),i.jsxs("div",{className:"bg-white rounded-lg shadow-md overflow-hidden",children:[i.jsx("div",{className:"p-6 space-y-4",children:s.map(o=>i.jsxs("div",{className:"flex items-center border-b pb-4",children:[i.jsx("img",{src:o.image,alt:o.name,className:"w-24 h-24 object-cover rounded"}),i.jsxs("div",{className:"ml-4 flex-grow",children:[i.jsx("h3",{className:"text-lg font-semibold",children:o.name}),i.jsxs("p",{className:"text-gray-600",children:["$",o.price]}),i.jsxs("div",{className:"flex items-center mt-2",children:[i.jsx("button",{onClick:()=>t(o.id,o.quantity-1),className:"px-2 py-1 border rounded",children:"-"}),i.jsx("span",{className:"mx-4",children:o.quantity}),i.jsx("button",{onClick:()=>t(o.id,o.quantity+1),className:"px-2 py-1 border rounded",children:"+"})]})]}),i.jsx("button",{onClick:()=>n(o.id),className:"text-red-500 hover:text-red-700",children:"Remove"})]},o.id))}),i.jsxs("div",{className:"bg-gray-50 p-6",children:[i.jsxs("div",{className:"flex justify-between items-center mb-4",children:[i.jsx("span",{className:"text-lg font-semibold",children:"Total:"}),i.jsxs("span",{className:"text-2xl font-bold",children:["$",r.toFixed(2)]})]}),i.jsx("button",{className:"w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700",children:"Proceed to Checkout"})]})]})]})}function hh(){const{currentUser:s,userProfile:e,logout:t}=oe(),[n,r]=p.useState(!1),o=be(),a=async()=>{r(!0);try{await t(),o("/login")}catch(l){console.error("Failed to log out:",l)}finally{r(!1)}};return s?i.jsx("div",{className:"min-h-screen bg-gray-50 pt-16",children:i.jsx("div",{className:"max-w-2xl mx-auto p-6",children:i.jsxs("div",{className:"bg-white rounded-lg shadow-md p-8",children:[i.jsx("div",{className:"flex items-center justify-center mb-8",children:s.photoURL?i.jsx("img",{src:s.photoURL,alt:"Profile",className:"w-24 h-24 rounded-full"}):i.jsx("div",{className:"w-24 h-24 rounded-full bg-accent-100 flex items-center justify-center",children:i.jsx(dt,{className:"w-12 h-12 text-accent-600"})})}),i.jsxs("div",{className:"space-y-6",children:[e?.name&&i.jsxs("div",{children:[i.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Full Name"}),i.jsx("p",{className:"mt-1 text-lg font-medium text-gray-900",children:e.name})]}),i.jsxs("div",{children:[i.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Email Address"}),i.jsx("p",{className:"mt-1 text-lg font-medium text-gray-900",children:s.email})]}),e?.createdAt&&i.jsxs("div",{children:[i.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Member Since"}),i.jsx("p",{className:"mt-1 text-lg font-medium text-gray-900",children:new Date(e.createdAt).toLocaleDateString()})]}),i.jsx("div",{className:"pt-6",children:i.jsx("button",{onClick:a,disabled:n,className:"w-full bg-accent-600 text-white py-3 px-4 rounded-lg hover:bg-accent-700 transition-colors disabled:opacity-50",children:n?"Logging out...":"Log Out"})})]})]})})}):null}const uh={email:"admin@luxe.com",password:"admin123"},Dr=p.createContext(void 0);function mh({children:s}){const[e,t]=p.useState(!1),[n,r]=p.useState(uh);p.useEffect(()=>{localStorage.getItem("adminToken")&&t(!0)},[]);const o=async(d,c)=>{try{return d===n.email&&c===n.password?(t(!0),localStorage.setItem("adminToken",btoa(`${d}:${Date.now()}`)),v.success("Successfully logged in as admin"),!0):(v.error("Invalid credentials"),!1)}catch(u){return console.error("Login failed:",u),v.error("Login failed"),!1}},a=()=>{t(!1),localStorage.removeItem("adminToken"),v.success("Logged out successfully")},l=async(d,c,u)=>{try{return c!==n.password?(v.error("Current password is incorrect"),!1):(r({email:d||n.email,password:u||n.password}),v.success("Admin credentials updated successfully"),!0)}catch(h){return console.error("Failed to update admin credentials:",h),v.error("Failed to update credentials"),!1}};return i.jsx(Dr.Provider,{value:{isAdmin:e,login:o,logout:a,updateAdminCredentials:l},children:s})}function ss(){const s=p.useContext(Dr);if(s===void 0)throw new Error("useAdmin must be used within an AdminProvider");return s}function fh(){const{products:s,deleteProduct:e,updateProduct:t,refreshProducts:n,loading:r}=qe();ss(),be();const[o,a]=p.useState(""),[l,d]=p.useState("All");p.useState(!1),p.useState(!1),s.filter(c=>{const u=c.name.toLowerCase().includes(o.toLowerCase())||c.description.toLowerCase().includes(o.toLowerCase()),h=l==="All"||c.category===l;return u&&h}),p.useCallback(async c=>{try{await t(c),v.success("Product updated successfully")}catch(u){throw v.error("Failed to update product"),u}},[t])}function ph(){const[s,e]=p.useState(""),[t,n]=p.useState(""),[r,o]=p.useState(""),[a,l]=p.useState(!1),{login:d}=ss(),c=be(),u=async h=>{h.preventDefault(),o("");try{await d(s,t)?(l(!0),setTimeout(()=>{c("/admin/dashboard")},1500)):o("Invalid credentials")}catch{o("An error occurred during login")}};return i.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:[i.jsxs("div",{className:"max-w-md w-full space-y-8",children:[i.jsxs("div",{children:[i.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Admin Login"}),i.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Access the admin dashboard"})]}),i.jsxs("form",{className:"mt-8 space-y-6",onSubmit:u,children:[r&&i.jsx("div",{className:"text-red-600 text-center text-sm bg-red-50 p-2 rounded",children:r}),i.jsxs("div",{className:"rounded-md shadow-sm -space-y-px",children:[i.jsxs("div",{children:[i.jsx("label",{htmlFor:"email-address",className:"sr-only",children:"Email address"}),i.jsx("input",{id:"email-address",name:"email",type:"email",autoComplete:"email",required:!0,value:s,onChange:h=>e(h.target.value),className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-t-md focus:outline-none focus:ring-black focus:border-black focus:z-10 sm:text-sm",placeholder:"Email address"})]}),i.jsxs("div",{children:[i.jsx("label",{htmlFor:"password",className:"sr-only",children:"Password"}),i.jsx("input",{id:"password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:t,onChange:h=>n(h.target.value),className:"appearance-none rounded-none relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-b-md focus:outline-none focus:ring-black focus:border-black focus:z-10 sm:text-sm",placeholder:"Password"})]})]}),i.jsx("div",{children:i.jsx("button",{type:"submit",className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-black hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-black",children:"Sign in"})})]})]}),i.jsx(_n,{show:a,message:"Login successful! Redirecting...",onClose:()=>l(!1)})]})}function gh(){const{updateAdminCredentials:s,logout:e}=ss(),t=be(),[n,r]=p.useState(""),[o,a]=p.useState(""),[l,d]=p.useState(""),[c,u]=p.useState(""),[h,m]=p.useState(!1),[f,g]=p.useState(""),_=async w=>{if(w.preventDefault(),u(""),!o){u("Current password is required");return}try{await s(n||"",o,l||"")?(g("Credentials updated successfully. Please login again."),m(!0),r(""),a(""),d(""),setTimeout(()=>{e(),t("/admin/login")},2e3)):u("Current password is incorrect")}catch{u("An error occurred while updating credentials")}};return i.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:i.jsxs("div",{className:"max-w-md mx-auto bg-white rounded-lg shadow p-8",children:[i.jsxs("div",{className:"text-center mb-8",children:[i.jsx("h2",{className:"text-2xl font-bold",children:"Update Admin Credentials"}),i.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Change your login details"})]}),c&&i.jsx("div",{className:"mb-4 p-3 bg-red-50 text-red-600 rounded-md text-sm",children:c}),i.jsx("form",{onSubmit:_,className:"space-y-6"}),i.jsx(_n,{show:h,message:f,onClose:()=>m(!1)})]})})}function ri({children:s}){const{isAdmin:e}=ss();return e?i.jsx(i.Fragment,{children:s}):i.jsx(hs,{to:"/admin/login"})}function xh(){p.useEffect(()=>{const e=new IntersectionObserver(t=>{t.forEach(n=>{n.isIntersecting&&n.target.classList.add("animate-fade-in")})},{threshold:.1});return document.querySelectorAll(".animate-on-scroll").forEach(t=>{e.observe(t)}),()=>e.disconnect()},[]);const s=[{icon:Bo,title:"Quality Assurance",description:"Every product meets our rigorous standards for excellence."},{icon:$o,title:"Premium Selection",description:"Curated collections featuring the finest materials and craftsmanship."},{icon:Ko,title:"Customer First",description:"Dedicated to providing exceptional service and experience."},{icon:Qo,title:"Timeless Style",description:"Creating enduring fashion that transcends trends."}];return i.jsxs("div",{className:"min-h-screen",children:[i.jsx(G,{backgroundImage:"https://images.unsplash.com/photo-1560448204-603b3fc33ddc?auto=format&fit=crop&q=80&w=3440",className:"h-[70vh] flex items-center",speed:.5,children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-white",children:[i.jsx("h1",{className:"text-5xl md:text-7xl font-bold mb-6 animate-fade-in",children:"Our Story"}),i.jsx("p",{className:"text-xl md:text-2xl text-white/80 max-w-3xl mx-auto animate-fade-in delay-300",children:"Crafting luxury experiences since 1970"})]})}),i.jsx(G,{backgroundImage:"https://images.unsplash.com/photo-1441986300917-64674bd600d8?auto=format&fit=crop&q=80&w=3440",className:"py-24",speed:.3,children:i.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:i.jsx("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-12 text-white",children:i.jsxs("div",{className:"max-w-3xl mx-auto text-center animate-on-scroll opacity-0",children:[i.jsx(Yo,{className:"w-12 h-12 mx-auto mb-6 text-accent-500"}),i.jsx("h2",{className:"text-4xl font-bold mb-6",children:"Our Mission"}),i.jsx("p",{className:"text-lg text-white/80 leading-relaxed",children:"At LUXE, we're dedicated to redefining luxury fashion through innovation and sustainability. Our mission is to provide discerning customers with exceptional quality products while maintaining our commitment to ethical practices and environmental responsibility."})]})})})}),i.jsx(G,{backgroundImage:"https://images.unsplash.com/photo-1537832816519-689ad163238b?auto=format&fit=crop&q=80&w=3440",className:"py-24",speed:.4,children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[i.jsxs("div",{className:"text-center mb-16 animate-on-scroll opacity-0",children:[i.jsx(Go,{className:"w-12 h-12 mx-auto mb-6 text-accent-500"}),i.jsx("h2",{className:"text-4xl font-bold text-white mb-6",children:"Our Values"}),i.jsx("p",{className:"text-lg text-white/80 max-w-2xl mx-auto",children:"Built on a foundation of excellence, our values guide every decision we make"})]}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:s.map((e,t)=>i.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-xl p-8 text-white animate-on-scroll opacity-0",style:{animationDelay:`${t*200}ms`},children:[i.jsx(e.icon,{className:"w-10 h-10 mb-4 text-accent-500"}),i.jsx("h3",{className:"text-xl font-semibold mb-4",children:e.title}),i.jsx("p",{className:"text-white/80",children:e.description})]},e.title))})]})}),i.jsx(G,{backgroundImage:"https://images.unsplash.com/photo-1441984904996-e0b6ba687e04?auto=format&fit=crop&q=80&w=3440",className:"py-24",speed:.2,children:i.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:i.jsx("div",{className:"bg-white/10 backdrop-blur-md rounded-2xl p-12",children:i.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 text-white",children:[i.jsxs("div",{className:"text-center animate-on-scroll opacity-0",children:[i.jsx("div",{className:"text-5xl font-bold mb-2",children:"50+"}),i.jsx("div",{className:"text-white/80",children:"Global Locations"})]}),i.jsxs("div",{className:"text-center animate-on-scroll opacity-0",style:{animationDelay:"200ms"},children:[i.jsx("div",{className:"text-5xl font-bold mb-2",children:"1M+"}),i.jsx("div",{className:"text-white/80",children:"Happy Customers"})]}),i.jsxs("div",{className:"text-center animate-on-scroll opacity-0",style:{animationDelay:"400ms"},children:[i.jsx("div",{className:"text-5xl font-bold mb-2",children:"100K+"}),i.jsx("div",{className:"text-white/80",children:"Products Sold"})]})]})})})})]})}const _h=[{id:"returns",question:"What is your return policy?",answer:"We do not accept returns for any products. However, exchanges are available for items that are defective or incorrect. Please contact our customer service team for assistance with exchanges.",icon:Be},{id:"tracking",question:"How can I track my order?",answer:"Once your order has shipped, you will receive a tracking number via email, which you can use to track the delivery status.",icon:Be},{id:"contact",question:"How can I contact customer service?",answer:"You can reach our customer service team at support@yourstore.com or through the contact form on our website. We aim to respond within 24-48 hours.",icon:pi},{id:"payment",question:"What payment methods do you accept?",answer:"We accept payments through various methods including Visa, MasterCard, American Express, PayPal, and Apple Pay.",icon:St},{id:"shipping",question:"Do you ship internationally?",answer:"Yes, we offer international shipping to select countries. Rates and delivery times vary by destination.",icon:gi},{id:"modification",question:"Can I modify or cancel my order after placing it?",answer:"Orders are processed quickly. Please contact us immediately if you need to make changes or cancel your order, and we will try to accommodate your request before shipping.",icon:Be},{id:"giftcards",question:"Do you offer gift cards?",answer:"Yes, we offer digital gift cards that can be used for purchases on our site.",icon:Jo},{id:"damaged",question:"What should I do if I received a damaged or incorrect item?",answer:"If you receive a damaged or incorrect item, please contact our customer service team right away at support@yourstore.com. We will assist you with exchanging the product.",icon:Be},{id:"account",question:"How do I create an account?",answer:'Click on the "Sign Up" button on our website, fill in your details, and you will be able to track your orders, save favorite items, and more.',icon:Zo}];function yh(){const[s,e]=p.useState(null),t=n=>{e(s===n?null:n)};return i.jsxs("div",{className:"min-h-screen",children:[i.jsx(G,{backgroundImage:"https://images.unsplash.com/photo-1604014237800-1c9102c219da?auto=format&fit=crop&q=80&w=3440",className:"h-[40vh] flex items-center",speed:.5,children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-white",children:[i.jsx("h1",{className:"text-5xl md:text-6xl font-bold mb-6",children:"Frequently Asked Questions"}),i.jsx("p",{className:"text-xl text-white/80 max-w-2xl mx-auto",children:"Find answers to common questions about our services and policies"})]})}),i.jsx(G,{backgroundImage:"https://images.unsplash.com/photo-1441986300917-64674bd600d8?auto=format&fit=crop&q=80&w=3440",className:"py-24",speed:.3,children:i.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[i.jsx("div",{className:"space-y-6",children:_h.map(n=>i.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-xl overflow-hidden transition-all duration-300",children:[i.jsxs("button",{onClick:()=>t(n.id),className:"w-full px-6 py-4 flex items-center justify-between text-white hover:bg-white/5 transition-colors",children:[i.jsxs("div",{className:"flex items-center space-x-4",children:[i.jsx(n.icon,{className:"w-5 h-5 text-accent-500"}),i.jsx("span",{className:"text-lg font-medium text-left",children:n.question})]}),i.jsx(Xo,{className:`w-5 h-5 transition-transform duration-300 ${s===n.id?"rotate-180":""}`})]}),i.jsx("div",{className:`px-6 overflow-hidden transition-all duration-300 ${s===n.id?"max-h-48 py-4":"max-h-0"}`,children:i.jsx("p",{className:"text-white/80",children:n.answer})})]},n.id))}),i.jsxs("div",{className:"mt-16 text-center text-white",children:[i.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Still have questions?"}),i.jsx("p",{className:"text-white/80 mb-8",children:"Our customer service team is here to help you with any other questions you may have."}),i.jsxs("a",{href:"mailto:support@yourstore.com",className:"inline-flex items-center space-x-2 bg-accent-600 text-white px-6 py-3 rounded-full hover:bg-accent-700 transition-colors",children:[i.jsx(pi,{className:"w-5 h-5"}),i.jsx("span",{children:"Contact Support"})]})]})]})})]})}function vh(){p.useEffect(()=>{const e=new IntersectionObserver(t=>{t.forEach(n=>{n.isIntersecting&&n.target.classList.add("animate-fade-in")})},{threshold:.1});return document.querySelectorAll(".animate-on-scroll").forEach(t=>{e.observe(t)}),()=>e.disconnect()},[]);const s=[{id:"data-collection",icon:Rs,title:"Data Collection",content:`We collect various types of information to provide and improve our services:

• Personal Information: Name, email address, phone number, billing and shipping addresses
• Payment Information: Credit card details (processed securely through our payment providers)
• Technical Data: IP address, browser type, device information
• Usage Data: Browsing patterns, product preferences, purchase history
• Cookies: We use cookies and similar tracking technologies to enhance your experience`},{id:"data-usage",icon:ea,title:"Data Usage",content:`Your data helps us provide a better shopping experience:

• Processing and fulfilling your orders
• Personalizing your shopping experience
• Communicating about orders, products, and promotions
• Improving our website and services
• Preventing fraud and maintaining security

We may share data with trusted third parties who assist us in operating our website, conducting business, or servicing you.`},{id:"data-protection",icon:Is,title:"Data Protection",content:`We implement robust security measures to protect your data:

• SSL/TLS encryption for all data transmission
• Secure storage on protected servers
• Regular security assessments and updates
• Strict access controls and authentication
• Compliance with industry security standards`},{id:"user-rights",icon:Ht,title:"Your Rights",content:`You have the right to:

• Access your personal data
• Correct inaccurate data
• Request deletion of your data
• Withdraw consent for data processing
• Object to data processing
• Request data portability
• Lodge a complaint with supervisory authorities`},{id:"international",icon:gi,title:"International Transfers",content:`For international customers:

• Data may be transferred to servers in different countries
• We ensure appropriate safeguards are in place
• Transfers comply with applicable data protection laws
• Standard contractual clauses are implemented where required
• Privacy Shield principles are followed for US transfers`},{id:"updates",icon:Ze,title:"Policy Updates",content:`We may update this Privacy Policy periodically:

• Changes will be posted on this page
• Material changes will be notified via email
• Continued use of our services after changes constitutes acceptance
• Last updated: ${new Date().toLocaleDateString()}`}];return i.jsxs("div",{className:"min-h-screen",children:[i.jsx(G,{backgroundImage:"https://images.unsplash.com/photo-1557597774-9d273605dfa9?auto=format&fit=crop&q=80&w=3440",className:"h-[40vh] flex items-center",speed:.5,children:i.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-white",children:[i.jsx("h1",{className:"text-5xl md:text-6xl font-bold mb-6",children:"Privacy Policy"}),i.jsx("p",{className:"text-xl text-white/80 max-w-2xl mx-auto",children:"Your privacy is important to us. Learn how we protect and manage your personal information."})]})}),i.jsx(G,{backgroundImage:"https://images.unsplash.com/photo-1451187580459-43490279c0fa?auto=format&fit=crop&q=80&w=3440",className:"py-24",speed:.3,children:i.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[i.jsx("div",{className:"bg-white/10 backdrop-blur-md rounded-xl p-8 mb-8 text-white animate-on-scroll opacity-0",children:i.jsx("p",{className:"text-lg leading-relaxed",children:"This Privacy Policy applies to all services provided by LUXE and explains how we collect, use, disclose, and safeguard your personal information. By using our services, you agree to the collection and use of information in accordance with this policy."})}),i.jsx("div",{className:"space-y-8",children:s.map((e,t)=>i.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-xl p-8 text-white animate-on-scroll opacity-0",style:{animationDelay:`${t*200}ms`},children:[i.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[i.jsx(e.icon,{className:"w-8 h-8 text-accent-500"}),i.jsx("h2",{className:"text-2xl font-bold",children:e.title})]}),i.jsx("div",{className:"prose prose-lg prose-invert max-w-none opacity-80",children:i.jsx("pre",{className:"whitespace-pre-wrap font-sans",children:e.content})})]},e.id))}),i.jsxs("div",{className:"bg-white/10 backdrop-blur-md rounded-xl p-8 mt-8 text-white text-center animate-on-scroll opacity-0",children:[i.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Contact Us"}),i.jsx("p",{className:"text-white/80 mb-4",children:"If you have any questions about this Privacy Policy, please contact us at:"}),i.jsx("a",{href:"mailto:privacy@luxe.com",className:"text-accent-400 hover:text-accent-300 transition-colors",children:"privacy@luxe.com"})]})]})})]})}function wh(){return i.jsxs(Yr,{children:[i.jsx(V,{path:"/",element:i.jsx(sh,{})}),i.jsx(V,{path:"/electronics",element:i.jsx(nh,{})}),i.jsx(V,{path:"/men",element:i.jsx(ih,{})}),i.jsx(V,{path:"/women",element:i.jsx(rh,{})}),i.jsx(V,{path:"/watches",element:i.jsx(oh,{})}),i.jsx(V,{path:"/products/:id",element:i.jsx(ch,{})}),i.jsx(V,{path:"/about-us",element:i.jsx(xh,{})}),i.jsx(V,{path:"/faqs",element:i.jsx(yh,{})}),i.jsx(V,{path:"/privacy-policy",element:i.jsx(vh,{})}),i.jsx(V,{path:"/cart",element:i.jsx(wt,{children:i.jsx(dh,{})})}),i.jsx(V,{path:"/profile",element:i.jsx(wt,{children:i.jsx(hh,{})})}),i.jsx(V,{path:"/login",element:i.jsx(wt,{requireAuth:!1,children:i.jsx(Ud,{})})}),i.jsx(V,{path:"/register",element:i.jsx(wt,{requireAuth:!1,children:i.jsx(zd,{})})}),i.jsx(V,{path:"/admin/login",element:i.jsx(ph,{})}),i.jsx(V,{path:"/admin/dashboard",element:i.jsx(ri,{children:i.jsx(fh,{})})}),i.jsx(V,{path:"/admin/credentials",element:i.jsx(ri,{children:i.jsx(gh,{})})})]})}function bh(){return i.jsx(Gr,{children:i.jsxs("div",{className:"min-h-screen flex flex-col",children:[i.jsx(Wd,{}),i.jsx("main",{className:"flex-grow pt-16",children:i.jsx(wh,{})}),i.jsx(qd,{})]})})}const Nh=p.createContext(void 0),Ch=50*1024*1024;function jh({children:s}){const[e,t]=p.useState(()=>{const u=localStorage.getItem("parallax_images");return u?JSON.parse(u):[]}),[n,r]=p.useState(!1);p.useEffect(()=>{localStorage.setItem("parallax_images",JSON.stringify(e))},[e]);const o=async(u,h)=>{r(!0);try{const m=await Promise.all(u.map(async f=>{if(f.size>Ch)throw new Error(`File ${f.name} exceeds 50MB limit`);if(!f.type.startsWith("image/"))throw new Error(`File ${f.name} is not an image`);const g=await new Promise((_,w)=>{const b=new FileReader;b.onload=()=>_(b.result),b.onerror=w,b.readAsDataURL(f)});return{id:crypto.randomUUID(),url:g,name:f.name,pageId:h,active:!0,order:e.filter(_=>_.pageId===h).length,createdAt:new Date().toISOString()}}));t(f=>[...f,...m]),v.success("Images uploaded successfully")}catch(m){throw v.error(m instanceof Error?m.message:"Failed to upload images"),m}finally{r(!1)}},a=u=>{t(h=>h.filter(m=>m.id!==u)),v.success("Image removed")},l=u=>{t(h=>h.map(m=>m.id===u?{...m,active:!m.active}:m)),v.success("Image status updated")},d=(u,h,m)=>{t(f=>{const g=f.filter(N=>N.pageId===u),_=f.filter(N=>N.pageId!==u),[w]=g.splice(h,1);g.splice(m,0,w);const b=g.map((N,A)=>({...N,order:A}));return[..._,...b]})},c=u=>e.filter(h=>h.pageId===u&&h.active).sort((h,m)=>h.order-m.order);return i.jsx(Nh.Provider,{value:{images:e,addImages:o,removeImage:a,toggleImageActive:l,reorderImages:d,getActiveImagesForPage:c,loading:n},children:s})}us.createRoot(document.getElementById("root")).render(i.jsx(Br.StrictMode,{children:i.jsx(Cd,{children:i.jsx(mh,{children:i.jsx(ah,{children:i.jsx(Kd,{children:i.jsxs(jh,{children:[i.jsx(bh,{}),i.jsx(ta,{position:"bottom-right",toastOptions:{duration:3e3,style:{background:"#333",color:"#fff"}}})]})})})})})}));
